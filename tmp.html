
<html>
  <head></head>
  <body><pre><code>
// https://tldp.org/LDP/lpg/node11.html

#include <string.h>
#include <unistd.h>
#include <stdio.h>
#include <stdlib.h>
#include <errno.h>
#include <sys/types.h>

#define READ   0
#define WRITE  1

int main(void) {
        int     pfd[2], write_return, read_return;
        pid_t   pid;
        char    string[] = "Hello, world!\n";
        char    readbuffer[80];

        pipe(pfd);
        pid = fork();

        if(pid == 0) {
                close(pfd[READ]);

                printf("errno, before write: %d\n", errno);
                write_return = write(pfd[WRITE], string, (strlen(string)+1));
                printf("write_return: %d\n", write_return);
                printf("errno, after write: %d\n", errno);
                exit(0);
        }

        else {
                close(pfd[WRITE]);

                printf("errno, before read: %d\n", errno);
                read_return = read(pfd[READ], readbuffer, sizeof(readbuffer));
                printf("read_return: %d\n", read_return);
                printf("errno, after read: %d\n", errno);
                printf("Received string: %s", readbuffer);
        }
        
        return 0;
}

/*
Normal (Read 0, Write 1)

errno, before read: 0
errno, before write: 0
write_return: 15
errno, after write: 0
read_return: 15
errno, after read: 0
Received string: Hello, world!



Error (Read 1, Write 0)

errno, before read: 0
read_return: -1
errno, after read: 9
Received string: @errno, before write: 0
write_return: -1
errno, after write: 9

// EBADF: 9
// https://man7.org/linux/man-pages/man2/write.2.html

tested on Fedora 36
*/
</code></pre></body></html>
