<!DOCTYPE html><html>

<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width"/>
    
    <title>Chap14-6</title>
    
    <link rel="preload" href="https://fonts.googleapis.com/css2?family=Nanum+Gothic+Coding&amp;display=swap" as="style" onload="this.onload=null;this.rel='stylesheet'"/>
    <!--<link href="https://fonts.googleapis.com/css2?family=Nanum+Gothic+Coding&amp;display=swap" rel="stylesheet"/> -->
    
    <link href="page.css" rel="stylesheet"/><link href="markdown.css" rel="stylesheet"/><link href="nav.css" rel="stylesheet"/><link href="header.css" rel="stylesheet"/>
    
</head>

<body>


    <header>
<p><div class="topmenu deactivated"><a href="index.html">Home</a> <a href="index.html#index-by-chapter">단원별 목차</a> <a href="index.html#index-by-keyword">키워드 목차</a> <a href="Appendix.html">부록</a></div><div class="mobileview"><a id="navbutton">&#9776;</a></div></p>
    </header>



    <nav>
<p><a id="settingsopenbutton">&#9728;</a><a href="#top">&#9650;</a><a href="#bottom">&#9660;</a></p><div id="settingsmenubg"><div id="settingsmenu"><table><thead><tr><th colspan="2"><div class="align-right"> <span class="size-giant"><a id="settingsclosebutton">&#10006;</a></span></div></th></tr></thead><tbody><tr><td><div class="align-right">Theme:</div></td><td><div class="align-left"><a id="changethemebutton">Set Light Theme</a></div></td></tr><tr><td><div class="align-right">Horizontal Padding:</div></td><td><div class="align-left"><a id="growhorizontalbutton">Grow</a> <a id="shrinkhorizontalbutton">Shrink</a></div></td></tr><tr><td><div class="align-right">Font Size:</div></td><td><div class="align-left"><a id="growfontbutton">Grow</a> <a id="shrinkfontbutton">Shrink</a></div></td></tr><tr><td><div class="align-right">Settings:</div></td><td><div class="align-left"><a id="savesettingsbutton">Save All</a> <a id="discardsettingsbutton">Discard All</a></div></td></tr></tbody></table></div></div>
    </nav>


    <article class="markdown">
        <a id="top"></a>
<table><thead onclick="collapse_table('0')" id="table-collapse-toggle-0" class="collapsible collapsed"><tr><th>목차</th></tr></thead><tbody id="collapsible-table-0" class="invisible"><tr><td><div class="toc"><ol type="1"><li><a href="#small-step-operational-semantics">Small-Step Operational Semantics</a><ol type="1"><li><a href="#tm">tm</a></li><li><a href="#relations">Relations</a><ol type="1"><li><a href="#determinism">Determinism</a></li><li><a href="#strong-progress">Strong Progress</a></li><li><a href="#normal-form">Normal Form</a></li></ol></li><li><a href="#multi-step-reduction">Multi-step Reduction</a></li></ol></li></ol></div></td></tr></tbody></table><h1 id="small-step-operational-semantics">Small-Step Operational Semantics</h1><p>지금까지 봤던 모든 프로그램 검증은 big-step으로 진행됐습니다. 프로그램을 통째로 던져주고, 시작과 끝 조건만 알려주면 Coq이 한번에 검증을 해주었습니다. 간단한 프로그램에선 아주 좋은 방법이지만, 세상은 그렇게 간단하지 않습니다. 예를 들어서, 명령어 10개로 이뤄진 병렬 프로그램을 생각해봅시다. 만약 이 프로그램이 병렬로 돌아가지 않는다면 명령어 10개가 동시에 실행된다고 생각해도 문제가 없습니다. 중간에 누가 끼어들지 않을테니까요. (끼어들더라도 이 프로그램에 영향을 주지 않을테니까요) 하지만 병렬로, 서로 협력하면서 돌아간다면요? 첫번째 프로그램의 명령어가 3개 실행됐을 때, 두번째 프로그램의 7번째 명령어가 실행되면요? 이런 상황에서도 검증이 유효하려면 big-step말고 다른 전략을 취해야합니다. 그래서 이번 장에서는 small-step을 소개합니다.</p><p>TODO: typechecker도 big-step/small-step과 관련된 문제라는데 왜 그런지 모르겠습니다...</p><h2 id="tm">tm</h2><p>본격적으로 small-step operational semantics를 다루기 전에 간단한 언어를 정의하겠습니다. 이번에 정의할 tm이라는 언어는 이전에 봤던 Imp보다 훨씬 간단합니다. 상수와 덧셈밖에 없어요.</p><pre class="fenced-code-block line-num-width-1"><code><span class="code-fence-row"><span class="code-fence-index">1</span><span class="code-fence-code"><span class="color-violet">Inductive</span> <span class="color-aqua">tm</span> <span class="color-white">:</span> <span class="color-white">Type</span> <span class="color-white">:=</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">2</span><span class="code-fence-code">  <span class="color-white">|</span> <span class="color-aqua">C</span> <span class="color-white">:</span> <span class="color-emerald">nat</span> <span class="color-white">-</span><span class="color-white">&gt;</span> <span class="color-violet">tm</span>         <span class="color-gray">(*</span><span class="color-gray"> 상수 </span><span class="color-gray">*)</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">3</span><span class="code-fence-code">  <span class="color-white">|</span> <span class="color-aqua">P</span> <span class="color-white">:</span> <span class="color-violet">tm</span> <span class="color-white">-</span><span class="color-white">&gt;</span> <span class="color-violet">tm</span> <span class="color-white">-</span><span class="color-white">&gt;</span> <span class="color-violet">tm</span><span class="color-white">.   </span><span class="color-gray">(*</span><span class="color-gray"> 덧셈 </span><span class="color-gray">*)</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">4</span><span class="code-fence-code"></span></span>
<span class="code-fence-row"><span class="code-fence-index">5</span><span class="code-fence-code"><span class="color-violet">Fixpoint</span> <span class="color-aqua">evalF</span> <span class="color-white">(</span><span class="color-red">t</span> <span class="color-white">:</span> <span class="color-violet">tm</span><span class="color-white">)</span> <span class="color-white">:</span> <span class="color-emerald">nat</span> <span class="color-white">:=</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">6</span><span class="code-fence-code">  <span class="color-violet">match</span> <span class="color-red">t</span> <span class="color-violet">with</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">7</span><span class="code-fence-code">  <span class="color-white">|</span> <span class="color-red">C</span> <span class="color-red">n</span> <span class="color-white">=</span><span class="color-white">&gt;</span> <span class="color-red">n</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">8</span><span class="code-fence-code">  <span class="color-white">|</span> <span class="color-red">P</span> <span class="color-red">t1</span> <span class="color-red">t2</span> <span class="color-white">=</span><span class="color-white">&gt;</span> <span class="color-red">evalF</span> <span class="color-red">t1</span> <span class="color-white">+</span> <span class="color-red">evalF</span> <span class="color-red">t2</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">9</span><span class="code-fence-code">  <span class="color-violet">end</span><span class="color-white">.</span></span></span>
</code><button onclick="copy_code_to_clipboard(0)" class="copy-fenced-code">Copy</button></pre><p>아주 간단하죠? <code class="inline-code-span">C 3</code>은 3이고 <code class="inline-code-span">P (C 3) (P (C 2) (C 4))</code>는 <code class="inline-code-span">3 + (2 + 4)</code>라서 9입니다. 그다음으로 <code class="inline-code-span">Notation</code>도 정의해보겠습니다.</p><pre class="fenced-code-block line-num-width-1"><code><span class="code-fence-row"><span class="code-fence-index">1</span><span class="code-fence-code">Reserved Notation &quot; t &apos;==&gt;&apos; n &quot; (at level 50, left associativity).</span></span>
<span class="code-fence-row"><span class="code-fence-index">2</span><span class="code-fence-code"></span></span>
<span class="code-fence-row"><span class="code-fence-index">3</span><span class="code-fence-code">Inductive eval : tm -&gt; nat -&gt; Prop :=</span></span>
<span class="code-fence-row"><span class="code-fence-index">4</span><span class="code-fence-code">  | E_Const : forall n,</span></span>
<span class="code-fence-row"><span class="code-fence-index">5</span><span class="code-fence-code">      C n ==&gt; n</span></span>
<span class="code-fence-row"><span class="code-fence-index">6</span><span class="code-fence-code">  | E_Plus : forall t1 t2 v1 v2,</span></span>
<span class="code-fence-row"><span class="code-fence-index">7</span><span class="code-fence-code">      t1 ==&gt; v1 -&gt;</span></span>
<span class="code-fence-row"><span class="code-fence-index">8</span><span class="code-fence-code">      t2 ==&gt; v2 -&gt;</span></span>
<span class="code-fence-row"><span class="code-fence-index">9</span><span class="code-fence-code">      P t1 t2 ==&gt; (v1 + v2)</span></span>
<span class="code-fence-row"><span class="code-fence-index">10</span><span class="code-fence-code"></span></span>
<span class="code-fence-row"><span class="code-fence-index">11</span><span class="code-fence-code">where &quot; t &apos;==&gt;&apos; n &quot; := (eval t n).</span></span>
</code><button onclick="copy_code_to_clipboard(1)" class="copy-fenced-code">Copy</button></pre><p>아까 <code class="inline-code-span">Fixpoint</code>로 정의한 <code class="inline-code-span">evalF</code>를 <code class="inline-code-span">Inductive</code>로 정의해보았습니다. 이 정의는 지금까지 봐왔던 big-step operational semantics를 따르는 정의입니다. small-step으로도 정의해보겠습니다. 아래를 봅시다.</p><pre class="fenced-code-block line-num-width-1"><code><span class="code-fence-row"><span class="code-fence-index">1</span><span class="code-fence-code">Reserved Notation &quot; t &apos;--&gt;&apos; t&apos; &quot; (at level 40).</span></span>
<span class="code-fence-row"><span class="code-fence-index">2</span><span class="code-fence-code"></span></span>
<span class="code-fence-row"><span class="code-fence-index">3</span><span class="code-fence-code">Inductive step : tm -&gt; tm -&gt; Prop :=</span></span>
<span class="code-fence-row"><span class="code-fence-index">4</span><span class="code-fence-code">  | ST_PlusConstConst : forall v1 v2,</span></span>
<span class="code-fence-row"><span class="code-fence-index">5</span><span class="code-fence-code">      P (C v1) (C v2) --&gt; C (v1 + v2)</span></span>
<span class="code-fence-row"><span class="code-fence-index">6</span><span class="code-fence-code">  | ST_Plus1 : forall t1 t1&apos; t2,</span></span>
<span class="code-fence-row"><span class="code-fence-index">7</span><span class="code-fence-code">      t1 --&gt; t1&apos; -&gt;</span></span>
<span class="code-fence-row"><span class="code-fence-index">8</span><span class="code-fence-code">      P t1 t2 --&gt; P t1&apos; t2</span></span>
<span class="code-fence-row"><span class="code-fence-index">9</span><span class="code-fence-code">  | ST_Plus2 : forall v1 t2 t2&apos;,</span></span>
<span class="code-fence-row"><span class="code-fence-index">10</span><span class="code-fence-code">      t2 --&gt; t2&apos; -&gt;</span></span>
<span class="code-fence-row"><span class="code-fence-index">11</span><span class="code-fence-code">      P (C v1) t2 --&gt; P (C v1) t2&apos;</span></span>
<span class="code-fence-row"><span class="code-fence-index">12</span><span class="code-fence-code"></span></span>
<span class="code-fence-row"><span class="code-fence-index">13</span><span class="code-fence-code">  where &quot; t &apos;--&gt;&apos; t&apos; &quot; := (step t t&apos;).</span></span>
</code><button onclick="copy_code_to_clipboard(2)" class="copy-fenced-code">Copy</button></pre><p>big-step에서는 <code class="inline-code-span">tm</code>이 아무리 복잡하더라도 한번에 계산을 끝냈는데, 이번에는 한번에 한 단계씩 원자적으로(atomic) 계산합니다. 예를 들어서, <code class="inline-code-span">P (C 3) (P (C 2) (C 4))</code>를 big-step으로 계산하면 9가 되지만 small-step으로 계산하면 <code class="inline-code-span">P (C 3) (C 6)</code>이 됩니다.</p><p><code class="inline-code-span">step</code>의 정의를 좀 더 자세하게 뜯어보면 아래와 같습니다.</p><ul><li>덧셈의 양변이 상수 (<code class="inline-code-span">C</code>)일 경우 덧셈을 계산합니다.</li><li>덧셈의 인수 중 다른 덧셈이 포함돼 있을 경우 그 덧셈부터 계산합니다. 이때는 왼쪽 인수부터 확인합니다.</li></ul><h2 id="relations">Relations</h2><p>이번에는 single-step의 관계(relation)에 대해서 얘기를 해보겠습니다. <a href="Chap11-1.html">11장</a>에서 봤던 내용들이 다시 나오니 기억이 안 나시면 잠깐 복습을 하고 와주세요.</p><pre class="fenced-code-block"><code><span class="code-fence-row"><span class="code-fence-code"><span class="color-violet">Definition</span> <span class="color-aqua">relation</span> <span class="color-white">(</span><span class="color-red">X</span> <span class="color-white">:</span> <span class="color-white">Type</span><span class="color-white">)</span> <span class="color-white">:=</span> <span class="color-red">X</span> <span class="color-white">-</span><span class="color-white">&gt;</span> <span class="color-red">X</span> <span class="color-white">-</span><span class="color-white">&gt;</span> <span class="color-white">Prop</span><span class="color-white">.</span></span></span>
</code></pre><p>Coq에서 관계(relation)는 위와 같이 정의합니다. 어떤 type <code class="inline-code-span">X</code>의 원소 2개가 갖는 <code class="inline-code-span">Prop</code>을 관계라고 하죠. 저희는 <code class="inline-code-span">X</code>가 tm인 관계를 살펴보는게 아니고 <code class="inline-code-span">X</code>가 single-step인 관계를 살펴볼 예정입니다. 먼저 <code class="inline-code-span">deterministic</code>이라는 관계부터 살펴보겠습니다.</p><h3 id="determinism">Determinism</h3><pre class="fenced-code-block line-num-width-0"><code><span class="code-fence-row"><span class="code-fence-index">1</span><span class="code-fence-code"><span class="color-violet">Definition</span> <span class="color-aqua">deterministic</span><span class="color-white"> {</span><span class="color-red">X</span> <span class="color-white">:</span> <span class="color-white">Type</span><span class="color-dark">}</span> <span class="color-white">(</span><span class="color-red">R</span> <span class="color-white">:</span> <span class="color-red">relation</span> <span class="color-red">X</span><span class="color-white">)</span> <span class="color-white">:=</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">2</span><span class="code-fence-code">  <span class="color-violet">forall</span> <span class="color-red">x</span> <span class="color-red">y1</span> <span class="color-red">y2</span> <span class="color-white">:</span> <span class="color-violet">X</span><span class="color-white">,</span> <span class="color-red">R</span> <span class="color-red">x</span> <span class="color-red">y1</span> <span class="color-white">-</span><span class="color-white">&gt;</span> <span class="color-red">R</span> <span class="color-red">x</span> <span class="color-red">y2</span> <span class="color-white">-</span><span class="color-white">&gt;</span> <span class="color-red">y1</span> <span class="color-white">=</span> <span class="color-red">y2</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">3</span><span class="code-fence-code"></span></span>
<span class="code-fence-row"><span class="code-fence-index">4</span><span class="code-fence-code"><span class="color-violet">Theorem</span> <span class="color-aqua">step_deterministic</span><span class="color-white">:</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">5</span><span class="code-fence-code">  <span class="color-red">deterministic</span> <span class="color-white">step</span><span class="color-white">.</span></span></span>
</code><button onclick="copy_code_to_clipboard(4)" class="copy-fenced-code">Copy</button></pre><p>tm의 single-step이 deterministic하다는 정의입니다. 쉽게 말하면, 어떤 tm이 주어졌을 때, 거기서 single-step을 거치면 그 다음 tm의 모양은 최대 1개입니다. 즉, 다음 상태가 유일하게 정해지거나 더 이상 step을 진행할 수 없습니다. 이전에 정의했던 Imp도 deterministic한 언어라 동일한 성질을 갖습니다.</p><pre class="fenced-code-block line-num-width-1"><code><span class="code-fence-row"><span class="code-fence-index">1</span><span class="code-fence-code"><span class="color-violet">Theorem</span> <span class="color-aqua">step_deterministic</span><span class="color-white">:</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">2</span><span class="code-fence-code">  <span class="color-red">deterministic</span> <span class="color-red">step</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">3</span><span class="code-fence-code"><span class="color-violet">Proof</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">4</span><span class="code-fence-code">  <span class="color-emerald">unfold</span> <span class="color-red">deterministic</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">5</span><span class="code-fence-code">  <span class="color-emerald">intros</span> <span class="color-red">x</span> <span class="color-red">y1</span> <span class="color-red">y2</span> <span class="color-red">Hy1</span> <span class="color-red">Hy2</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">6</span><span class="code-fence-code">  <span class="color-emerald">generalize</span> <span class="color-red">dependent</span> <span class="color-red">y2</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">7</span><span class="code-fence-code">  <span class="color-emerald">induction</span> <span class="color-red">Hy1</span><span class="color-white">;</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">8</span><span class="code-fence-code">  <span class="color-emerald">intros</span> <span class="color-red">y2</span> <span class="color-red">Hy2</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">9</span><span class="code-fence-code">  <span class="color-aqua">-</span> <span class="color-gray">(*</span><span class="color-gray"> ST_PlusConstConst </span><span class="color-gray">*)</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">10</span><span class="code-fence-code">    <span class="color-emerald">inversion</span> <span class="color-red">Hy2</span><span class="color-white">;</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">11</span><span class="code-fence-code">    <span class="color-emerald">subst</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">12</span><span class="code-fence-code">    <span class="color-aqua">+</span> <span class="color-gray">(*</span><span class="color-gray"> ST_PlusConstConst </span><span class="color-gray">*)</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">13</span><span class="code-fence-code">      <span class="color-emerald">reflexivity</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">14</span><span class="code-fence-code">    <span class="color-aqua">+</span> <span class="color-gray">(*</span><span class="color-gray"> ST_Plus1 </span><span class="color-gray">*)</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">15</span><span class="code-fence-code">      <span class="color-emerald">inversion</span> <span class="color-red">H2</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">16</span><span class="code-fence-code">    <span class="color-aqua">+</span> <span class="color-gray">(*</span><span class="color-gray"> ST_Plus2 </span><span class="color-gray">*)</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">17</span><span class="code-fence-code">      <span class="color-emerald">inversion</span> <span class="color-red">H2</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">18</span><span class="code-fence-code">  <span class="color-aqua">-</span> <span class="color-gray">(*</span><span class="color-gray"> ST_Plus1 </span><span class="color-gray">*)</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">19</span><span class="code-fence-code">    <span class="color-emerald">inversion</span> <span class="color-red">Hy2</span><span class="color-white">;</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">20</span><span class="code-fence-code">    <span class="color-emerald">subst</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">21</span><span class="code-fence-code">    <span class="color-aqua">+</span> <span class="color-gray">(*</span><span class="color-gray"> ST_PlusConstConst </span><span class="color-gray">*)</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">22</span><span class="code-fence-code">      <span class="color-emerald">inversion</span> <span class="color-red">Hy1</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">23</span><span class="code-fence-code">    <span class="color-aqua">+</span> <span class="color-gray">(*</span><span class="color-gray"> ST_Plus1 </span><span class="color-gray">*)</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">24</span><span class="code-fence-code">      <span class="color-emerald">apply</span> <span class="color-red">IHHy1</span> <span class="color-violet">in</span> <span class="color-red">H2</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">25</span><span class="code-fence-code">      <span class="color-emerald">rewrite</span> <span class="color-red">H2</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">26</span><span class="code-fence-code">      <span class="color-emerald">reflexivity</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">27</span><span class="code-fence-code">    <span class="color-aqua">+</span> <span class="color-gray">(*</span><span class="color-gray"> ST_Plus2 </span><span class="color-gray">*)</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">28</span><span class="code-fence-code">      <span class="color-emerald">inversion</span> <span class="color-red">Hy1</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">29</span><span class="code-fence-code">  <span class="color-aqua">-</span> <span class="color-gray">(*</span><span class="color-gray"> ST_Plus2 </span><span class="color-gray">*)</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">30</span><span class="code-fence-code">    <span class="color-emerald">inversion</span> <span class="color-red">Hy2</span><span class="color-white">;</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">31</span><span class="code-fence-code">    <span class="color-emerald">subst</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">32</span><span class="code-fence-code">    <span class="color-aqua">+</span> <span class="color-gray">(*</span><span class="color-gray"> ST_PlusConstConst </span><span class="color-gray">*)</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">33</span><span class="code-fence-code">      <span class="color-emerald">inversion</span> <span class="color-red">Hy1</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">34</span><span class="code-fence-code">    <span class="color-aqua">+</span> <span class="color-gray">(*</span><span class="color-gray"> ST_Plus1 </span><span class="color-gray">*)</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">35</span><span class="code-fence-code">      <span class="color-emerald">inversion</span> <span class="color-red">H2</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">36</span><span class="code-fence-code">    <span class="color-aqua">+</span> <span class="color-gray">(*</span><span class="color-gray"> ST_Plus2 </span><span class="color-gray">*)</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">37</span><span class="code-fence-code">      <span class="color-emerald">apply</span> <span class="color-red">IHHy1</span> <span class="color-violet">in</span> <span class="color-red">H2</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">38</span><span class="code-fence-code">      <span class="color-emerald">rewrite</span> <span class="color-red">H2</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">39</span><span class="code-fence-code">      <span class="color-emerald">reflexivity</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">40</span><span class="code-fence-code">  <span class="color-violet">Qed</span><span class="color-white">.</span></span></span>
</code><button onclick="copy_code_to_clipboard(5)" class="copy-fenced-code">Copy</button></pre><p><code class="inline-code-span">step_deterministic</code>의 증명입니다. single-step으로 가능한 모든 경우의 수를 <code class="inline-code-span">inversion</code>을 통해서 풀어헤친 뒤 <code class="inline-code-span">reflexivity</code>로 증명했습니다. 증명 과정에서 동일한 tactic이 반복되는게 귀찮았는지 책에선 <code class="inline-code-span">Ltac</code>을 사용해서 축약을 했습니다.</p><pre class="fenced-code-block line-num-width-1"><code><span class="code-fence-row"><span class="code-fence-index">1</span><span class="code-fence-code">Ltac solve_by_inverts n :=</span></span>
<span class="code-fence-row"><span class="code-fence-index">2</span><span class="code-fence-code">  match goal with | H : ?T |- _ =&gt;</span></span>
<span class="code-fence-row"><span class="code-fence-index">3</span><span class="code-fence-code">  match type of T with Prop =&gt;</span></span>
<span class="code-fence-row"><span class="code-fence-index">4</span><span class="code-fence-code">    solve [</span></span>
<span class="code-fence-row"><span class="code-fence-index">5</span><span class="code-fence-code">      inversion H;</span></span>
<span class="code-fence-row"><span class="code-fence-index">6</span><span class="code-fence-code">      match n with S (S (?n&apos;)) =&gt; subst; solve_by_inverts (S n&apos;) end ]</span></span>
<span class="code-fence-row"><span class="code-fence-index">7</span><span class="code-fence-code">  end end.</span></span>
<span class="code-fence-row"><span class="code-fence-index">8</span><span class="code-fence-code"></span></span>
<span class="code-fence-row"><span class="code-fence-index">9</span><span class="code-fence-code">Ltac solve_by_invert :=</span></span>
<span class="code-fence-row"><span class="code-fence-index">10</span><span class="code-fence-code">  solve_by_inverts 1.</span></span>
</code><button onclick="copy_code_to_clipboard(6)" class="copy-fenced-code">Copy</button></pre><p>저 tactic이 어떤 원리로 동작하는지는 중요하지 않습니다. 다만 tactic을 재귀적으로 쓴다는게 신기하네요. <code class="inline-code-span">solve_by_inverts</code>를 이용해서 다시 증명을 해보면 아래와 같습니다.</p><pre class="fenced-code-block line-num-width-1"><code><span class="code-fence-row"><span class="code-fence-index">1</span><span class="code-fence-code">Theorem step_deterministic_alt:</span></span>
<span class="code-fence-row"><span class="code-fence-index">2</span><span class="code-fence-code">  deterministic step.</span></span>
<span class="code-fence-row"><span class="code-fence-index">3</span><span class="code-fence-code">Proof.</span></span>
<span class="code-fence-row"><span class="code-fence-index">4</span><span class="code-fence-code">  intros x y1 y2 Hy1 Hy2.</span></span>
<span class="code-fence-row"><span class="code-fence-index">5</span><span class="code-fence-code">  generalize dependent y2.</span></span>
<span class="code-fence-row"><span class="code-fence-index">6</span><span class="code-fence-code">  induction Hy1; intros y2 Hy2;</span></span>
<span class="code-fence-row"><span class="code-fence-index">7</span><span class="code-fence-code">    inversion Hy2;</span></span>
<span class="code-fence-row"><span class="code-fence-index">8</span><span class="code-fence-code">    subst;</span></span>
<span class="code-fence-row"><span class="code-fence-index">9</span><span class="code-fence-code">    try solve_by_invert.</span></span>
<span class="code-fence-row"><span class="code-fence-index">10</span><span class="code-fence-code">  - (* ST_PlusConstConst *)</span></span>
<span class="code-fence-row"><span class="code-fence-index">11</span><span class="code-fence-code">    reflexivity.</span></span>
<span class="code-fence-row"><span class="code-fence-index">12</span><span class="code-fence-code">  - (* ST_Plus1 *)</span></span>
<span class="code-fence-row"><span class="code-fence-index">13</span><span class="code-fence-code">    apply IHHy1 in H2.</span></span>
<span class="code-fence-row"><span class="code-fence-index">14</span><span class="code-fence-code">    rewrite H2.</span></span>
<span class="code-fence-row"><span class="code-fence-index">15</span><span class="code-fence-code">    reflexivity.</span></span>
<span class="code-fence-row"><span class="code-fence-index">16</span><span class="code-fence-code">  - (* ST_Plus2 *)</span></span>
<span class="code-fence-row"><span class="code-fence-index">17</span><span class="code-fence-code">    apply IHHy1 in H2.</span></span>
<span class="code-fence-row"><span class="code-fence-index">18</span><span class="code-fence-code">    rewrite H2.</span></span>
<span class="code-fence-row"><span class="code-fence-index">19</span><span class="code-fence-code">    reflexivity.</span></span>
<span class="code-fence-row"><span class="code-fence-index">20</span><span class="code-fence-code">  Qed.</span></span>
</code><button onclick="copy_code_to_clipboard(7)" class="copy-fenced-code">Copy</button></pre><p>아까보다 훨씬 간단하군요.</p><h3 id="strong-progress">Strong Progress</h3><p>방금 전에는 step이 유일하다는 걸 증명했죠? 이번엔 step이 가능하다는 걸 증명하겠습니다. 즉, 모든 tm에 대해서 더 이상 계산이 불가능한 상태거나 (이미 계산이 끝나서 상수밖에 안 남은 경우), single-step을 밟을 수 있음을 증명하겠습니다.</p><p>좀 더 쉽게 설명하자면 tm이 상수가 아닌 상태로 끝나지 않음을 증명해보겠습니다. tm이야 간단한 언어니까 상관없지만 아주 복잡한 언어의 step을 정의할 경우 더 진행이 가능하지만 (상수가 아니지만) 밟을 수 있는 step이 없는 경우가 있을 수도 있습니다. 그렇게 되면 step이나 언어의 정의를 잘못한 거거든요? 그걸 막는 연습을 하겠습니다.</p><pre class="fenced-code-block line-num-width-0"><code><span class="code-fence-row"><span class="code-fence-index">1</span><span class="code-fence-code"><span class="color-violet">Inductive</span> <span class="color-aqua">value</span> <span class="color-white">:</span> <span class="color-violet">tm</span> <span class="color-white">-</span><span class="color-white">&gt;</span> <span class="color-white">Prop</span> <span class="color-white">:=</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">2</span><span class="code-fence-code">  <span class="color-white">|</span> <span class="color-aqua">v_const</span> <span class="color-white">:</span> <span class="color-violet">forall</span> <span class="color-red">n</span><span class="color-white">,</span> <span class="color-violet">value</span> <span class="color-white">(</span><span class="color-red">C</span> <span class="color-red">n</span><span class="color-white">)</span><span class="color-white">.</span></span></span>
</code><button onclick="copy_code_to_clipboard(8)" class="copy-fenced-code">Copy</button></pre><p>그 전에, <code class="inline-code-span">value</code>라는 <code class="inline-code-span">Inductive</code>를 정의했습니다. <code class="inline-code-span">value</code>는 <code class="inline-code-span">tm</code>이 상수인지를 <code class="inline-code-span">Prop</code>으로 나타냅니다.</p><pre class="fenced-code-block line-num-width-1"><code><span class="code-fence-row"><span class="code-fence-index">1</span><span class="code-fence-code"><span class="color-violet">Theorem</span> <span class="color-aqua">strong_progress</span> <span class="color-white">:</span> <span class="color-violet">forall</span> <span class="color-red">t</span><span class="color-white">,</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">2</span><span class="code-fence-code">  <span class="color-red">value</span> <span class="color-red">t</span> <span class="color-white">\/</span> <span class="color-white">(</span><span class="color-violet">exists</span> <span class="color-red">t&apos;</span><span class="color-white">,</span> <span class="color-red">t</span> <span class="color-white">-</span><span class="color-white">-</span><span class="color-white">&gt;</span> <span class="color-red">t&apos;</span><span class="color-white">)</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">3</span><span class="code-fence-code"><span class="color-violet">Proof</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">4</span><span class="code-fence-code">  <span class="color-emerald">induction</span> <span class="color-red">t</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">5</span><span class="code-fence-code">  <span class="color-aqua">-</span> <span class="color-gray">(*</span><span class="color-gray"> C </span><span class="color-gray">*)</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">6</span><span class="code-fence-code">    <span class="color-aqua">left</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">7</span><span class="code-fence-code">    <span class="color-emerald">apply</span> <span class="color-red">v_const</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">8</span><span class="code-fence-code">  <span class="color-aqua">-</span> <span class="color-gray">(*</span><span class="color-gray"> P </span><span class="color-gray">*)</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">9</span><span class="code-fence-code">    <span class="color-aqua">right</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">10</span><span class="code-fence-code">    <span class="color-emerald">destruct</span> <span class="color-red">IHt1</span> <span class="color-violet">as</span> <span class="color-white">[</span><span class="color-red">IHt1</span> <span class="color-white">|</span> <span class="color-white">[</span><span class="color-red">t1&apos;</span> <span class="color-red">Ht1</span><span class="color-white">]</span> <span class="color-white">]</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">11</span><span class="code-fence-code">    <span class="color-aqua">+</span> <span class="color-gray">(*</span><span class="color-gray"> left </span><span class="color-gray">*)</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">12</span><span class="code-fence-code">      <span class="color-emerald">destruct</span> <span class="color-red">IHt2</span> <span class="color-violet">as</span> <span class="color-white">[</span><span class="color-red">IHt2</span> <span class="color-white">|</span> <span class="color-white">[</span><span class="color-red">t2&apos;</span> <span class="color-red">Ht2</span><span class="color-white">]</span> <span class="color-white">]</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">13</span><span class="code-fence-code">      <span class="color-aqua">*</span> <span class="color-gray">(*</span><span class="color-gray"> left </span><span class="color-gray">*)</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">14</span><span class="code-fence-code">        <span class="color-emerald">inversion</span> <span class="color-red">IHt1</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">15</span><span class="code-fence-code">        <span class="color-emerald">inversion</span> <span class="color-red">IHt2</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">16</span><span class="code-fence-code">        <span class="color-emerald">exists</span> <span class="color-white">(</span><span class="color-red">C</span> <span class="color-white">(</span><span class="color-red">n</span> <span class="color-white">+</span> <span class="color-red">n0</span><span class="color-white">)</span><span class="color-white">)</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">17</span><span class="code-fence-code">        <span class="color-emerald">apply</span> <span class="color-red">ST_PlusConstConst</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">18</span><span class="code-fence-code">      <span class="color-aqua">*</span> <span class="color-gray">(*</span><span class="color-gray"> right </span><span class="color-gray">*)</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">19</span><span class="code-fence-code">        <span class="color-emerald">exists</span> <span class="color-white">(</span><span class="color-red">P</span> <span class="color-red">t1</span> <span class="color-red">t2&apos;</span><span class="color-white">)</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">20</span><span class="code-fence-code">        <span class="color-emerald">apply</span> <span class="color-red">ST_Plus2</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">21</span><span class="code-fence-code">        <span class="color-emerald">apply</span> <span class="color-red">IHt1</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">22</span><span class="code-fence-code">        <span class="color-emerald">apply</span> <span class="color-red">Ht2</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">23</span><span class="code-fence-code">    <span class="color-aqua">+</span> <span class="color-gray">(*</span><span class="color-gray"> right </span><span class="color-gray">*)</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">24</span><span class="code-fence-code">      <span class="color-emerald">exists</span> <span class="color-white">(</span><span class="color-red">P</span> <span class="color-red">t1&apos;</span> <span class="color-red">t2</span><span class="color-white">)</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">25</span><span class="code-fence-code">      <span class="color-emerald">apply</span> <span class="color-red">ST_Plus1</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">26</span><span class="code-fence-code">      <span class="color-emerald">apply</span> <span class="color-red">Ht1</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">27</span><span class="code-fence-code">  <span class="color-violet">Qed</span><span class="color-white">.</span></span></span>
</code><button onclick="copy_code_to_clipboard(9)" class="copy-fenced-code">Copy</button></pre><p>이번 증명도 간단합니다. <code class="inline-code-span">t</code>가 덧셈인지 상수인지를 경우를 나눠서 증명했습니다.</p><h3 id="normal-form">Normal Form</h3><p>Strong Progress를 증명하면서 <code class="inline-code-span">value</code>의 중요한 성질을 하나 발견했습니다. <code class="inline-code-span">value</code>는 더 이상 step을 밟을 수 없고, 더 이상 step을 밟을 수 없으면 <code class="inline-code-span">value</code>입니다. 이처럼 더 이상 step을 밟을 수 없는 상태를 <em>normal form</em>이라고 합니다. Normal form을 Coq으로 정의해보면 아래와 같습니다.</p><pre class="fenced-code-block line-num-width-0"><code><span class="code-fence-row"><span class="code-fence-index">1</span><span class="code-fence-code"><span class="color-violet">Definition</span> <span class="color-aqua">normal_form</span><span class="color-white"> {</span><span class="color-red">X</span> <span class="color-white">:</span> <span class="color-white">Type</span><span class="color-dark">}</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">2</span><span class="code-fence-code">              <span class="color-white">(</span><span class="color-red">R</span> <span class="color-white">:</span> <span class="color-red">relation</span> <span class="color-red">X</span><span class="color-white">)</span> <span class="color-white">(</span><span class="color-red">t</span> <span class="color-white">:</span> <span class="color-red">X</span><span class="color-white">)</span> <span class="color-white">:</span> <span class="color-white">Prop</span> <span class="color-white">:=</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">3</span><span class="code-fence-code">  <span class="color-white">~</span> <span class="color-violet">exists</span> <span class="color-red">t&apos;</span><span class="color-white">,</span> <span class="color-red">R</span> <span class="color-red">t</span> <span class="color-white">t&apos;</span><span class="color-white">.</span></span></span>
</code><button onclick="copy_code_to_clipboard(10)" class="copy-fenced-code">Copy</button></pre><p>한가지 특기할 사항은 <code class="inline-code-span">normal_form</code>이 <code class="inline-code-span">step</code>에 대해서 정의된게 아니고 모든 <code class="inline-code-span">relation</code>에 대해서 정의됐다는 점입니다. 어떤 관계 <code class="inline-code-span">--&gt;</code>이든지 <code class="inline-code-span">t --&gt; t&apos;</code>인 관계가 존재하지 않으면 <code class="inline-code-span">t</code>는 normal form이라고 부릅니다. tm에서 <code class="inline-code-span">C</code>가 normal form인 걸 증명해보겠습니다.</p><pre class="fenced-code-block line-num-width-1"><code><span class="code-fence-row"><span class="code-fence-index">1</span><span class="code-fence-code"><span class="color-violet">Lemma</span> <span class="color-aqua">value_is_nf</span> <span class="color-white">:</span> <span class="color-violet">forall</span> <span class="color-red">v</span><span class="color-white">,</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">2</span><span class="code-fence-code">  <span class="color-red">value</span> <span class="color-red">v</span> <span class="color-white">-</span><span class="color-white">&gt;</span> <span class="color-red">normal_form</span> <span class="color-red">step</span> <span class="color-red">v</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">3</span><span class="code-fence-code"><span class="color-violet">Proof</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">4</span><span class="code-fence-code">  <span class="color-emerald">unfold</span> <span class="color-red">normal_form</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">5</span><span class="code-fence-code">  <span class="color-emerald">intros</span> <span class="color-red">v</span> <span class="color-red">H</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">6</span><span class="code-fence-code">  <span class="color-emerald">destruct</span> <span class="color-red">H</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">7</span><span class="code-fence-code">  <span class="color-emerald">intros</span> <span class="color-red">contra</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">8</span><span class="code-fence-code">  <span class="color-emerald">destruct</span> <span class="color-red">contra</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">9</span><span class="code-fence-code">  <span class="color-emerald">inversion</span> <span class="color-red">H</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">10</span><span class="code-fence-code">  <span class="color-violet">Qed</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">11</span><span class="code-fence-code"></span></span>
<span class="code-fence-row"><span class="code-fence-index">12</span><span class="code-fence-code"><span class="color-violet">Lemma</span> <span class="color-aqua">nf_is_value</span> <span class="color-white">:</span> <span class="color-violet">forall</span> <span class="color-red">t</span><span class="color-white">,</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">13</span><span class="code-fence-code">  <span class="color-red">normal_form</span> <span class="color-red">step</span> <span class="color-red">t</span> <span class="color-white">-</span><span class="color-white">&gt;</span> <span class="color-red">value</span> <span class="color-red">t</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">14</span><span class="code-fence-code"><span class="color-violet">Proof</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">15</span><span class="code-fence-code">  <span class="color-emerald">unfold</span> <span class="color-red">normal_form</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">16</span><span class="code-fence-code">  <span class="color-emerald">intros</span> <span class="color-red">t</span> <span class="color-red">H</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">17</span><span class="code-fence-code">  <span class="color-emerald">assert</span> <span class="color-white">(</span><span class="color-red">G</span> <span class="color-white">:</span> <span class="color-red">value</span> <span class="color-red">t</span> <span class="color-white">\/</span> <span class="color-violet">exists</span> <span class="color-red">t&apos;</span><span class="color-white">,</span> <span class="color-red">t</span> <span class="color-white">-</span><span class="color-white">-</span><span class="color-white">&gt;</span> <span class="color-red">t&apos;</span><span class="color-white">)</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">18</span><span class="code-fence-code"><span class="color-white">    { </span><span class="color-emerald">apply</span> <span class="color-red">strong_progress</span><span class="color-white">. </span><span class="color-dark">}</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">19</span><span class="code-fence-code">  <span class="color-emerald">destruct</span> <span class="color-red">G</span> <span class="color-violet">as</span> <span class="color-white">[</span><span class="color-red">G</span> <span class="color-white">|</span> <span class="color-red">G</span><span class="color-white">]</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">20</span><span class="code-fence-code">  <span class="color-aqua">-</span> <span class="color-gray">(*</span><span class="color-gray"> l </span><span class="color-gray">*)</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">21</span><span class="code-fence-code">    <span class="color-emerald">apply</span> <span class="color-red">G</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">22</span><span class="code-fence-code">  <span class="color-aqua">-</span> <span class="color-gray">(*</span><span class="color-gray"> r </span><span class="color-gray">*)</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">23</span><span class="code-fence-code">    <span class="color-emerald">contradiction</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">24</span><span class="code-fence-code">  <span class="color-violet">Qed</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">25</span><span class="code-fence-code"></span></span>
<span class="code-fence-row"><span class="code-fence-index">26</span><span class="code-fence-code"><span class="color-violet">Corollary</span> <span class="color-aqua">nf_same_as_value</span> <span class="color-white">:</span> <span class="color-violet">forall</span> <span class="color-red">t</span><span class="color-white">,</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">27</span><span class="code-fence-code">  <span class="color-red">normal_form</span> <span class="color-red">step</span> <span class="color-red">t</span> <span class="color-white">&lt;</span><span class="color-white">-</span><span class="color-white">&gt;</span> <span class="color-red">value</span> <span class="color-red">t</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">28</span><span class="code-fence-code"><span class="color-violet">Proof</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">29</span><span class="code-fence-code">  <span class="color-emerald">split</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">30</span><span class="code-fence-code">  <span class="color-emerald">apply</span> <span class="color-red">nf_is_value</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">31</span><span class="code-fence-code">  <span class="color-emerald">apply</span> <span class="color-red">value_is_nf</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">32</span><span class="code-fence-code">  <span class="color-violet">Qed</span><span class="color-white">.</span></span></span>
</code><button onclick="copy_code_to_clipboard(11)" class="copy-fenced-code">Copy</button></pre><p>이 사실이 흥미로운 이유 중 하나는 <code class="inline-code-span">value</code>는 문법적(syntactic)인 요소고 normal form은 의미적(semantic)인 요소인데 둘이 정확히 대응된다는 겁니다.</p><h2 id="multi-step-reduction">Multi-step Reduction</h2><p>지금까지는 single-step 위주로 봤습니다. 그래서 small-step은 항상 single-step인가 궁금해하셨을 수도 있는데, 그렇지 않습니다. small-step은 0번 이상의 모든 단계를 허용합니다. 이번엔 그런 식으로 단계를 확장하는 방법을 살펴보겠습니다. 먼저, <code class="inline-code-span">multi</code>의 정의를 봅시다.</p><pre class="fenced-code-block line-num-width-0"><code><span class="code-fence-row"><span class="code-fence-index">1</span><span class="code-fence-code"><span class="color-violet">Inductive</span> <span class="color-aqua">multi</span><span class="color-white"> {</span><span class="color-red">X</span> <span class="color-white">:</span> <span class="color-white">Type</span><span class="color-dark">}</span> <span class="color-white">(</span><span class="color-red">R</span> <span class="color-white">:</span> <span class="color-red">relation</span> <span class="color-red">X</span><span class="color-white">)</span> <span class="color-white">:</span> <span class="color-violet">relation</span> <span class="color-violet">X</span> <span class="color-white">:=</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">2</span><span class="code-fence-code">  <span class="color-white">|</span> <span class="color-aqua">multi_refl</span> <span class="color-white">:</span> <span class="color-violet">forall</span> <span class="color-white">(</span><span class="color-red">x</span> <span class="color-white">:</span> <span class="color-violet">X</span><span class="color-white">)</span><span class="color-white">,</span> <span class="color-violet">multi</span> <span class="color-violet">R</span> <span class="color-violet">x</span> <span class="color-violet">x</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">3</span><span class="code-fence-code">  <span class="color-white">|</span> <span class="color-aqua">multi_step</span> <span class="color-white">:</span> <span class="color-violet">forall</span> <span class="color-white">(</span><span class="color-red">x</span> <span class="color-red">y</span> <span class="color-red">z</span> <span class="color-white">:</span> <span class="color-violet">X</span><span class="color-white">)</span><span class="color-white">,</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">4</span><span class="code-fence-code">                    <span class="color-violet">R</span> <span class="color-violet">x</span> <span class="color-violet">y</span> <span class="color-white">-</span><span class="color-white">&gt;</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">5</span><span class="code-fence-code">                    <span class="color-violet">multi</span> <span class="color-violet">R</span> <span class="color-violet">y</span> <span class="color-violet">z</span> <span class="color-white">-</span><span class="color-white">&gt;</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">6</span><span class="code-fence-code">                    <span class="color-violet">multi</span> <span class="color-violet">R</span> <span class="color-violet">x</span> <span class="color-violet">z</span><span class="color-white">.</span></span></span>
</code><button onclick="copy_code_to_clipboard(12)" class="copy-fenced-code">Copy</button></pre><p><code class="inline-code-span">x</code>에서 <code class="inline-code-span">x</code>로 가는 관계는 0 단계를 거치면 되죠? 그걸 <code class="inline-code-span">multi_refl</code>에서 정의했습니다. <code class="inline-code-span">multi_step</code>은 단계를 거치는 과정을 귀납적으로 정의했습니다. <code class="inline-code-span">x</code>에서 <code class="inline-code-span">y</code>로 가는 과정은 딱 1단계를 거치고 (<code class="inline-code-span">multi</code>가 안 붙었으니까), <code class="inline-code-span">y</code>에서 <code class="inline-code-span">z</code>로 가는 과정은 0단계 이상을 거칩니다. 그렇게 되면 <code class="inline-code-span">x</code>에서 <code class="inline-code-span">z</code>로 가는 관계도 있다고 정의함으로써 0 이상의 임의의 단계를 거치는 <code class="inline-code-span">multi</code>라는 관계를 정의했습니다.</p><hr/><div class="align-center"><p><a href="index.html">메인으로 돌아가기</a></p></div><div class="align-left"><p>&lt;&lt; <a href="Chap14-5.html">Chapter 14-5. Hoare Logic as a Logic</a></p></div><div class="align-right"><p><a href="Chap15-1.html">Chapter 15-1. TODO</a> &gt;&gt;</p></div><script>/*<![CDATA[*/
const fenced_code_block_contents = ["Inductive tm : Type :=\n  | C : nat -> tm         (* 상수 *)\n  | P : tm -> tm -> tm.   (* 덧셈 *)\n\nFixpoint evalF (t : tm) : nat :=\n  match t with\n  | C n => n\n  | P t1 t2 => evalF t1 + evalF t2\n  end.", "Reserved Notation \" t '==>' n \" (at level 50, left associativity).\n\nInductive eval : tm -> nat -> Prop :=\n  | E_Const : forall n,\n      C n ==> n\n  | E_Plus : forall t1 t2 v1 v2,\n      t1 ==> v1 ->\n      t2 ==> v2 ->\n      P t1 t2 ==> (v1 + v2)\n\nwhere \" t '==>' n \" := (eval t n).", "Reserved Notation \" t '-->' t' \" (at level 40).\n\nInductive step : tm -> tm -> Prop :=\n  | ST_PlusConstConst : forall v1 v2,\n      P (C v1) (C v2) --> C (v1 + v2)\n  | ST_Plus1 : forall t1 t1' t2,\n      t1 --> t1' ->\n      P t1 t2 --> P t1' t2\n  | ST_Plus2 : forall v1 t2 t2',\n      t2 --> t2' ->\n      P (C v1) t2 --> P (C v1) t2'\n\n  where \" t '-->' t' \" := (step t t').", "", "Definition deterministic {X : Type} (R : relation X) :=\n  forall x y1 y2 : X, R x y1 -> R x y2 -> y1 = y2.\n\nTheorem step_deterministic:\n  deterministic step.", "Theorem step_deterministic:\n  deterministic step.\nProof.\n  unfold deterministic.\n  intros x y1 y2 Hy1 Hy2.\n  generalize dependent y2.\n  induction Hy1;\n  intros y2 Hy2.\n  - (* ST_PlusConstConst *)\n    inversion Hy2;\n    subst.\n    + (* ST_PlusConstConst *)\n      reflexivity.\n    + (* ST_Plus1 *)\n      inversion H2.\n    + (* ST_Plus2 *)\n      inversion H2.\n  - (* ST_Plus1 *)\n    inversion Hy2;\n    subst.\n    + (* ST_PlusConstConst *)\n      inversion Hy1.\n    + (* ST_Plus1 *)\n      apply IHHy1 in H2.\n      rewrite H2.\n      reflexivity.\n    + (* ST_Plus2 *)\n      inversion Hy1.\n  - (* ST_Plus2 *)\n    inversion Hy2;\n    subst.\n    + (* ST_PlusConstConst *)\n      inversion Hy1.\n    + (* ST_Plus1 *)\n      inversion H2.\n    + (* ST_Plus2 *)\n      apply IHHy1 in H2.\n      rewrite H2.\n      reflexivity.\n  Qed.", "Ltac solve_by_inverts n :=\n  match goal with | H : ?T |- _ =>\n  match type of T with Prop =>\n    solve [\n      inversion H;\n      match n with S (S (?n')) => subst; solve_by_inverts (S n') end ]\n  end end.\n\nLtac solve_by_invert :=\n  solve_by_inverts 1.", "Theorem step_deterministic_alt:\n  deterministic step.\nProof.\n  intros x y1 y2 Hy1 Hy2.\n  generalize dependent y2.\n  induction Hy1; intros y2 Hy2;\n    inversion Hy2;\n    subst;\n    try solve_by_invert.\n  - (* ST_PlusConstConst *)\n    reflexivity.\n  - (* ST_Plus1 *)\n    apply IHHy1 in H2.\n    rewrite H2.\n    reflexivity.\n  - (* ST_Plus2 *)\n    apply IHHy1 in H2.\n    rewrite H2.\n    reflexivity.\n  Qed.", "Inductive value : tm -> Prop :=\n  | v_const : forall n, value (C n).", "Theorem strong_progress : forall t,\n  value t \\/ (exists t', t --> t').\nProof.\n  induction t.\n  - (* C *)\n    left.\n    apply v_const.\n  - (* P *)\n    right.\n    destruct IHt1 as [IHt1 | [t1' Ht1] ].\n    + (* left *)\n      destruct IHt2 as [IHt2 | [t2' Ht2] ].\n      * (* left *)\n        inversion IHt1.\n        inversion IHt2.\n        exists (C (n + n0)).\n        apply ST_PlusConstConst.\n      * (* right *)\n        exists (P t1 t2').\n        apply ST_Plus2.\n        apply IHt1.\n        apply Ht2.\n    + (* right *)\n      exists (P t1' t2).\n      apply ST_Plus1.\n      apply Ht1.\n  Qed.", "Definition normal_form {X : Type}\n              (R : relation X) (t : X) : Prop :=\n  ~ exists t', R t t'.", "Lemma value_is_nf : forall v,\n  value v -> normal_form step v.\nProof.\n  unfold normal_form.\n  intros v H.\n  destruct H.\n  intros contra.\n  destruct contra.\n  inversion H.\n  Qed.\n\nLemma nf_is_value : forall t,\n  normal_form step t -> value t.\nProof.\n  unfold normal_form.\n  intros t H.\n  assert (G : value t \\/ exists t', t --> t').\n    { apply strong_progress. }\n  destruct G as [G | G].\n  - (* l *)\n    apply G.\n  - (* r *)\n    contradiction.\n  Qed.\n\nCorollary nf_same_as_value : forall t,\n  normal_form step t <-> value t.\nProof.\n  split.\n  apply nf_is_value.\n  apply value_is_nf.\n  Qed.", "Inductive multi {X : Type} (R : relation X) : relation X :=\n  | multi_refl : forall (x : X), multi R x x\n  | multi_step : forall (x y z : X),\n                    R x y ->\n                    multi R y z ->\n                    multi R x z."];

function copy_code_to_clipboard(index) {
    navigator.clipboard.writeText(fenced_code_block_contents[index]);
}/*]]>*/</script>
        <a id="bottom"></a>
    </article>




    <footer class="markdown">
<p><br/></p><p><br/></p><hr/><div class="align-center"><p>2021 ~ 2023 &copy; Baehyunsol</p></div>
    </footer>


    <script src="colors.js"></script>

    
    <script src="nav.js"></script>
    
    
    
    <script src="header.js"></script>
    
<script src="collapsible_tables.js"></script></body>

</html>