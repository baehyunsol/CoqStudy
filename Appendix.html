<!DOCTYPE html><html>

<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width"/>
    
    <title>Appendix</title>
    
    <link rel="preload" href="https://fonts.googleapis.com/css2?family=Nanum+Gothic+Coding&amp;display=swap" as="style" onload="this.onload=null;this.rel='stylesheet'"/>
    <!--<link href="https://fonts.googleapis.com/css2?family=Nanum+Gothic+Coding&amp;display=swap" rel="stylesheet"/> -->
    
    <link href="page.css" rel="stylesheet"/><link href="markdown.css" rel="stylesheet"/><link href="nav.css" rel="stylesheet"/><link href="header.css" rel="stylesheet"/>
    
</head>

<body>


    <header>
<p><div class="topmenu deactivated"><a href="index.html">Home</a> <a href="index.html#index-by-chapter">단원별 목차</a> <a href="index.html#index-by-keyword">키워드 목차</a> <a href="Appendix.html">부록</a></div><div class="mobileview"><a id="navbutton">&#9776;</a></div></p>
    </header>



    <nav>
<p><a id="settingsopenbutton">&#9728;</a><a href="#top">&#9650;</a><a href="#bottom">&#9660;</a></p><div id="settingsmenubg"><div id="settingsmenu"><table><thead><tr><th colspan="2"><div class="align-right"> <span class="size-giant"><a id="settingsclosebutton">&#10006;</a></span></div></th></tr></thead><tbody><tr><td><div class="align-right">Theme:</div></td><td><div class="align-left"><a id="changethemebutton">Set Light Theme</a></div></td></tr><tr><td><div class="align-right">Horizontal Padding:</div></td><td><div class="align-left"><a id="growhorizontalbutton">Grow</a> <a id="shrinkhorizontalbutton">Shrink</a></div></td></tr><tr><td><div class="align-right">Font Size:</div></td><td><div class="align-left"><a id="growfontbutton">Grow</a> <a id="shrinkfontbutton">Shrink</a></div></td></tr><tr><td><div class="align-right">Settings:</div></td><td><div class="align-left"><a id="savesettingsbutton">Save All</a> <a id="discardsettingsbutton">Discard All</a></div></td></tr></tbody></table></div></div>
    </nav>


    <article class="markdown">
        <a id="top"></a>
<p>제가 쓰려고 만든 부록 페이지입니다. 아직 CoqIDE에도 익숙하지 않고 stdlib이 있는지도 모르겠어서 그때그때 코드를 복사 붙여넣기해서 쓰는 중입니다. 복사 붙여넣기를 쉽게 하기 위해서 모든 걸 모아둔 페이지입니다.</p><p><div class="toc"><ol type="1"><li><a href="#imp">Imp</a><ol type="1"><li><a href="#total-map">total map</a></li><li><a href="#언어-문법">언어 문법</a></li><li><a href="#equivalence">Equivalence</a></li><li><a href="#hoare-logic">Hoare Logic</a></li></ol></li><li><a href="#functional-programming">Functional Programming</a><ol type="1"><li><a href="#map-filter-fold">Map, Filter, Fold</a></li><li><a href="#currying">Currying</a></li></ol></li><li><a href="#natural-numbers">Natural Numbers</a></li><li><a href="#list">List</a></li></ol></div></p><h2 id="imp">Imp</h2><p>12장 이후에 쓰이는 예제들은 아래의 코드를 무식하게 복붙하고 시작합시다!</p><h3 id="total-map">total map</h3><pre class="fenced-code-block line-num-width-1"><code><span class="code-fence-row"><span class="code-fence-index">1</span><span class="code-fence-code">Require Export Coq.Strings.String.</span></span>
<span class="code-fence-row"><span class="code-fence-index">2</span><span class="code-fence-code"></span></span>
<span class="code-fence-row"><span class="code-fence-index">3</span><span class="code-fence-code">Definition total_map (A : Type) := string -&gt; A.</span></span>
<span class="code-fence-row"><span class="code-fence-index">4</span><span class="code-fence-code"></span></span>
<span class="code-fence-row"><span class="code-fence-index">5</span><span class="code-fence-code">Definition t_empty {A : Type} (v : A) : total_map A := (fun _ =&gt; v).</span></span>
<span class="code-fence-row"><span class="code-fence-index">6</span><span class="code-fence-code"></span></span>
<span class="code-fence-row"><span class="code-fence-index">7</span><span class="code-fence-code">Definition t_update {A : Type} (m : total_map A)</span></span>
<span class="code-fence-row"><span class="code-fence-index">8</span><span class="code-fence-code">                    (x : string) (v : A) :=</span></span>
<span class="code-fence-row"><span class="code-fence-index">9</span><span class="code-fence-code">  fun x&apos; =&gt; if String.eqb x x&apos; then v else m x&apos;.</span></span>
<span class="code-fence-row"><span class="code-fence-index">10</span><span class="code-fence-code"></span></span>
<span class="code-fence-row"><span class="code-fence-index">11</span><span class="code-fence-code">Notation &quot;&apos;_&apos; &apos;!-&gt;&apos; v&quot; := (t_empty v)</span></span>
<span class="code-fence-row"><span class="code-fence-index">12</span><span class="code-fence-code">  (at level 100, right associativity).</span></span>
<span class="code-fence-row"><span class="code-fence-index">13</span><span class="code-fence-code"></span></span>
<span class="code-fence-row"><span class="code-fence-index">14</span><span class="code-fence-code">Notation &quot;x &apos;!-&gt;&apos; v &apos;;&apos; m&quot; := (t_update m x v)</span></span>
<span class="code-fence-row"><span class="code-fence-index">15</span><span class="code-fence-code">  (at level 100, v at next level, right associativity).</span></span>
<span class="code-fence-row"><span class="code-fence-index">16</span><span class="code-fence-code"></span></span>
<span class="code-fence-row"><span class="code-fence-index">17</span><span class="code-fence-code">Lemma t_update_eq : forall (A : Type) (m : total_map A) x v,</span></span>
<span class="code-fence-row"><span class="code-fence-index">18</span><span class="code-fence-code">  (x !-&gt; v ; m) x = v.</span></span>
<span class="code-fence-row"><span class="code-fence-index">19</span><span class="code-fence-code">Proof.</span></span>
<span class="code-fence-row"><span class="code-fence-index">20</span><span class="code-fence-code">Admitted.</span></span>
<span class="code-fence-row"><span class="code-fence-index">21</span><span class="code-fence-code"></span></span>
<span class="code-fence-row"><span class="code-fence-index">22</span><span class="code-fence-code">Theorem t_update_neq : forall (A : Type) (m : total_map A) x1 x2 v,</span></span>
<span class="code-fence-row"><span class="code-fence-index">23</span><span class="code-fence-code">  x1 &lt;&gt; x2 -&gt;</span></span>
<span class="code-fence-row"><span class="code-fence-index">24</span><span class="code-fence-code">  (x1 !-&gt; v ; m) x2 = m x2.</span></span>
<span class="code-fence-row"><span class="code-fence-index">25</span><span class="code-fence-code">Proof.</span></span>
<span class="code-fence-row"><span class="code-fence-index">26</span><span class="code-fence-code">Admitted.</span></span>
</code><button onclick="copy_code_to_clipboard(0)" class="copy-fenced-code">Copy</button></pre><h3 id="언어-문법">언어 문법</h3><pre class="fenced-code-block line-num-width-2"><code><span class="code-fence-row"><span class="code-fence-index">1</span><span class="code-fence-code">From Coq Require Import Lia.</span></span>
<span class="code-fence-row"><span class="code-fence-index">2</span><span class="code-fence-code">From Coq Require Import Init.Nat.</span></span>
<span class="code-fence-row"><span class="code-fence-index">3</span><span class="code-fence-code">Definition state := total_map nat.</span></span>
<span class="code-fence-row"><span class="code-fence-index">4</span><span class="code-fence-code"></span></span>
<span class="code-fence-row"><span class="code-fence-index">5</span><span class="code-fence-code">Definition W : string := &quot;W&quot;.</span></span>
<span class="code-fence-row"><span class="code-fence-index">6</span><span class="code-fence-code">Definition X : string := &quot;X&quot;.</span></span>
<span class="code-fence-row"><span class="code-fence-index">7</span><span class="code-fence-code">Definition Y : string := &quot;Y&quot;.</span></span>
<span class="code-fence-row"><span class="code-fence-index">8</span><span class="code-fence-code">Definition Z : string := &quot;Z&quot;.</span></span>
<span class="code-fence-row"><span class="code-fence-index">9</span><span class="code-fence-code"></span></span>
<span class="code-fence-row"><span class="code-fence-index">10</span><span class="code-fence-code">Inductive aexp : Type :=</span></span>
<span class="code-fence-row"><span class="code-fence-index">11</span><span class="code-fence-code">  | ANum (n : nat)</span></span>
<span class="code-fence-row"><span class="code-fence-index">12</span><span class="code-fence-code">  | AId (x : string)</span></span>
<span class="code-fence-row"><span class="code-fence-index">13</span><span class="code-fence-code">  | APlus (a1 a2 : aexp)</span></span>
<span class="code-fence-row"><span class="code-fence-index">14</span><span class="code-fence-code">  | AMinus (a1 a2 : aexp)</span></span>
<span class="code-fence-row"><span class="code-fence-index">15</span><span class="code-fence-code">  | AMult (a1 a2 : aexp).</span></span>
<span class="code-fence-row"><span class="code-fence-index">16</span><span class="code-fence-code"></span></span>
<span class="code-fence-row"><span class="code-fence-index">17</span><span class="code-fence-code">Inductive bexp : Type :=</span></span>
<span class="code-fence-row"><span class="code-fence-index">18</span><span class="code-fence-code">  | BTrue</span></span>
<span class="code-fence-row"><span class="code-fence-index">19</span><span class="code-fence-code">  | BFalse</span></span>
<span class="code-fence-row"><span class="code-fence-index">20</span><span class="code-fence-code">  | BEq (a1 a2 : aexp)</span></span>
<span class="code-fence-row"><span class="code-fence-index">21</span><span class="code-fence-code">  | BNeq (a1 a2 : aexp)</span></span>
<span class="code-fence-row"><span class="code-fence-index">22</span><span class="code-fence-code">  | BLe (a1 a2 : aexp)</span></span>
<span class="code-fence-row"><span class="code-fence-index">23</span><span class="code-fence-code">  | BGt (a1 a2 : aexp)</span></span>
<span class="code-fence-row"><span class="code-fence-index">24</span><span class="code-fence-code">  | BNot (b : bexp)</span></span>
<span class="code-fence-row"><span class="code-fence-index">25</span><span class="code-fence-code">  | BAnd (b1 b2 : bexp).</span></span>
<span class="code-fence-row"><span class="code-fence-index">26</span><span class="code-fence-code"></span></span>
<span class="code-fence-row"><span class="code-fence-index">27</span><span class="code-fence-code">Inductive com : Type :=</span></span>
<span class="code-fence-row"><span class="code-fence-index">28</span><span class="code-fence-code">  | CSkip</span></span>
<span class="code-fence-row"><span class="code-fence-index">29</span><span class="code-fence-code">  | CAsgn (x : string) (a : aexp)</span></span>
<span class="code-fence-row"><span class="code-fence-index">30</span><span class="code-fence-code">  | CSeq (c1 c2 : com)</span></span>
<span class="code-fence-row"><span class="code-fence-index">31</span><span class="code-fence-code">  | CIf (b : bexp) (c1 c2 : com)</span></span>
<span class="code-fence-row"><span class="code-fence-index">32</span><span class="code-fence-code">  | CWhile (b : bexp) (c : com).</span></span>
<span class="code-fence-row"><span class="code-fence-index">33</span><span class="code-fence-code"></span></span>
<span class="code-fence-row"><span class="code-fence-index">34</span><span class="code-fence-code">Coercion AId : string &gt;-&gt; aexp.</span></span>
<span class="code-fence-row"><span class="code-fence-index">35</span><span class="code-fence-code">Coercion ANum : nat &gt;-&gt; aexp.</span></span>
<span class="code-fence-row"><span class="code-fence-index">36</span><span class="code-fence-code">Declare Custom Entry com.</span></span>
<span class="code-fence-row"><span class="code-fence-index">37</span><span class="code-fence-code">Declare Scope com_scope.</span></span>
<span class="code-fence-row"><span class="code-fence-index">38</span><span class="code-fence-code">Notation &quot;&lt;{ e }&gt;&quot; := e (at level 0, e custom com at level 99) : com_scope.</span></span>
<span class="code-fence-row"><span class="code-fence-index">39</span><span class="code-fence-code">Notation &quot;( x )&quot; := x (in custom com, x at level 99) : com_scope.</span></span>
<span class="code-fence-row"><span class="code-fence-index">40</span><span class="code-fence-code">Notation &quot;x&quot; := x (in custom com at level 0, x constr at level 0) : com_scope.</span></span>
<span class="code-fence-row"><span class="code-fence-index">41</span><span class="code-fence-code">Notation &quot;f x .. y&quot; := (.. (f x) .. y)</span></span>
<span class="code-fence-row"><span class="code-fence-index">42</span><span class="code-fence-code">                  (in custom com at level 0, only parsing,</span></span>
<span class="code-fence-row"><span class="code-fence-index">43</span><span class="code-fence-code">                  f constr at level 0, x constr at level 9,</span></span>
<span class="code-fence-row"><span class="code-fence-index">44</span><span class="code-fence-code">                  y constr at level 9) : com_scope.</span></span>
<span class="code-fence-row"><span class="code-fence-index">45</span><span class="code-fence-code">Notation &quot;x + y&quot; := (APlus x y) (in custom com at level 50, left associativity).</span></span>
<span class="code-fence-row"><span class="code-fence-index">46</span><span class="code-fence-code">Notation &quot;x - y&quot; := (AMinus x y) (in custom com at level 50, left associativity).</span></span>
<span class="code-fence-row"><span class="code-fence-index">47</span><span class="code-fence-code">Notation &quot;x * y&quot; := (AMult x y) (in custom com at level 40, left associativity).</span></span>
<span class="code-fence-row"><span class="code-fence-index">48</span><span class="code-fence-code">Notation &quot;&apos;true&apos;&quot; := true (at level 1).</span></span>
<span class="code-fence-row"><span class="code-fence-index">49</span><span class="code-fence-code">Notation &quot;&apos;true&apos;&quot; := BTrue (in custom com at level 0).</span></span>
<span class="code-fence-row"><span class="code-fence-index">50</span><span class="code-fence-code">Notation &quot;&apos;false&apos;&quot; := false (at level 1).</span></span>
<span class="code-fence-row"><span class="code-fence-index">51</span><span class="code-fence-code">Notation &quot;&apos;false&apos;&quot; := BFalse (in custom com at level 0).</span></span>
<span class="code-fence-row"><span class="code-fence-index">52</span><span class="code-fence-code">Notation &quot;x &lt;= y&quot; := (BLe x y) (in custom com at level 70, no associativity).</span></span>
<span class="code-fence-row"><span class="code-fence-index">53</span><span class="code-fence-code">Notation &quot;x &gt; y&quot; := (BGt x y) (in custom com at level 70, no associativity).</span></span>
<span class="code-fence-row"><span class="code-fence-index">54</span><span class="code-fence-code">Notation &quot;x = y&quot; := (BEq x y) (in custom com at level 70, no associativity).</span></span>
<span class="code-fence-row"><span class="code-fence-index">55</span><span class="code-fence-code">Notation &quot;x &lt;&gt; y&quot; := (BNeq x y) (in custom com at level 70, no associativity).</span></span>
<span class="code-fence-row"><span class="code-fence-index">56</span><span class="code-fence-code">Notation &quot;x &amp;&amp; y&quot; := (BAnd x y) (in custom com at level 80, left associativity).</span></span>
<span class="code-fence-row"><span class="code-fence-index">57</span><span class="code-fence-code">Notation &quot;&apos;~&apos; b&quot; := (BNot b) (in custom com at level 75, right associativity).</span></span>
<span class="code-fence-row"><span class="code-fence-index">58</span><span class="code-fence-code">Open Scope com_scope.</span></span>
<span class="code-fence-row"><span class="code-fence-index">59</span><span class="code-fence-code"></span></span>
<span class="code-fence-row"><span class="code-fence-index">60</span><span class="code-fence-code">Notation &quot;&apos;skip&apos;&quot; :=</span></span>
<span class="code-fence-row"><span class="code-fence-index">61</span><span class="code-fence-code">         CSkip (in custom com at level 0) : com_scope.</span></span>
<span class="code-fence-row"><span class="code-fence-index">62</span><span class="code-fence-code">Notation &quot;x := y&quot; :=</span></span>
<span class="code-fence-row"><span class="code-fence-index">63</span><span class="code-fence-code">         (CAsgn x y)</span></span>
<span class="code-fence-row"><span class="code-fence-index">64</span><span class="code-fence-code">            (in custom com at level 0, x constr at level 0,</span></span>
<span class="code-fence-row"><span class="code-fence-index">65</span><span class="code-fence-code">             y at level 85, no associativity) : com_scope.</span></span>
<span class="code-fence-row"><span class="code-fence-index">66</span><span class="code-fence-code">Notation &quot;x ; y&quot; :=</span></span>
<span class="code-fence-row"><span class="code-fence-index">67</span><span class="code-fence-code">         (CSeq x y)</span></span>
<span class="code-fence-row"><span class="code-fence-index">68</span><span class="code-fence-code">           (in custom com at level 90, right associativity) : com_scope.</span></span>
<span class="code-fence-row"><span class="code-fence-index">69</span><span class="code-fence-code">Notation &quot;&apos;if&apos; x &apos;then&apos; y &apos;else&apos; z &apos;end&apos;&quot; :=</span></span>
<span class="code-fence-row"><span class="code-fence-index">70</span><span class="code-fence-code">         (CIf x y z)</span></span>
<span class="code-fence-row"><span class="code-fence-index">71</span><span class="code-fence-code">           (in custom com at level 89, x at level 99,</span></span>
<span class="code-fence-row"><span class="code-fence-index">72</span><span class="code-fence-code">            y at level 99, z at level 99) : com_scope.</span></span>
<span class="code-fence-row"><span class="code-fence-index">73</span><span class="code-fence-code">Notation &quot;&apos;while&apos; x &apos;do&apos; y &apos;end&apos;&quot; :=</span></span>
<span class="code-fence-row"><span class="code-fence-index">74</span><span class="code-fence-code">         (CWhile x y)</span></span>
<span class="code-fence-row"><span class="code-fence-index">75</span><span class="code-fence-code">            (in custom com at level 89, x at level 99, y at level 99) : com_scope.</span></span>
<span class="code-fence-row"><span class="code-fence-index">76</span><span class="code-fence-code"></span></span>
<span class="code-fence-row"><span class="code-fence-index">77</span><span class="code-fence-code">Fixpoint aeval (st : state) (a : aexp) : nat :=</span></span>
<span class="code-fence-row"><span class="code-fence-index">78</span><span class="code-fence-code">  match a with</span></span>
<span class="code-fence-row"><span class="code-fence-index">79</span><span class="code-fence-code">  | ANum n =&gt; n</span></span>
<span class="code-fence-row"><span class="code-fence-index">80</span><span class="code-fence-code">  | AId x =&gt; st x</span></span>
<span class="code-fence-row"><span class="code-fence-index">81</span><span class="code-fence-code">  | &lt;{a1 + a2}&gt; =&gt; (aeval st a1) + (aeval st a2)</span></span>
<span class="code-fence-row"><span class="code-fence-index">82</span><span class="code-fence-code">  | &lt;{a1 - a2}&gt; =&gt; (aeval st a1) - (aeval st a2)</span></span>
<span class="code-fence-row"><span class="code-fence-index">83</span><span class="code-fence-code">  | &lt;{a1 * a2}&gt; =&gt; (aeval st a1) * (aeval st a2)</span></span>
<span class="code-fence-row"><span class="code-fence-index">84</span><span class="code-fence-code">  end.</span></span>
<span class="code-fence-row"><span class="code-fence-index">85</span><span class="code-fence-code"></span></span>
<span class="code-fence-row"><span class="code-fence-index">86</span><span class="code-fence-code">Fixpoint beval (st : state) (b : bexp) : bool :=</span></span>
<span class="code-fence-row"><span class="code-fence-index">87</span><span class="code-fence-code">  match b with</span></span>
<span class="code-fence-row"><span class="code-fence-index">88</span><span class="code-fence-code">  | &lt;{true}&gt; =&gt; true</span></span>
<span class="code-fence-row"><span class="code-fence-index">89</span><span class="code-fence-code">  | &lt;{false}&gt; =&gt; false</span></span>
<span class="code-fence-row"><span class="code-fence-index">90</span><span class="code-fence-code">  | &lt;{a1 = a2}&gt; =&gt; (aeval st a1) =? (aeval st a2)</span></span>
<span class="code-fence-row"><span class="code-fence-index">91</span><span class="code-fence-code">  | &lt;{a1 &lt;&gt; a2}&gt; =&gt; negb ((aeval st a1) =? (aeval st a2))</span></span>
<span class="code-fence-row"><span class="code-fence-index">92</span><span class="code-fence-code">  | &lt;{a1 &lt;= a2}&gt; =&gt; (aeval st a1) &lt;=? (aeval st a2)</span></span>
<span class="code-fence-row"><span class="code-fence-index">93</span><span class="code-fence-code">  | &lt;{a1 &gt; a2}&gt; =&gt; negb ((aeval st a1) &lt;=? (aeval st a2))</span></span>
<span class="code-fence-row"><span class="code-fence-index">94</span><span class="code-fence-code">  | &lt;{~ b1}&gt; =&gt; negb (beval st b1)</span></span>
<span class="code-fence-row"><span class="code-fence-index">95</span><span class="code-fence-code">  | &lt;{b1 &amp;&amp; b2}&gt; =&gt; andb (beval st b1) (beval st b2)</span></span>
<span class="code-fence-row"><span class="code-fence-index">96</span><span class="code-fence-code">  end.</span></span>
<span class="code-fence-row"><span class="code-fence-index">97</span><span class="code-fence-code"></span></span>
<span class="code-fence-row"><span class="code-fence-index">98</span><span class="code-fence-code">Reserved Notation</span></span>
<span class="code-fence-row"><span class="code-fence-index">99</span><span class="code-fence-code">         &quot;st &apos;=[&apos; c &apos;]=&gt;&apos; st&apos;&quot;</span></span>
<span class="code-fence-row"><span class="code-fence-index">100</span><span class="code-fence-code">         (at level 40, c custom com at level 99,</span></span>
<span class="code-fence-row"><span class="code-fence-index">101</span><span class="code-fence-code">          st constr, st&apos; constr at next level).</span></span>
<span class="code-fence-row"><span class="code-fence-index">102</span><span class="code-fence-code">Inductive ceval : com -&gt; state -&gt; state -&gt; Prop :=</span></span>
<span class="code-fence-row"><span class="code-fence-index">103</span><span class="code-fence-code">  | E_Skip : forall st,</span></span>
<span class="code-fence-row"><span class="code-fence-index">104</span><span class="code-fence-code">      st =[ skip ]=&gt; st</span></span>
<span class="code-fence-row"><span class="code-fence-index">105</span><span class="code-fence-code">  | E_Asgn : forall st a n x,</span></span>
<span class="code-fence-row"><span class="code-fence-index">106</span><span class="code-fence-code">      aeval st a = n -&gt;</span></span>
<span class="code-fence-row"><span class="code-fence-index">107</span><span class="code-fence-code">      st =[ x := a ]=&gt; (x !-&gt; n ; st)</span></span>
<span class="code-fence-row"><span class="code-fence-index">108</span><span class="code-fence-code">  | E_Seq : forall c1 c2 st st&apos; st&apos;&apos;,</span></span>
<span class="code-fence-row"><span class="code-fence-index">109</span><span class="code-fence-code">      st =[ c1 ]=&gt; st&apos; -&gt;</span></span>
<span class="code-fence-row"><span class="code-fence-index">110</span><span class="code-fence-code">      st&apos; =[ c2 ]=&gt; st&apos;&apos; -&gt;</span></span>
<span class="code-fence-row"><span class="code-fence-index">111</span><span class="code-fence-code">      st =[ c1 ; c2 ]=&gt; st&apos;&apos;</span></span>
<span class="code-fence-row"><span class="code-fence-index">112</span><span class="code-fence-code">  | E_IfTrue : forall st st&apos; b c1 c2,</span></span>
<span class="code-fence-row"><span class="code-fence-index">113</span><span class="code-fence-code">      beval st b = true -&gt;</span></span>
<span class="code-fence-row"><span class="code-fence-index">114</span><span class="code-fence-code">      st =[ c1 ]=&gt; st&apos; -&gt;</span></span>
<span class="code-fence-row"><span class="code-fence-index">115</span><span class="code-fence-code">      st =[ if b then c1 else c2 end]=&gt; st&apos;</span></span>
<span class="code-fence-row"><span class="code-fence-index">116</span><span class="code-fence-code">  | E_IfFalse : forall st st&apos; b c1 c2,</span></span>
<span class="code-fence-row"><span class="code-fence-index">117</span><span class="code-fence-code">      beval st b = false -&gt;</span></span>
<span class="code-fence-row"><span class="code-fence-index">118</span><span class="code-fence-code">      st =[ c2 ]=&gt; st&apos; -&gt;</span></span>
<span class="code-fence-row"><span class="code-fence-index">119</span><span class="code-fence-code">      st =[ if b then c1 else c2 end]=&gt; st&apos;</span></span>
<span class="code-fence-row"><span class="code-fence-index">120</span><span class="code-fence-code">  | E_WhileFalse : forall b st c,</span></span>
<span class="code-fence-row"><span class="code-fence-index">121</span><span class="code-fence-code">      beval st b = false -&gt;</span></span>
<span class="code-fence-row"><span class="code-fence-index">122</span><span class="code-fence-code">      st =[ while b do c end ]=&gt; st</span></span>
<span class="code-fence-row"><span class="code-fence-index">123</span><span class="code-fence-code">  | E_WhileTrue : forall st st&apos; st&apos;&apos; b c,</span></span>
<span class="code-fence-row"><span class="code-fence-index">124</span><span class="code-fence-code">      beval st b = true -&gt;</span></span>
<span class="code-fence-row"><span class="code-fence-index">125</span><span class="code-fence-code">      st =[ c ]=&gt; st&apos; -&gt;</span></span>
<span class="code-fence-row"><span class="code-fence-index">126</span><span class="code-fence-code">      st&apos; =[ while b do c end ]=&gt; st&apos;&apos; -&gt;</span></span>
<span class="code-fence-row"><span class="code-fence-index">127</span><span class="code-fence-code">      st =[ while b do c end ]=&gt; st&apos;&apos;</span></span>
<span class="code-fence-row"><span class="code-fence-index">128</span><span class="code-fence-code"></span></span>
<span class="code-fence-row"><span class="code-fence-index">129</span><span class="code-fence-code">  where &quot;st =[ c ]=&gt; st&apos;&quot; := (ceval c st st&apos;).</span></span>
</code><button onclick="copy_code_to_clipboard(1)" class="copy-fenced-code">Copy</button></pre><h3 id="equivalence">Equivalence</h3><pre class="fenced-code-block line-num-width-2"><code><span class="code-fence-row"><span class="code-fence-index">1</span><span class="code-fence-code"><span class="color-violet">Definition</span> <span class="color-aqua">aequiv</span> <span class="color-white">(</span><span class="color-red">a1</span> <span class="color-red">a2</span> <span class="color-white">:</span> <span class="color-violet">aexp</span><span class="color-white">)</span> <span class="color-white">:</span> <span class="color-white">Prop</span> <span class="color-white">:=</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">2</span><span class="code-fence-code">  <span class="color-violet">forall</span> <span class="color-white">(</span><span class="color-red">st</span> <span class="color-white">:</span> <span class="color-violet">state</span><span class="color-white">)</span><span class="color-white">,</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">3</span><span class="code-fence-code">    <span class="color-red">aeval</span> <span class="color-red">st</span> <span class="color-red">a1</span> <span class="color-white">=</span> <span class="color-red">aeval</span> <span class="color-red">st</span> <span class="color-red">a2</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">4</span><span class="code-fence-code"></span></span>
<span class="code-fence-row"><span class="code-fence-index">5</span><span class="code-fence-code"><span class="color-violet">Definition</span> <span class="color-aqua">bequiv</span> <span class="color-white">(</span><span class="color-red">b1</span> <span class="color-red">b2</span> <span class="color-white">:</span> <span class="color-violet">bexp</span><span class="color-white">)</span> <span class="color-white">:</span> <span class="color-white">Prop</span> <span class="color-white">:=</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">6</span><span class="code-fence-code">  <span class="color-violet">forall</span> <span class="color-white">(</span><span class="color-red">st</span> <span class="color-white">:</span> <span class="color-violet">state</span><span class="color-white">)</span><span class="color-white">,</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">7</span><span class="code-fence-code">    <span class="color-red">beval</span> <span class="color-red">st</span> <span class="color-red">b1</span> <span class="color-white">=</span> <span class="color-red">beval</span> <span class="color-red">st</span> <span class="color-red">b2</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">8</span><span class="code-fence-code"></span></span>
<span class="code-fence-row"><span class="code-fence-index">9</span><span class="code-fence-code"><span class="color-violet">Definition</span> <span class="color-aqua">cequiv</span> <span class="color-white">(</span><span class="color-red">c1</span> <span class="color-red">c2</span> <span class="color-white">:</span> <span class="color-violet">com</span><span class="color-white">)</span> <span class="color-white">:</span> <span class="color-white">Prop</span> <span class="color-white">:=</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">10</span><span class="code-fence-code">  <span class="color-violet">forall</span> <span class="color-white">(</span><span class="color-red">st</span> <span class="color-red">st&apos;</span> <span class="color-white">:</span> <span class="color-violet">state</span><span class="color-white">)</span><span class="color-white">,</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">11</span><span class="code-fence-code">    <span class="color-white">(</span><span class="color-red">st</span> <span class="color-white">=</span><span class="color-white">[</span> <span class="color-red">c1</span> <span class="color-white">]</span><span class="color-white">=</span><span class="color-white">&gt;</span> <span class="color-red">st&apos;</span><span class="color-white">)</span> <span class="color-white">&lt;</span><span class="color-white">-</span><span class="color-white">&gt;</span> <span class="color-white">(</span><span class="color-red">st</span> <span class="color-white">=</span><span class="color-white">[</span> <span class="color-red">c2</span> <span class="color-white">]</span><span class="color-white">=</span><span class="color-white">&gt;</span> <span class="color-red">st&apos;</span><span class="color-white">)</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">12</span><span class="code-fence-code"></span></span>
<span class="code-fence-row"><span class="code-fence-index">13</span><span class="code-fence-code"><span class="color-violet">Theorem</span> <span class="color-aqua">if_true</span><span class="color-white">:</span> <span class="color-violet">forall</span> <span class="color-red">b</span> <span class="color-red">c1</span> <span class="color-red">c2</span><span class="color-white">,</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">14</span><span class="code-fence-code">  <span class="color-red">bequiv</span> <span class="color-red">b</span> <span class="color-white">&lt;</span><span class="color-white">{</span><span class="color-red">true</span><span class="color-white">}</span><span class="color-white">&gt;</span> <span class="color-white">-</span><span class="color-white">&gt;</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">15</span><span class="code-fence-code">  <span class="color-red">cequiv</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">16</span><span class="code-fence-code">    <span class="color-white">&lt;</span><span class="color-white">{</span> <span class="color-violet">if</span> <span class="color-red">b</span> <span class="color-violet">then</span> <span class="color-red">c1</span> <span class="color-violet">else</span> <span class="color-red">c2</span> <span class="color-violet">end</span> <span class="color-white">}</span><span class="color-white">&gt;</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">17</span><span class="code-fence-code">    <span class="color-red">c1</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">18</span><span class="code-fence-code"><span class="color-violet">Proof</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">19</span><span class="code-fence-code">  <span class="color-emerald">intros</span> <span class="color-red">b</span> <span class="color-red">c1</span> <span class="color-red">c2</span> <span class="color-red">H</span> <span class="color-red">st</span> <span class="color-red">st&apos;</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">20</span><span class="code-fence-code">  <span class="color-emerald">split</span><span class="color-white">;</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">21</span><span class="code-fence-code">  <span class="color-emerald">intros</span> <span class="color-red">H2</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">22</span><span class="code-fence-code">  <span class="color-aqua">-</span> <span class="color-gray">(*</span><span class="color-gray"> if -&gt; c1 </span><span class="color-gray">*)</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">23</span><span class="code-fence-code">    <span class="color-emerald">inversion</span> <span class="color-red">H2</span><span class="color-white">;</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">24</span><span class="code-fence-code">    <span class="color-emerald">subst</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">25</span><span class="code-fence-code">    <span class="color-aqua">+</span> <span class="color-gray">(*</span><span class="color-gray"> H7: st =[c1]=&gt; st&apos; </span><span class="color-gray">*)</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">26</span><span class="code-fence-code">      <span class="color-emerald">assumption</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">27</span><span class="code-fence-code">    <span class="color-aqua">+</span> <span class="color-gray">(*</span><span class="color-gray"> H7: st =[c2]=&gt; st&apos; </span><span class="color-gray">*)</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">28</span><span class="code-fence-code">      <span class="color-emerald">rewrite</span> <span class="color-red">H</span> <span class="color-violet">in</span> <span class="color-red">H6</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">29</span><span class="code-fence-code">      <span class="color-emerald">unfold</span> <span class="color-red">beval</span> <span class="color-violet">in</span> <span class="color-red">H6</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">30</span><span class="code-fence-code">      <span class="color-emerald">discriminate</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">31</span><span class="code-fence-code">  <span class="color-aqua">-</span> <span class="color-gray">(*</span><span class="color-gray"> c1 -&gt; if </span><span class="color-gray">*)</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">32</span><span class="code-fence-code">    <span class="color-emerald">apply</span> <span class="color-red">E_IfTrue</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">33</span><span class="code-fence-code">    <span class="color-aqua">+</span> <span class="color-gray">(*</span><span class="color-gray"> b = true </span><span class="color-gray">*)</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">34</span><span class="code-fence-code">      <span class="color-emerald">apply</span> <span class="color-red">H</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">35</span><span class="code-fence-code">    <span class="color-aqua">+</span> <span class="color-gray">(*</span><span class="color-gray"> st =[c1]=&gt; st&apos; </span><span class="color-gray">*)</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">36</span><span class="code-fence-code">      <span class="color-emerald">assumption</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">37</span><span class="code-fence-code">  <span class="color-violet">Qed</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">38</span><span class="code-fence-code"></span></span>
<span class="code-fence-row"><span class="code-fence-index">39</span><span class="code-fence-code"><span class="color-violet">Theorem</span> <span class="color-aqua">if_false</span><span class="color-white">:</span> <span class="color-violet">forall</span> <span class="color-red">b</span> <span class="color-red">c1</span> <span class="color-red">c2</span><span class="color-white">,</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">40</span><span class="code-fence-code">  <span class="color-red">bequiv</span> <span class="color-red">b</span> <span class="color-white">&lt;</span><span class="color-white">{</span><span class="color-red">false</span><span class="color-white">}</span><span class="color-white">&gt;</span> <span class="color-white">-</span><span class="color-white">&gt;</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">41</span><span class="code-fence-code">  <span class="color-red">cequiv</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">42</span><span class="code-fence-code">    <span class="color-white">&lt;</span><span class="color-white">{</span> <span class="color-violet">if</span> <span class="color-red">b</span> <span class="color-violet">then</span> <span class="color-red">c1</span> <span class="color-violet">else</span> <span class="color-red">c2</span> <span class="color-violet">end</span> <span class="color-white">}</span><span class="color-white">&gt;</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">43</span><span class="code-fence-code">    <span class="color-red">c2</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">44</span><span class="code-fence-code"><span class="color-violet">Proof</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">45</span><span class="code-fence-code">  <span class="color-emerald">intros</span> <span class="color-red">b</span> <span class="color-red">c1</span> <span class="color-red">c2</span> <span class="color-red">H</span> <span class="color-red">st</span> <span class="color-red">st&apos;</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">46</span><span class="code-fence-code">  <span class="color-emerald">split</span><span class="color-white">;</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">47</span><span class="code-fence-code">  <span class="color-emerald">intros</span> <span class="color-red">H2</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">48</span><span class="code-fence-code">  <span class="color-aqua">-</span> <span class="color-gray">(*</span><span class="color-gray"> if -&gt; c2 </span><span class="color-gray">*)</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">49</span><span class="code-fence-code">    <span class="color-emerald">inversion</span> <span class="color-red">H2</span><span class="color-white">;</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">50</span><span class="code-fence-code">    <span class="color-emerald">subst</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">51</span><span class="code-fence-code">    <span class="color-aqua">+</span> <span class="color-gray">(*</span><span class="color-gray"> H7: st =[ c1 ]=&gt; st&apos; </span><span class="color-gray">*)</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">52</span><span class="code-fence-code">      <span class="color-emerald">rewrite</span> <span class="color-red">H</span> <span class="color-violet">in</span> <span class="color-red">H6</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">53</span><span class="code-fence-code">      <span class="color-emerald">unfold</span> <span class="color-red">beval</span> <span class="color-violet">in</span> <span class="color-red">H6</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">54</span><span class="code-fence-code">      <span class="color-emerald">discriminate</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">55</span><span class="code-fence-code">    <span class="color-aqua">+</span> <span class="color-gray">(*</span><span class="color-gray"> H7: st =[c2]=&gt; st&apos; </span><span class="color-gray">*)</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">56</span><span class="code-fence-code">      <span class="color-emerald">assumption</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">57</span><span class="code-fence-code">  <span class="color-aqua">-</span> <span class="color-gray">(*</span><span class="color-gray"> c2 -&gt; if </span><span class="color-gray">*)</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">58</span><span class="code-fence-code">    <span class="color-emerald">apply</span> <span class="color-red">E_IfFalse</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">59</span><span class="code-fence-code">    <span class="color-aqua">+</span> <span class="color-gray">(*</span><span class="color-gray"> b = false </span><span class="color-gray">*)</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">60</span><span class="code-fence-code">      <span class="color-emerald">apply</span> <span class="color-red">H</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">61</span><span class="code-fence-code">    <span class="color-aqua">+</span> <span class="color-gray">(*</span><span class="color-gray"> st =[c2]=&gt; st&apos; </span><span class="color-gray">*)</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">62</span><span class="code-fence-code">      <span class="color-emerald">assumption</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">63</span><span class="code-fence-code">  <span class="color-violet">Qed</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">64</span><span class="code-fence-code"></span></span>
<span class="code-fence-row"><span class="code-fence-index">65</span><span class="code-fence-code"><span class="color-violet">Theorem</span> <span class="color-aqua">while_false</span> <span class="color-white">:</span> <span class="color-violet">forall</span> <span class="color-red">b</span> <span class="color-red">c</span><span class="color-white">,</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">66</span><span class="code-fence-code">  <span class="color-red">bequiv</span> <span class="color-red">b</span> <span class="color-white">&lt;</span><span class="color-white">{</span><span class="color-red">false</span><span class="color-white">}</span><span class="color-white">&gt;</span> <span class="color-white">-</span><span class="color-white">&gt;</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">67</span><span class="code-fence-code">  <span class="color-red">cequiv</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">68</span><span class="code-fence-code">    <span class="color-white">&lt;</span><span class="color-white">{</span> <span class="color-red">while</span> <span class="color-red">b</span> <span class="color-red">do</span> <span class="color-red">c</span> <span class="color-violet">end</span> <span class="color-white">}</span><span class="color-white">&gt;</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">69</span><span class="code-fence-code">    <span class="color-white">&lt;</span><span class="color-white">{</span> <span class="color-red">skip</span> <span class="color-white">}</span><span class="color-white">&gt;</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">70</span><span class="code-fence-code"><span class="color-violet">Proof</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">71</span><span class="code-fence-code">  <span class="color-emerald">intros</span> <span class="color-red">b</span> <span class="color-red">c</span> <span class="color-red">Hb</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">72</span><span class="code-fence-code">  <span class="color-emerald">split</span><span class="color-white">;</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">73</span><span class="code-fence-code">  <span class="color-emerald">intros</span> <span class="color-red">H</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">74</span><span class="code-fence-code">  <span class="color-aqua">-</span> <span class="color-gray">(*</span><span class="color-gray"> while -&gt; skip </span><span class="color-gray">*)</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">75</span><span class="code-fence-code">    <span class="color-emerald">inversion</span> <span class="color-red">H</span><span class="color-white">. </span><span class="color-emerald">subst</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">76</span><span class="code-fence-code">    <span class="color-aqua">+</span> <span class="color-gray">(*</span><span class="color-gray"> E_WhileFalse </span><span class="color-gray">*)</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">77</span><span class="code-fence-code">      <span class="color-emerald">apply</span> <span class="color-red">E_Skip</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">78</span><span class="code-fence-code">    <span class="color-aqua">+</span> <span class="color-gray">(*</span><span class="color-gray"> E_WhileTrue </span><span class="color-gray">*)</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">79</span><span class="code-fence-code">      <span class="color-emerald">rewrite</span> <span class="color-red">Hb</span> <span class="color-violet">in</span> <span class="color-red">H2</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">80</span><span class="code-fence-code">      <span class="color-emerald">discriminate</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">81</span><span class="code-fence-code">  <span class="color-aqua">-</span> <span class="color-gray">(*</span><span class="color-gray"> skip -&gt; while </span><span class="color-gray">*)</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">82</span><span class="code-fence-code">    <span class="color-emerald">inversion</span> <span class="color-red">H</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">83</span><span class="code-fence-code">    <span class="color-emerald">subst</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">84</span><span class="code-fence-code">    <span class="color-emerald">apply</span> <span class="color-red">E_WhileFalse</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">85</span><span class="code-fence-code">    <span class="color-emerald">apply</span> <span class="color-red">Hb</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">86</span><span class="code-fence-code">  <span class="color-violet">Qed</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">87</span><span class="code-fence-code"></span></span>
<span class="code-fence-row"><span class="code-fence-index">88</span><span class="code-fence-code"><span class="color-violet">Lemma</span> <span class="color-aqua">while_true_nonterm</span> <span class="color-white">:</span> <span class="color-violet">forall</span> <span class="color-red">b</span> <span class="color-red">c</span> <span class="color-red">st</span> <span class="color-red">st&apos;</span><span class="color-white">,</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">89</span><span class="code-fence-code">  <span class="color-red">bequiv</span> <span class="color-red">b</span> <span class="color-white">&lt;</span><span class="color-white">{</span><span class="color-red">true</span><span class="color-white">}</span><span class="color-white">&gt;</span> <span class="color-white">-</span><span class="color-white">&gt;</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">90</span><span class="code-fence-code">  <span class="color-white">~</span><span class="color-white">(</span> <span class="color-red">st</span> <span class="color-white">=</span><span class="color-white">[</span> <span class="color-red">while</span> <span class="color-red">b</span> <span class="color-red">do</span> <span class="color-red">c</span> <span class="color-violet">end</span> <span class="color-white">]</span><span class="color-white">=</span><span class="color-white">&gt;</span> <span class="color-red">st&apos;</span> <span class="color-white">)</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">91</span><span class="code-fence-code"><span class="color-violet">Proof</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">92</span><span class="code-fence-code">  <span class="color-emerald">intros</span> <span class="color-red">b</span> <span class="color-red">c</span> <span class="color-red">st</span> <span class="color-red">st&apos;</span> <span class="color-red">Hb</span> <span class="color-red">H</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">93</span><span class="code-fence-code">  <span class="color-emerald">remember</span> <span class="color-white">&lt;</span><span class="color-white">{</span> <span class="color-red">while</span> <span class="color-red">b</span> <span class="color-red">do</span> <span class="color-red">c</span> <span class="color-violet">end</span> <span class="color-white">}</span><span class="color-white">&gt;</span> <span class="color-violet">as</span> <span class="color-red">cw</span> <span class="color-red">eqn</span><span class="color-white">:</span><span class="color-red">Heqcw</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">94</span><span class="code-fence-code">  <span class="color-emerald">induction</span> <span class="color-red">H</span><span class="color-white">;</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">95</span><span class="code-fence-code">  <span class="color-emerald">inversion</span> <span class="color-red">Heqcw</span><span class="color-white">;</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">96</span><span class="code-fence-code">  <span class="color-emerald">subst</span><span class="color-white">;</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">97</span><span class="code-fence-code">  <span class="color-emerald">clear</span> <span class="color-red">Heqcw</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">98</span><span class="code-fence-code">  <span class="color-gray">(*</span><span class="color-gray"> The two interesting cases are the ones for while loops: </span><span class="color-gray">*)</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">99</span><span class="code-fence-code">  <span class="color-aqua">-</span> <span class="color-gray">(*</span><span class="color-gray"> E_WhileFalse </span><span class="color-gray">*)</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">100</span><span class="code-fence-code">    <span class="color-emerald">unfold</span> <span class="color-red">bequiv</span> <span class="color-violet">in</span> <span class="color-red">Hb</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">101</span><span class="code-fence-code">    <span class="color-gray">(*</span><span class="color-gray"> rewrite is able to instantiate the quantifier in st </span><span class="color-gray">*)</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">102</span><span class="code-fence-code">    <span class="color-emerald">rewrite</span> <span class="color-red">Hb</span> <span class="color-violet">in</span> <span class="color-red">H</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">103</span><span class="code-fence-code">    <span class="color-emerald">discriminate</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">104</span><span class="code-fence-code">  <span class="color-aqua">-</span> <span class="color-gray">(*</span><span class="color-gray"> E_WhileTrue </span><span class="color-gray">*)</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">105</span><span class="code-fence-code">    <span class="color-emerald">apply</span> <span class="color-red">IHceval2</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">106</span><span class="code-fence-code">    <span class="color-emerald">reflexivity</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">107</span><span class="code-fence-code">  <span class="color-violet">Qed</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">108</span><span class="code-fence-code"></span></span>
<span class="code-fence-row"><span class="code-fence-index">109</span><span class="code-fence-code"><span class="color-violet">Theorem</span> <span class="color-aqua">while_true</span> <span class="color-white">:</span> <span class="color-violet">forall</span> <span class="color-red">b</span> <span class="color-red">c</span><span class="color-white">,</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">110</span><span class="code-fence-code">  <span class="color-red">bequiv</span> <span class="color-red">b</span> <span class="color-white">&lt;</span><span class="color-white">{</span><span class="color-red">true</span><span class="color-white">}</span><span class="color-white">&gt;</span> <span class="color-white">-</span><span class="color-white">&gt;</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">111</span><span class="code-fence-code">  <span class="color-red">cequiv</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">112</span><span class="code-fence-code">    <span class="color-white">&lt;</span><span class="color-white">{</span> <span class="color-red">while</span> <span class="color-red">b</span> <span class="color-red">do</span> <span class="color-red">c</span> <span class="color-violet">end</span> <span class="color-white">}</span><span class="color-white">&gt;</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">113</span><span class="code-fence-code">    <span class="color-white">&lt;</span><span class="color-white">{</span> <span class="color-red">while</span> <span class="color-red">true</span> <span class="color-red">do</span> <span class="color-red">skip</span> <span class="color-violet">end</span> <span class="color-white">}</span><span class="color-white">&gt;</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">114</span><span class="code-fence-code"><span class="color-violet">Proof</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">115</span><span class="code-fence-code">  <span class="color-emerald">intros</span> <span class="color-red">b</span> <span class="color-red">c</span> <span class="color-red">H</span> <span class="color-red">st</span> <span class="color-red">st&apos;</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">116</span><span class="code-fence-code">  <span class="color-emerald">split</span><span class="color-white">;</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">117</span><span class="code-fence-code">  <span class="color-emerald">intros</span> <span class="color-red">H2</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">118</span><span class="code-fence-code">  <span class="color-aqua">-</span> <span class="color-gray">(*</span><span class="color-gray"> true -&gt; nonterm </span><span class="color-gray">*)</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">119</span><span class="code-fence-code">    <span class="color-emerald">apply</span> <span class="color-white">(</span><span class="color-red">while_true_nonterm</span> <span class="color-red">b</span> <span class="color-red">c</span> <span class="color-red">st</span> <span class="color-red">st&apos;</span><span class="color-white">)</span> <span class="color-violet">in</span> <span class="color-red">H</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">120</span><span class="code-fence-code">    <span class="color-emerald">apply</span> <span class="color-red">H</span> <span class="color-violet">in</span> <span class="color-red">H2</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">121</span><span class="code-fence-code">    <span class="color-emerald">destruct</span> <span class="color-red">H2</span><span class="color-white">. </span><span class="color-gray">(*</span><span class="color-gray"> H2: False </span><span class="color-gray">*)</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">122</span><span class="code-fence-code">  <span class="color-aqua">-</span> <span class="color-gray">(*</span><span class="color-gray"> nonterm -&gt; true </span><span class="color-gray">*)</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">123</span><span class="code-fence-code">    <span class="color-emerald">destruct</span> <span class="color-red">b</span><span class="color-white">;</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">124</span><span class="code-fence-code">    <span class="color-emerald">remember</span> <span class="color-white">&lt;</span><span class="color-white">{</span><span class="color-red">while</span> <span class="color-red">true</span> <span class="color-red">do</span> <span class="color-red">skip</span> <span class="color-violet">end</span><span class="color-white">}</span><span class="color-white">&gt;</span> <span class="color-violet">as</span> <span class="color-red">cw</span> <span class="color-red">eqn</span><span class="color-white">:</span> <span class="color-red">H2eqcw</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">125</span><span class="code-fence-code">    <span class="color-emerald">induction</span> <span class="color-red">H2</span><span class="color-white">;</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">126</span><span class="code-fence-code">    <span class="color-emerald">inversion</span> <span class="color-red">H2eqcw</span><span class="color-white">;</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">127</span><span class="code-fence-code">    <span class="color-emerald">subst</span><span class="color-white">;</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">128</span><span class="code-fence-code">    <span class="color-emerald">clear</span> <span class="color-red">H2eqcw</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">129</span><span class="code-fence-code">    <span class="color-aqua">+</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">130</span><span class="code-fence-code">      <span class="color-emerald">unfold</span> <span class="color-red">beval</span> <span class="color-violet">in</span> <span class="color-red">H0</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">131</span><span class="code-fence-code">      <span class="color-emerald">discriminate</span> <span class="color-red">H0</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">132</span><span class="code-fence-code">    <span class="color-aqua">+</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">133</span><span class="code-fence-code">      <span class="color-emerald">clear</span> <span class="color-red">H</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">134</span><span class="code-fence-code">      <span class="color-emerald">clear</span> <span class="color-red">H0</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">135</span><span class="code-fence-code">      <span class="color-emerald">assert</span> <span class="color-white">(</span><span class="color-red">H3</span><span class="color-white">:</span> <span class="color-red">st&apos;</span> <span class="color-white">=</span><span class="color-white">[</span> <span class="color-red">while</span> <span class="color-white">true</span> <span class="color-red">do</span> <span class="color-red">c</span> <span class="color-violet">end</span> <span class="color-white">]</span><span class="color-white">=</span><span class="color-white">&gt;</span> <span class="color-red">st&apos;&apos;</span><span class="color-white">)</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">136</span><span class="code-fence-code"><span class="color-white">      { </span><span class="color-emerald">apply</span> <span class="color-red">IHceval2</span><span class="color-white">. </span><span class="color-emerald">reflexivity</span><span class="color-white">. </span><span class="color-dark">}</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">137</span><span class="code-fence-code">      <span class="color-emerald">assert</span> <span class="color-white">(</span><span class="color-red">H4</span><span class="color-white">:</span> <span class="color-red">st</span> <span class="color-white">=</span><span class="color-white">[</span> <span class="color-red">while</span> <span class="color-white">true</span> <span class="color-red">do</span> <span class="color-red">c</span> <span class="color-violet">end</span> <span class="color-white">]</span><span class="color-white">=</span><span class="color-white">&gt;</span> <span class="color-red">st&apos;</span><span class="color-white">)</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">138</span><span class="code-fence-code">      <span class="color-violet">Admitted</span><span class="color-white">. </span><span class="color-gray">(*</span><span class="color-gray"> TODO </span><span class="color-gray">*)</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">139</span><span class="code-fence-code"></span></span>
<span class="code-fence-row"><span class="code-fence-index">140</span><span class="code-fence-code"><span class="color-violet">Lemma</span> <span class="color-aqua">refl_aequiv</span> <span class="color-white">:</span> <span class="color-violet">forall</span> <span class="color-white">(</span><span class="color-red">a</span> <span class="color-white">:</span> <span class="color-violet">aexp</span><span class="color-white">)</span><span class="color-white">,</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">141</span><span class="code-fence-code">  <span class="color-red">aequiv</span> <span class="color-red">a</span> <span class="color-red">a</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">142</span><span class="code-fence-code"><span class="color-violet">Proof</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">143</span><span class="code-fence-code">  <span class="color-emerald">intros</span> <span class="color-red">a</span> <span class="color-red">st</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">144</span><span class="code-fence-code">  <span class="color-emerald">reflexivity</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">145</span><span class="code-fence-code">  <span class="color-violet">Qed</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">146</span><span class="code-fence-code"></span></span>
<span class="code-fence-row"><span class="code-fence-index">147</span><span class="code-fence-code"><span class="color-violet">Lemma</span> <span class="color-aqua">sym_aequiv</span> <span class="color-white">:</span> <span class="color-violet">forall</span> <span class="color-white">(</span><span class="color-red">a1</span> <span class="color-red">a2</span> <span class="color-white">:</span> <span class="color-violet">aexp</span><span class="color-white">)</span><span class="color-white">,</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">148</span><span class="code-fence-code">  <span class="color-red">aequiv</span> <span class="color-red">a1</span> <span class="color-red">a2</span> <span class="color-white">-</span><span class="color-white">&gt;</span> <span class="color-red">aequiv</span> <span class="color-red">a2</span> <span class="color-red">a1</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">149</span><span class="code-fence-code"><span class="color-violet">Proof</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">150</span><span class="code-fence-code">  <span class="color-emerald">intros</span> <span class="color-red">a1</span> <span class="color-red">a2</span> <span class="color-red">H</span> <span class="color-red">st</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">151</span><span class="code-fence-code">  <span class="color-emerald">symmetry</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">152</span><span class="code-fence-code">  <span class="color-emerald">apply</span> <span class="color-red">H</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">153</span><span class="code-fence-code">  <span class="color-violet">Qed</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">154</span><span class="code-fence-code"></span></span>
<span class="code-fence-row"><span class="code-fence-index">155</span><span class="code-fence-code"><span class="color-violet">Lemma</span> <span class="color-aqua">trans_aequiv</span> <span class="color-white">:</span> <span class="color-violet">forall</span> <span class="color-white">(</span><span class="color-red">a1</span> <span class="color-red">a2</span> <span class="color-red">a3</span> <span class="color-white">:</span> <span class="color-violet">aexp</span><span class="color-white">)</span><span class="color-white">,</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">156</span><span class="code-fence-code">  <span class="color-red">aequiv</span> <span class="color-red">a1</span> <span class="color-red">a2</span> <span class="color-white">-</span><span class="color-white">&gt;</span> <span class="color-red">aequiv</span> <span class="color-red">a2</span> <span class="color-red">a3</span> <span class="color-white">-</span><span class="color-white">&gt;</span> <span class="color-red">aequiv</span> <span class="color-red">a1</span> <span class="color-red">a3</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">157</span><span class="code-fence-code"><span class="color-violet">Proof</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">158</span><span class="code-fence-code">  <span class="color-emerald">unfold</span> <span class="color-red">aequiv</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">159</span><span class="code-fence-code">  <span class="color-emerald">intros</span> <span class="color-red">a1</span> <span class="color-red">a2</span> <span class="color-red">a3</span> <span class="color-red">H12</span> <span class="color-red">H23</span> <span class="color-red">st</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">160</span><span class="code-fence-code">  <span class="color-emerald">rewrite</span> <span class="color-white">(</span><span class="color-red">H12</span> <span class="color-red">st</span><span class="color-white">)</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">161</span><span class="code-fence-code">  <span class="color-emerald">rewrite</span> <span class="color-white">(</span><span class="color-red">H23</span> <span class="color-red">st</span><span class="color-white">)</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">162</span><span class="code-fence-code">  <span class="color-emerald">reflexivity</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">163</span><span class="code-fence-code">  <span class="color-violet">Qed</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">164</span><span class="code-fence-code"></span></span>
<span class="code-fence-row"><span class="code-fence-index">165</span><span class="code-fence-code"><span class="color-violet">Lemma</span> <span class="color-aqua">refl_bequiv</span> <span class="color-white">:</span> <span class="color-violet">forall</span> <span class="color-white">(</span><span class="color-red">b</span> <span class="color-white">:</span> <span class="color-violet">bexp</span><span class="color-white">)</span><span class="color-white">,</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">166</span><span class="code-fence-code">  <span class="color-red">bequiv</span> <span class="color-red">b</span> <span class="color-red">b</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">167</span><span class="code-fence-code"><span class="color-violet">Proof</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">168</span><span class="code-fence-code">  <span class="color-emerald">intros</span> <span class="color-red">b</span> <span class="color-red">st</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">169</span><span class="code-fence-code">  <span class="color-emerald">reflexivity</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">170</span><span class="code-fence-code">  <span class="color-violet">Qed</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">171</span><span class="code-fence-code"></span></span>
<span class="code-fence-row"><span class="code-fence-index">172</span><span class="code-fence-code"><span class="color-violet">Lemma</span> <span class="color-aqua">sym_bequiv</span> <span class="color-white">:</span> <span class="color-violet">forall</span> <span class="color-white">(</span><span class="color-red">b1</span> <span class="color-red">b2</span> <span class="color-white">:</span> <span class="color-violet">bexp</span><span class="color-white">)</span><span class="color-white">,</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">173</span><span class="code-fence-code">  <span class="color-red">bequiv</span> <span class="color-red">b1</span> <span class="color-red">b2</span> <span class="color-white">-</span><span class="color-white">&gt;</span> <span class="color-red">bequiv</span> <span class="color-red">b2</span> <span class="color-red">b1</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">174</span><span class="code-fence-code"><span class="color-violet">Proof</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">175</span><span class="code-fence-code">  <span class="color-emerald">intros</span> <span class="color-red">b1</span> <span class="color-red">b2</span> <span class="color-red">H</span> <span class="color-red">st</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">176</span><span class="code-fence-code">  <span class="color-emerald">symmetry</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">177</span><span class="code-fence-code">  <span class="color-emerald">apply</span> <span class="color-red">H</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">178</span><span class="code-fence-code">  <span class="color-violet">Qed</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">179</span><span class="code-fence-code"></span></span>
<span class="code-fence-row"><span class="code-fence-index">180</span><span class="code-fence-code"><span class="color-violet">Lemma</span> <span class="color-aqua">trans_bequiv</span> <span class="color-white">:</span> <span class="color-violet">forall</span> <span class="color-white">(</span><span class="color-red">b1</span> <span class="color-red">b2</span> <span class="color-red">b3</span> <span class="color-white">:</span> <span class="color-violet">bexp</span><span class="color-white">)</span><span class="color-white">,</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">181</span><span class="code-fence-code">  <span class="color-red">bequiv</span> <span class="color-red">b1</span> <span class="color-red">b2</span> <span class="color-white">-</span><span class="color-white">&gt;</span> <span class="color-red">bequiv</span> <span class="color-red">b2</span> <span class="color-red">b3</span> <span class="color-white">-</span><span class="color-white">&gt;</span> <span class="color-red">bequiv</span> <span class="color-red">b1</span> <span class="color-red">b3</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">182</span><span class="code-fence-code"><span class="color-violet">Proof</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">183</span><span class="code-fence-code">  <span class="color-emerald">intros</span> <span class="color-red">b1</span> <span class="color-red">b2</span> <span class="color-red">b3</span> <span class="color-red">H12</span> <span class="color-red">H23</span> <span class="color-red">st</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">184</span><span class="code-fence-code">  <span class="color-emerald">rewrite</span> <span class="color-white">(</span><span class="color-red">H12</span> <span class="color-red">st</span><span class="color-white">)</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">185</span><span class="code-fence-code">  <span class="color-emerald">rewrite</span> <span class="color-white">(</span><span class="color-red">H23</span> <span class="color-red">st</span><span class="color-white">)</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">186</span><span class="code-fence-code">  <span class="color-emerald">reflexivity</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">187</span><span class="code-fence-code">  <span class="color-violet">Qed</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">188</span><span class="code-fence-code"></span></span>
<span class="code-fence-row"><span class="code-fence-index">189</span><span class="code-fence-code"><span class="color-violet">Lemma</span> <span class="color-aqua">refl_cequiv</span> <span class="color-white">:</span> <span class="color-violet">forall</span> <span class="color-white">(</span><span class="color-red">c</span> <span class="color-white">:</span> <span class="color-violet">com</span><span class="color-white">)</span><span class="color-white">,</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">190</span><span class="code-fence-code">  <span class="color-red">cequiv</span> <span class="color-red">c</span> <span class="color-red">c</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">191</span><span class="code-fence-code"><span class="color-violet">Proof</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">192</span><span class="code-fence-code">  <span class="color-emerald">intros</span> <span class="color-red">c</span> <span class="color-red">st</span> <span class="color-red">st&apos;</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">193</span><span class="code-fence-code">  <span class="color-emerald">reflexivity</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">194</span><span class="code-fence-code">  <span class="color-violet">Qed</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">195</span><span class="code-fence-code"></span></span>
<span class="code-fence-row"><span class="code-fence-index">196</span><span class="code-fence-code"><span class="color-violet">Lemma</span> <span class="color-aqua">sym_cequiv</span> <span class="color-white">:</span> <span class="color-violet">forall</span> <span class="color-white">(</span><span class="color-red">c1</span> <span class="color-red">c2</span> <span class="color-white">:</span> <span class="color-violet">com</span><span class="color-white">)</span><span class="color-white">,</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">197</span><span class="code-fence-code">  <span class="color-red">cequiv</span> <span class="color-red">c1</span> <span class="color-red">c2</span> <span class="color-white">-</span><span class="color-white">&gt;</span> <span class="color-red">cequiv</span> <span class="color-red">c2</span> <span class="color-red">c1</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">198</span><span class="code-fence-code"><span class="color-violet">Proof</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">199</span><span class="code-fence-code">  <span class="color-emerald">unfold</span> <span class="color-red">cequiv</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">200</span><span class="code-fence-code">  <span class="color-emerald">intros</span> <span class="color-red">c1</span> <span class="color-red">c2</span> <span class="color-red">H</span> <span class="color-red">st</span> <span class="color-red">st&apos;</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">201</span><span class="code-fence-code">  <span class="color-emerald">rewrite</span> <span class="color-red">H</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">202</span><span class="code-fence-code">  <span class="color-emerald">reflexivity</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">203</span><span class="code-fence-code">  <span class="color-violet">Qed</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">204</span><span class="code-fence-code"></span></span>
<span class="code-fence-row"><span class="code-fence-index">205</span><span class="code-fence-code"><span class="color-violet">Lemma</span> <span class="color-aqua">trans_cequiv</span> <span class="color-white">:</span> <span class="color-violet">forall</span> <span class="color-white">(</span><span class="color-red">c1</span> <span class="color-red">c2</span> <span class="color-red">c3</span> <span class="color-white">:</span> <span class="color-violet">com</span><span class="color-white">)</span><span class="color-white">,</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">206</span><span class="code-fence-code">  <span class="color-red">cequiv</span> <span class="color-red">c1</span> <span class="color-red">c2</span> <span class="color-white">-</span><span class="color-white">&gt;</span> <span class="color-red">cequiv</span> <span class="color-red">c2</span> <span class="color-red">c3</span> <span class="color-white">-</span><span class="color-white">&gt;</span> <span class="color-red">cequiv</span> <span class="color-red">c1</span> <span class="color-red">c3</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">207</span><span class="code-fence-code"><span class="color-violet">Proof</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">208</span><span class="code-fence-code">  <span class="color-emerald">unfold</span> <span class="color-red">cequiv</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">209</span><span class="code-fence-code">  <span class="color-emerald">intros</span> <span class="color-red">c1</span> <span class="color-red">c2</span> <span class="color-red">c3</span> <span class="color-red">H12</span> <span class="color-red">H23</span> <span class="color-red">st</span> <span class="color-red">st&apos;</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">210</span><span class="code-fence-code">  <span class="color-emerald">rewrite</span> <span class="color-red">H12</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">211</span><span class="code-fence-code">  <span class="color-emerald">apply</span> <span class="color-red">H23</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">212</span><span class="code-fence-code">  <span class="color-violet">Qed</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">213</span><span class="code-fence-code"></span></span>
<span class="code-fence-row"><span class="code-fence-index">214</span><span class="code-fence-code"><span class="color-violet">Theorem</span> <span class="color-aqua">CAsgn_congruence</span> <span class="color-white">:</span> <span class="color-violet">forall</span> <span class="color-red">x</span> <span class="color-red">a</span> <span class="color-red">a&apos;</span><span class="color-white">,</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">215</span><span class="code-fence-code">  <span class="color-red">aequiv</span> <span class="color-red">a</span> <span class="color-red">a&apos;</span> <span class="color-white">-</span><span class="color-white">&gt;</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">216</span><span class="code-fence-code">  <span class="color-red">cequiv</span> <span class="color-white">&lt;</span><span class="color-white">{</span><span class="color-red">x</span> <span class="color-white">:=</span> <span class="color-red">a</span><span class="color-white">}</span><span class="color-white">&gt;</span> <span class="color-white">&lt;</span><span class="color-white">{</span><span class="color-red">x</span> <span class="color-white">:=</span> <span class="color-red">a&apos;</span><span class="color-white">}</span><span class="color-white">&gt;</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">217</span><span class="code-fence-code"><span class="color-violet">Proof</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">218</span><span class="code-fence-code">  <span class="color-emerald">intros</span> <span class="color-red">x</span> <span class="color-red">a</span> <span class="color-red">a&apos;</span> <span class="color-red">H</span> <span class="color-red">st</span> <span class="color-red">st&apos;</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">219</span><span class="code-fence-code">  <span class="color-emerald">split</span><span class="color-white">;</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">220</span><span class="code-fence-code">  <span class="color-emerald">intros</span> <span class="color-red">H2</span><span class="color-white">;</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">221</span><span class="code-fence-code">  <span class="color-emerald">inversion</span> <span class="color-red">H2</span><span class="color-white">;</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">222</span><span class="code-fence-code">  <span class="color-emerald">subst</span><span class="color-white">;</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">223</span><span class="code-fence-code">  <span class="color-emerald">apply</span> <span class="color-red">E_Asgn</span><span class="color-white">;</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">224</span><span class="code-fence-code">  <span class="color-emerald">rewrite</span> <span class="color-red">H</span><span class="color-white">;</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">225</span><span class="code-fence-code">  <span class="color-emerald">reflexivity</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">226</span><span class="code-fence-code">  <span class="color-violet">Qed</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">227</span><span class="code-fence-code"></span></span>
<span class="code-fence-row"><span class="code-fence-index">228</span><span class="code-fence-code"><span class="color-violet">Theorem</span> <span class="color-aqua">CSeq_congruence</span> <span class="color-white">:</span> <span class="color-violet">forall</span> <span class="color-red">c1</span> <span class="color-red">c1&apos;</span> <span class="color-red">c2</span> <span class="color-red">c2&apos;</span><span class="color-white">,</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">229</span><span class="code-fence-code">  <span class="color-red">cequiv</span> <span class="color-red">c1</span> <span class="color-red">c1&apos;</span> <span class="color-white">-</span><span class="color-white">&gt;</span> <span class="color-red">cequiv</span> <span class="color-red">c2</span> <span class="color-red">c2&apos;</span> <span class="color-white">-</span><span class="color-white">&gt;</span> <span class="color-red">cequiv</span> <span class="color-white">&lt;</span><span class="color-white">{</span> <span class="color-red">c1</span><span class="color-white">;</span><span class="color-red">c2</span> <span class="color-white">}</span><span class="color-white">&gt;</span> <span class="color-white">&lt;</span><span class="color-white">{</span> <span class="color-red">c1&apos;</span><span class="color-white">;</span><span class="color-red">c2&apos;</span> <span class="color-white">}</span><span class="color-white">&gt;</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">230</span><span class="code-fence-code"><span class="color-violet">Proof</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">231</span><span class="code-fence-code">  <span class="color-emerald">intros</span> <span class="color-red">c1</span> <span class="color-red">c1&apos;</span> <span class="color-red">c2</span> <span class="color-red">c2&apos;</span> <span class="color-red">H1</span> <span class="color-red">H2</span> <span class="color-red">st</span> <span class="color-red">st&apos;</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">232</span><span class="code-fence-code">  <span class="color-emerald">split</span><span class="color-white">;</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">233</span><span class="code-fence-code">  <span class="color-emerald">intros</span> <span class="color-red">H3</span><span class="color-white">;</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">234</span><span class="code-fence-code">  <span class="color-emerald">inversion</span> <span class="color-red">H3</span><span class="color-white">;</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">235</span><span class="code-fence-code">  <span class="color-emerald">subst</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">236</span><span class="code-fence-code">  <span class="color-aqua">-</span> <span class="color-gray">(*</span><span class="color-gray"> c1 -&gt; c1&apos; </span><span class="color-gray">*)</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">237</span><span class="code-fence-code">    <span class="color-emerald">assert</span> <span class="color-white">(</span><span class="color-red">H5</span><span class="color-white">:</span> <span class="color-red">st</span> <span class="color-white">=</span><span class="color-white">[</span> <span class="color-red">c1&apos;</span> <span class="color-white">]</span><span class="color-white">=</span><span class="color-white">&gt;</span> <span class="color-red">st&apos;0</span><span class="color-white">)</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">238</span><span class="code-fence-code"><span class="color-white">      { </span><span class="color-emerald">apply</span> <span class="color-red">H1</span><span class="color-white">. </span><span class="color-emerald">apply</span> <span class="color-red">H4</span><span class="color-white">. </span><span class="color-dark">}</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">239</span><span class="code-fence-code">    <span class="color-emerald">assert</span> <span class="color-white">(</span><span class="color-red">H6</span><span class="color-white">:</span> <span class="color-red">st&apos;0</span> <span class="color-white">=</span><span class="color-white">[</span> <span class="color-red">c2&apos;</span> <span class="color-white">]</span><span class="color-white">=</span><span class="color-white">&gt;</span> <span class="color-red">st&apos;</span><span class="color-white">)</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">240</span><span class="code-fence-code"><span class="color-white">      { </span><span class="color-emerald">apply</span> <span class="color-red">H2</span><span class="color-white">. </span><span class="color-emerald">apply</span> <span class="color-red">H7</span><span class="color-white">. </span><span class="color-dark">}</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">241</span><span class="code-fence-code">    <span class="color-emerald">apply</span> <span class="color-white">(</span><span class="color-red">E_Seq</span> <span class="color-red">c1&apos;</span> <span class="color-red">c2&apos;</span> <span class="color-red">st</span> <span class="color-red">st&apos;0</span> <span class="color-red">st&apos;</span> <span class="color-red">H5</span> <span class="color-red">H6</span><span class="color-white">)</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">242</span><span class="code-fence-code">  <span class="color-aqua">-</span> <span class="color-gray">(*</span><span class="color-gray"> c1&apos; -&gt; c1 </span><span class="color-gray">*)</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">243</span><span class="code-fence-code">    <span class="color-emerald">assert</span> <span class="color-white">(</span><span class="color-red">H5</span><span class="color-white">:</span> <span class="color-red">st</span> <span class="color-white">=</span><span class="color-white">[</span> <span class="color-red">c1</span> <span class="color-white">]</span><span class="color-white">=</span><span class="color-white">&gt;</span> <span class="color-red">st&apos;0</span><span class="color-white">)</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">244</span><span class="code-fence-code"><span class="color-white">      { </span><span class="color-emerald">apply</span> <span class="color-red">H1</span><span class="color-white">. </span><span class="color-emerald">apply</span> <span class="color-red">H4</span><span class="color-white">. </span><span class="color-dark">}</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">245</span><span class="code-fence-code">    <span class="color-emerald">assert</span> <span class="color-white">(</span><span class="color-red">H6</span><span class="color-white">:</span> <span class="color-red">st&apos;0</span> <span class="color-white">=</span><span class="color-white">[</span> <span class="color-red">c2</span> <span class="color-white">]</span><span class="color-white">=</span><span class="color-white">&gt;</span> <span class="color-red">st&apos;</span><span class="color-white">)</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">246</span><span class="code-fence-code"><span class="color-white">      { </span><span class="color-emerald">apply</span> <span class="color-red">H2</span><span class="color-white">. </span><span class="color-emerald">apply</span> <span class="color-red">H7</span><span class="color-white">. </span><span class="color-dark">}</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">247</span><span class="code-fence-code">    <span class="color-emerald">apply</span> <span class="color-white">(</span><span class="color-red">E_Seq</span> <span class="color-red">c1</span> <span class="color-red">c2</span> <span class="color-red">st</span> <span class="color-red">st&apos;0</span> <span class="color-red">st&apos;</span> <span class="color-red">H5</span> <span class="color-red">H6</span><span class="color-white">)</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">248</span><span class="code-fence-code">  <span class="color-violet">Qed</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">249</span><span class="code-fence-code"></span></span>
<span class="code-fence-row"><span class="code-fence-index">250</span><span class="code-fence-code"><span class="color-violet">Theorem</span> <span class="color-aqua">CIf_congruence</span> <span class="color-white">:</span> <span class="color-violet">forall</span> <span class="color-red">b</span> <span class="color-red">b&apos;</span> <span class="color-red">c1</span> <span class="color-red">c1&apos;</span> <span class="color-red">c2</span> <span class="color-red">c2&apos;</span><span class="color-white">,</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">251</span><span class="code-fence-code">  <span class="color-red">bequiv</span> <span class="color-red">b</span> <span class="color-red">b&apos;</span> <span class="color-white">-</span><span class="color-white">&gt;</span> <span class="color-red">cequiv</span> <span class="color-red">c1</span> <span class="color-red">c1&apos;</span> <span class="color-white">-</span><span class="color-white">&gt;</span> <span class="color-red">cequiv</span> <span class="color-red">c2</span> <span class="color-red">c2&apos;</span> <span class="color-white">-</span><span class="color-white">&gt;</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">252</span><span class="code-fence-code">  <span class="color-red">cequiv</span> <span class="color-white">&lt;</span><span class="color-white">{</span> <span class="color-violet">if</span> <span class="color-red">b</span> <span class="color-violet">then</span> <span class="color-red">c1</span> <span class="color-violet">else</span> <span class="color-red">c2</span> <span class="color-violet">end</span> <span class="color-white">}</span><span class="color-white">&gt;</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">253</span><span class="code-fence-code">         <span class="color-white">&lt;</span><span class="color-white">{</span> <span class="color-violet">if</span> <span class="color-red">b&apos;</span> <span class="color-violet">then</span> <span class="color-red">c1&apos;</span> <span class="color-violet">else</span> <span class="color-red">c2&apos;</span> <span class="color-violet">end</span> <span class="color-white">}</span><span class="color-white">&gt;</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">254</span><span class="code-fence-code"><span class="color-violet">Proof</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">255</span><span class="code-fence-code">  <span class="color-emerald">intros</span> <span class="color-red">b</span> <span class="color-red">b&apos;</span> <span class="color-red">c1</span> <span class="color-red">c1&apos;</span> <span class="color-red">c2</span> <span class="color-red">c2&apos;</span> <span class="color-red">H1</span> <span class="color-red">H2</span> <span class="color-red">H3</span> <span class="color-red">st</span> <span class="color-red">st&apos;</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">256</span><span class="code-fence-code">  <span class="color-emerald">split</span><span class="color-white">;</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">257</span><span class="code-fence-code">  <span class="color-emerald">intros</span> <span class="color-red">H4</span><span class="color-white">;</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">258</span><span class="code-fence-code">  <span class="color-emerald">inversion</span> <span class="color-red">H4</span><span class="color-white">;</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">259</span><span class="code-fence-code">  <span class="color-emerald">subst</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">260</span><span class="code-fence-code">  <span class="color-aqua">-</span> <span class="color-gray">(*</span><span class="color-gray"> b -&gt; b&apos;, b = true </span><span class="color-gray">*)</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">261</span><span class="code-fence-code">    <span class="color-emerald">assert</span> <span class="color-white">(</span><span class="color-red">H5</span><span class="color-white">:</span> <span class="color-red">beval</span> <span class="color-red">st</span> <span class="color-red">b&apos;</span> <span class="color-white">=</span> <span class="color-white">true</span><span class="color-white">)</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">262</span><span class="code-fence-code"><span class="color-white">    { </span><span class="color-emerald">rewrite</span> <span class="color-white">&lt;</span><span class="color-white">-</span> <span class="color-red">H8</span><span class="color-white">. </span><span class="color-emerald">rewrite</span> <span class="color-red">H1</span><span class="color-white">. </span><span class="color-emerald">reflexivity</span><span class="color-white">. </span><span class="color-dark">}</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">263</span><span class="code-fence-code">    <span class="color-emerald">assert</span> <span class="color-white">(</span><span class="color-red">H6</span><span class="color-white">:</span> <span class="color-red">st</span> <span class="color-white">=</span><span class="color-white">[</span> <span class="color-red">c1&apos;</span> <span class="color-white">]</span><span class="color-white">=</span><span class="color-white">&gt;</span> <span class="color-red">st&apos;</span><span class="color-white">)</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">264</span><span class="code-fence-code"><span class="color-white">    { </span><span class="color-emerald">apply</span> <span class="color-red">H2</span><span class="color-white">. </span><span class="color-emerald">apply</span> <span class="color-red">H9</span><span class="color-white">. </span><span class="color-dark">}</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">265</span><span class="code-fence-code">    <span class="color-emerald">apply</span> <span class="color-white">(</span><span class="color-red">E_IfTrue</span> <span class="color-red">st</span> <span class="color-red">st&apos;</span> <span class="color-red">b&apos;</span> <span class="color-red">c1&apos;</span> <span class="color-red">c2&apos;</span> <span class="color-red">H5</span> <span class="color-red">H6</span><span class="color-white">)</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">266</span><span class="code-fence-code">  <span class="color-aqua">-</span> <span class="color-gray">(*</span><span class="color-gray"> b -&gt; b&apos;, b = false </span><span class="color-gray">*)</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">267</span><span class="code-fence-code">    <span class="color-emerald">assert</span> <span class="color-white">(</span><span class="color-red">H5</span><span class="color-white">:</span> <span class="color-red">beval</span> <span class="color-red">st</span> <span class="color-red">b&apos;</span> <span class="color-white">=</span> <span class="color-white">false</span><span class="color-white">)</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">268</span><span class="code-fence-code"><span class="color-white">    { </span><span class="color-emerald">rewrite</span> <span class="color-white">&lt;</span><span class="color-white">-</span> <span class="color-red">H8</span><span class="color-white">. </span><span class="color-emerald">rewrite</span> <span class="color-red">H1</span><span class="color-white">. </span><span class="color-emerald">reflexivity</span><span class="color-white">. </span><span class="color-dark">}</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">269</span><span class="code-fence-code">    <span class="color-emerald">assert</span> <span class="color-white">(</span><span class="color-red">H6</span><span class="color-white">:</span> <span class="color-red">st</span> <span class="color-white">=</span><span class="color-white">[</span> <span class="color-red">c2&apos;</span> <span class="color-white">]</span><span class="color-white">=</span><span class="color-white">&gt;</span> <span class="color-red">st&apos;</span><span class="color-white">)</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">270</span><span class="code-fence-code"><span class="color-white">    { </span><span class="color-emerald">apply</span> <span class="color-red">H3</span><span class="color-white">. </span><span class="color-emerald">apply</span> <span class="color-red">H9</span><span class="color-white">. </span><span class="color-dark">}</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">271</span><span class="code-fence-code">    <span class="color-emerald">apply</span> <span class="color-white">(</span><span class="color-red">E_IfFalse</span> <span class="color-red">st</span> <span class="color-red">st&apos;</span> <span class="color-red">b&apos;</span> <span class="color-red">c1&apos;</span> <span class="color-red">c2&apos;</span> <span class="color-red">H5</span> <span class="color-red">H6</span><span class="color-white">)</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">272</span><span class="code-fence-code">  <span class="color-aqua">-</span> <span class="color-gray">(*</span><span class="color-gray"> b&apos; -&gt; b, b&apos; = true </span><span class="color-gray">*)</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">273</span><span class="code-fence-code">    <span class="color-emerald">assert</span> <span class="color-white">(</span><span class="color-red">H5</span><span class="color-white">:</span> <span class="color-red">beval</span> <span class="color-red">st</span> <span class="color-red">b</span> <span class="color-white">=</span> <span class="color-white">true</span><span class="color-white">)</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">274</span><span class="code-fence-code"><span class="color-white">    { </span><span class="color-emerald">rewrite</span> <span class="color-white">&lt;</span><span class="color-white">-</span> <span class="color-red">H8</span><span class="color-white">. </span><span class="color-emerald">rewrite</span> <span class="color-red">H1</span><span class="color-white">. </span><span class="color-emerald">reflexivity</span><span class="color-white">. </span><span class="color-dark">}</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">275</span><span class="code-fence-code">    <span class="color-emerald">assert</span> <span class="color-white">(</span><span class="color-red">H6</span><span class="color-white">:</span> <span class="color-red">st</span> <span class="color-white">=</span><span class="color-white">[</span> <span class="color-red">c1</span> <span class="color-white">]</span><span class="color-white">=</span><span class="color-white">&gt;</span> <span class="color-red">st&apos;</span><span class="color-white">)</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">276</span><span class="code-fence-code"><span class="color-white">    { </span><span class="color-emerald">apply</span> <span class="color-red">H2</span><span class="color-white">. </span><span class="color-emerald">apply</span> <span class="color-red">H9</span><span class="color-white">. </span><span class="color-dark">}</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">277</span><span class="code-fence-code">    <span class="color-emerald">apply</span> <span class="color-white">(</span><span class="color-red">E_IfTrue</span> <span class="color-red">st</span> <span class="color-red">st&apos;</span> <span class="color-red">b</span> <span class="color-red">c1</span> <span class="color-red">c2</span> <span class="color-red">H5</span> <span class="color-red">H6</span><span class="color-white">)</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">278</span><span class="code-fence-code">  <span class="color-aqua">-</span> <span class="color-gray">(*</span><span class="color-gray"> b&apos; -&gt; b, b&apos; = false </span><span class="color-gray">*)</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">279</span><span class="code-fence-code">    <span class="color-emerald">assert</span> <span class="color-white">(</span><span class="color-red">H5</span><span class="color-white">:</span> <span class="color-red">beval</span> <span class="color-red">st</span> <span class="color-red">b</span> <span class="color-white">=</span> <span class="color-white">false</span><span class="color-white">)</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">280</span><span class="code-fence-code"><span class="color-white">    { </span><span class="color-emerald">rewrite</span> <span class="color-white">&lt;</span><span class="color-white">-</span> <span class="color-red">H8</span><span class="color-white">. </span><span class="color-emerald">rewrite</span> <span class="color-red">H1</span><span class="color-white">. </span><span class="color-emerald">reflexivity</span><span class="color-white">. </span><span class="color-dark">}</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">281</span><span class="code-fence-code">    <span class="color-emerald">assert</span> <span class="color-white">(</span><span class="color-red">H6</span><span class="color-white">:</span> <span class="color-red">st</span> <span class="color-white">=</span><span class="color-white">[</span> <span class="color-red">c2</span> <span class="color-white">]</span><span class="color-white">=</span><span class="color-white">&gt;</span> <span class="color-red">st&apos;</span><span class="color-white">)</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">282</span><span class="code-fence-code"><span class="color-white">    { </span><span class="color-emerald">apply</span> <span class="color-red">H3</span><span class="color-white">. </span><span class="color-emerald">apply</span> <span class="color-red">H9</span><span class="color-white">. </span><span class="color-dark">}</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">283</span><span class="code-fence-code">    <span class="color-emerald">apply</span> <span class="color-white">(</span><span class="color-red">E_IfFalse</span> <span class="color-red">st</span> <span class="color-red">st&apos;</span> <span class="color-red">b</span> <span class="color-red">c1</span> <span class="color-red">c2</span> <span class="color-red">H5</span> <span class="color-red">H6</span><span class="color-white">)</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">284</span><span class="code-fence-code">  <span class="color-violet">Qed</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">285</span><span class="code-fence-code"></span></span>
<span class="code-fence-row"><span class="code-fence-index">286</span><span class="code-fence-code"><span class="color-violet">Theorem</span> <span class="color-aqua">CWhile_congruence</span> <span class="color-white">:</span> <span class="color-violet">forall</span> <span class="color-red">b</span> <span class="color-red">b&apos;</span> <span class="color-red">c</span> <span class="color-red">c&apos;</span><span class="color-white">,</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">287</span><span class="code-fence-code">  <span class="color-red">bequiv</span> <span class="color-red">b</span> <span class="color-red">b&apos;</span> <span class="color-white">-</span><span class="color-white">&gt;</span> <span class="color-red">cequiv</span> <span class="color-red">c</span> <span class="color-red">c&apos;</span> <span class="color-white">-</span><span class="color-white">&gt;</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">288</span><span class="code-fence-code">  <span class="color-red">cequiv</span> <span class="color-white">&lt;</span><span class="color-white">{</span> <span class="color-red">while</span> <span class="color-red">b</span> <span class="color-red">do</span> <span class="color-red">c</span> <span class="color-violet">end</span> <span class="color-white">}</span><span class="color-white">&gt;</span> <span class="color-white">&lt;</span><span class="color-white">{</span> <span class="color-red">while</span> <span class="color-red">b&apos;</span> <span class="color-red">do</span> <span class="color-red">c&apos;</span> <span class="color-violet">end</span> <span class="color-white">}</span><span class="color-white">&gt;</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">289</span><span class="code-fence-code"><span class="color-violet">Proof</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">290</span><span class="code-fence-code">  <span class="color-emerald">assert</span> <span class="color-white">(</span><span class="color-red">A</span><span class="color-white">:</span> <span class="color-violet">forall</span> <span class="color-white">(</span><span class="color-red">b</span> <span class="color-red">b&apos;</span> <span class="color-white">:</span> <span class="color-violet">bexp</span><span class="color-white">)</span> <span class="color-white">(</span><span class="color-red">c</span> <span class="color-red">c&apos;</span> <span class="color-white">:</span> <span class="color-violet">com</span><span class="color-white">)</span> <span class="color-white">(</span><span class="color-red">st</span> <span class="color-red">st&apos;</span> <span class="color-white">:</span> <span class="color-violet">state</span><span class="color-white">)</span><span class="color-white">,</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">291</span><span class="code-fence-code">             <span class="color-red">bequiv</span> <span class="color-red">b</span> <span class="color-red">b&apos;</span> <span class="color-white">-</span><span class="color-white">&gt;</span> <span class="color-red">cequiv</span> <span class="color-red">c</span> <span class="color-red">c&apos;</span> <span class="color-white">-</span><span class="color-white">&gt;</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">292</span><span class="code-fence-code">             <span class="color-red">st</span> <span class="color-white">=</span><span class="color-white">[</span> <span class="color-red">while</span> <span class="color-red">b</span> <span class="color-red">do</span> <span class="color-red">c</span> <span class="color-violet">end</span> <span class="color-white">]</span><span class="color-white">=</span><span class="color-white">&gt;</span> <span class="color-red">st&apos;</span> <span class="color-white">-</span><span class="color-white">&gt;</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">293</span><span class="code-fence-code">             <span class="color-red">st</span> <span class="color-white">=</span><span class="color-white">[</span> <span class="color-red">while</span> <span class="color-red">b&apos;</span> <span class="color-red">do</span> <span class="color-red">c&apos;</span> <span class="color-violet">end</span> <span class="color-white">]</span><span class="color-white">=</span><span class="color-white">&gt;</span> <span class="color-red">st&apos;</span><span class="color-white">)</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">294</span><span class="code-fence-code"><span class="color-white">  { </span></span></span>
<span class="code-fence-row"><span class="code-fence-index">295</span><span class="code-fence-code">    <span class="color-emerald">unfold</span> <span class="color-red">bequiv</span><span class="color-white">,</span> <span class="color-red">cequiv</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">296</span><span class="code-fence-code">    <span class="color-emerald">intros</span> <span class="color-red">b</span> <span class="color-red">b&apos;</span> <span class="color-red">c</span> <span class="color-red">c&apos;</span> <span class="color-red">st</span> <span class="color-red">st&apos;</span> <span class="color-red">Hbe</span> <span class="color-red">Hc1e</span> <span class="color-red">Hce</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">297</span><span class="code-fence-code">    <span class="color-emerald">remember</span> <span class="color-white">&lt;</span><span class="color-white">{</span> <span class="color-red">while</span> <span class="color-red">b</span> <span class="color-red">do</span> <span class="color-red">c</span> <span class="color-violet">end</span> <span class="color-white">}</span><span class="color-white">&gt;</span> <span class="color-violet">as</span> <span class="color-red">cwhile</span> <span class="color-red">eqn</span><span class="color-white">:</span><span class="color-red">Heqcwhile</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">298</span><span class="code-fence-code">    <span class="color-emerald">induction</span> <span class="color-red">Hce</span><span class="color-white">;</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">299</span><span class="code-fence-code">    <span class="color-emerald">inversion</span> <span class="color-red">Heqcwhile</span><span class="color-white">;</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">300</span><span class="code-fence-code">    <span class="color-emerald">subst</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">301</span><span class="code-fence-code">    <span class="color-aqua">+</span> <span class="color-gray">(*</span><span class="color-gray"> E_WhileFalse </span><span class="color-gray">*)</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">302</span><span class="code-fence-code">      <span class="color-emerald">apply</span> <span class="color-red">E_WhileFalse</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">303</span><span class="code-fence-code">      <span class="color-emerald">rewrite</span> <span class="color-white">&lt;</span><span class="color-white">-</span> <span class="color-red">Hbe</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">304</span><span class="code-fence-code">      <span class="color-emerald">apply</span> <span class="color-red">H</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">305</span><span class="code-fence-code">    <span class="color-aqua">+</span> <span class="color-gray">(*</span><span class="color-gray"> E_WhileTrue </span><span class="color-gray">*)</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">306</span><span class="code-fence-code">      <span class="color-emerald">apply</span> <span class="color-red">E_WhileTrue</span> <span class="color-violet">with</span> <span class="color-white">(</span><span class="color-aqua">st&apos;</span> <span class="color-white">:=</span> <span class="color-red">st&apos;</span><span class="color-white">)</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">307</span><span class="code-fence-code">      <span class="color-aqua">*</span> <span class="color-gray">(*</span><span class="color-gray"> show loop runs </span><span class="color-gray">*)</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">308</span><span class="code-fence-code">        <span class="color-emerald">rewrite</span> <span class="color-white">&lt;</span><span class="color-white">-</span> <span class="color-red">Hbe</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">309</span><span class="code-fence-code">        <span class="color-emerald">apply</span> <span class="color-red">H</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">310</span><span class="code-fence-code">      <span class="color-aqua">*</span> <span class="color-gray">(*</span><span class="color-gray"> body execution </span><span class="color-gray">*)</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">311</span><span class="code-fence-code">        <span class="color-emerald">apply</span> <span class="color-white">(</span><span class="color-red">Hc1e</span> <span class="color-red">st</span> <span class="color-red">st&apos;</span><span class="color-white">)</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">312</span><span class="code-fence-code">        <span class="color-emerald">apply</span> <span class="color-red">Hce1</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">313</span><span class="code-fence-code">      <span class="color-aqua">*</span> <span class="color-gray">(*</span><span class="color-gray"> subsequent loop execution </span><span class="color-gray">*)</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">314</span><span class="code-fence-code">        <span class="color-emerald">apply</span> <span class="color-red">IHHce2</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">315</span><span class="code-fence-code">        <span class="color-emerald">reflexivity</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">316</span><span class="code-fence-code">  <span class="color-dark">}</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">317</span><span class="code-fence-code">  <span class="color-emerald">intros</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">318</span><span class="code-fence-code">  <span class="color-emerald">split</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">319</span><span class="code-fence-code">  <span class="color-aqua">-</span> <span class="color-gray">(*</span><span class="color-gray"> b -&gt; b&apos; </span><span class="color-gray">*)</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">320</span><span class="code-fence-code">    <span class="color-emerald">apply</span> <span class="color-red">A</span><span class="color-white">;</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">321</span><span class="code-fence-code">    <span class="color-emerald">assumption</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">322</span><span class="code-fence-code">  <span class="color-aqua">-</span> <span class="color-gray">(*</span><span class="color-gray"> b&apos; -&gt; b </span><span class="color-gray">*)</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">323</span><span class="code-fence-code">    <span class="color-emerald">apply</span> <span class="color-red">A</span><span class="color-white">;</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">324</span><span class="code-fence-code">    <span class="color-emerald">try</span> <span class="color-emerald">apply</span> <span class="color-red">sym_bequiv</span><span class="color-white">;</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">325</span><span class="code-fence-code">    <span class="color-emerald">try</span> <span class="color-emerald">apply</span> <span class="color-red">sym_cequiv</span><span class="color-white">;</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">326</span><span class="code-fence-code">    <span class="color-emerald">assumption</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">327</span><span class="code-fence-code">  <span class="color-violet">Qed</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">328</span><span class="code-fence-code"></span></span>
<span class="code-fence-row"><span class="code-fence-index">329</span><span class="code-fence-code"><span class="color-violet">Definition</span> <span class="color-aqua">atrans_sound</span> <span class="color-white">(</span><span class="color-red">atrans</span> <span class="color-white">:</span> <span class="color-violet">aexp</span> <span class="color-white">-</span><span class="color-white">&gt;</span> <span class="color-violet">aexp</span><span class="color-white">)</span> <span class="color-white">:</span> <span class="color-white">Prop</span> <span class="color-white">:=</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">330</span><span class="code-fence-code">  <span class="color-violet">forall</span> <span class="color-white">(</span><span class="color-red">a</span> <span class="color-white">:</span> <span class="color-violet">aexp</span><span class="color-white">)</span><span class="color-white">,</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">331</span><span class="code-fence-code">    <span class="color-red">aequiv</span> <span class="color-red">a</span> <span class="color-white">(</span><span class="color-red">atrans</span> <span class="color-red">a</span><span class="color-white">)</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">332</span><span class="code-fence-code"></span></span>
<span class="code-fence-row"><span class="code-fence-index">333</span><span class="code-fence-code"><span class="color-violet">Definition</span> <span class="color-aqua">btrans_sound</span> <span class="color-white">(</span><span class="color-red">btrans</span> <span class="color-white">:</span> <span class="color-violet">bexp</span> <span class="color-white">-</span><span class="color-white">&gt;</span> <span class="color-violet">bexp</span><span class="color-white">)</span> <span class="color-white">:</span> <span class="color-white">Prop</span> <span class="color-white">:=</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">334</span><span class="code-fence-code">  <span class="color-violet">forall</span> <span class="color-white">(</span><span class="color-red">b</span> <span class="color-white">:</span> <span class="color-violet">bexp</span><span class="color-white">)</span><span class="color-white">,</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">335</span><span class="code-fence-code">    <span class="color-red">bequiv</span> <span class="color-red">b</span> <span class="color-white">(</span><span class="color-red">btrans</span> <span class="color-red">b</span><span class="color-white">)</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">336</span><span class="code-fence-code"></span></span>
<span class="code-fence-row"><span class="code-fence-index">337</span><span class="code-fence-code"><span class="color-violet">Definition</span> <span class="color-aqua">ctrans_sound</span> <span class="color-white">(</span><span class="color-red">ctrans</span> <span class="color-white">:</span> <span class="color-violet">com</span> <span class="color-white">-</span><span class="color-white">&gt;</span> <span class="color-violet">com</span><span class="color-white">)</span> <span class="color-white">:</span> <span class="color-white">Prop</span> <span class="color-white">:=</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">338</span><span class="code-fence-code">  <span class="color-violet">forall</span> <span class="color-white">(</span><span class="color-red">c</span> <span class="color-white">:</span> <span class="color-violet">com</span><span class="color-white">)</span><span class="color-white">,</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">339</span><span class="code-fence-code">    <span class="color-red">cequiv</span> <span class="color-red">c</span> <span class="color-white">(</span><span class="color-red">ctrans</span> <span class="color-red">c</span><span class="color-white">)</span><span class="color-white">.</span></span></span>
</code><button onclick="copy_code_to_clipboard(2)" class="copy-fenced-code">Copy</button></pre><h3 id="hoare-logic">Hoare Logic</h3><pre class="fenced-code-block line-num-width-2"><code><span class="code-fence-row"><span class="code-fence-index">1</span><span class="code-fence-code">Definition Assertion := state -&gt; Prop.</span></span>
<span class="code-fence-row"><span class="code-fence-index">2</span><span class="code-fence-code"></span></span>
<span class="code-fence-row"><span class="code-fence-index">3</span><span class="code-fence-code">Definition assert_implies (P Q : Assertion) : Prop :=</span></span>
<span class="code-fence-row"><span class="code-fence-index">4</span><span class="code-fence-code">  forall st, P st -&gt; Q st.</span></span>
<span class="code-fence-row"><span class="code-fence-index">5</span><span class="code-fence-code"></span></span>
<span class="code-fence-row"><span class="code-fence-index">6</span><span class="code-fence-code">Declare Scope hoare_spec_scope.</span></span>
<span class="code-fence-row"><span class="code-fence-index">7</span><span class="code-fence-code">Notation &quot;P -&gt;&gt; Q&quot; := (assert_implies P Q)</span></span>
<span class="code-fence-row"><span class="code-fence-index">8</span><span class="code-fence-code">                      (at level 80) : hoare_spec_scope.</span></span>
<span class="code-fence-row"><span class="code-fence-index">9</span><span class="code-fence-code">Open Scope hoare_spec_scope.</span></span>
<span class="code-fence-row"><span class="code-fence-index">10</span><span class="code-fence-code"></span></span>
<span class="code-fence-row"><span class="code-fence-index">11</span><span class="code-fence-code">Notation &quot;P &lt;&lt;-&gt;&gt; Q&quot; :=</span></span>
<span class="code-fence-row"><span class="code-fence-index">12</span><span class="code-fence-code">  (P -&gt;&gt; Q /\ Q -&gt;&gt; P) (at level 80) : hoare_spec_scope.</span></span>
<span class="code-fence-row"><span class="code-fence-index">13</span><span class="code-fence-code"></span></span>
<span class="code-fence-row"><span class="code-fence-index">14</span><span class="code-fence-code">Definition Aexp : Type := state -&gt; nat.</span></span>
<span class="code-fence-row"><span class="code-fence-index">15</span><span class="code-fence-code"></span></span>
<span class="code-fence-row"><span class="code-fence-index">16</span><span class="code-fence-code">Definition assert_of_Prop (P : Prop) : Assertion := fun _ =&gt; P.</span></span>
<span class="code-fence-row"><span class="code-fence-index">17</span><span class="code-fence-code">Definition Aexp_of_nat (n : nat) : Aexp := fun _ =&gt; n.</span></span>
<span class="code-fence-row"><span class="code-fence-index">18</span><span class="code-fence-code">Definition Aexp_of_aexp (a : aexp) : Aexp := fun st =&gt; aeval st a.</span></span>
<span class="code-fence-row"><span class="code-fence-index">19</span><span class="code-fence-code"></span></span>
<span class="code-fence-row"><span class="code-fence-index">20</span><span class="code-fence-code">Coercion assert_of_Prop : Sortclass &gt;-&gt; Assertion.</span></span>
<span class="code-fence-row"><span class="code-fence-index">21</span><span class="code-fence-code">Coercion Aexp_of_nat : nat &gt;-&gt; Aexp.</span></span>
<span class="code-fence-row"><span class="code-fence-index">22</span><span class="code-fence-code">Coercion Aexp_of_aexp : aexp &gt;-&gt; Aexp.</span></span>
<span class="code-fence-row"><span class="code-fence-index">23</span><span class="code-fence-code"></span></span>
<span class="code-fence-row"><span class="code-fence-index">24</span><span class="code-fence-code">Add Printing Coercion Aexp_of_nat Aexp_of_aexp assert_of_Prop.</span></span>
<span class="code-fence-row"><span class="code-fence-index">25</span><span class="code-fence-code"></span></span>
<span class="code-fence-row"><span class="code-fence-index">26</span><span class="code-fence-code">Arguments assert_of_Prop /.</span></span>
<span class="code-fence-row"><span class="code-fence-index">27</span><span class="code-fence-code">Arguments Aexp_of_nat /.</span></span>
<span class="code-fence-row"><span class="code-fence-index">28</span><span class="code-fence-code">Arguments Aexp_of_aexp /.</span></span>
<span class="code-fence-row"><span class="code-fence-index">29</span><span class="code-fence-code"></span></span>
<span class="code-fence-row"><span class="code-fence-index">30</span><span class="code-fence-code">Add Printing Coercion Aexp_of_nat Aexp_of_aexp assert_of_Prop.</span></span>
<span class="code-fence-row"><span class="code-fence-index">31</span><span class="code-fence-code"></span></span>
<span class="code-fence-row"><span class="code-fence-index">32</span><span class="code-fence-code">Declare Scope assertion_scope.</span></span>
<span class="code-fence-row"><span class="code-fence-index">33</span><span class="code-fence-code">Bind Scope assertion_scope with Assertion.</span></span>
<span class="code-fence-row"><span class="code-fence-index">34</span><span class="code-fence-code">Bind Scope assertion_scope with Aexp.</span></span>
<span class="code-fence-row"><span class="code-fence-index">35</span><span class="code-fence-code">Delimit Scope assertion_scope with assertion.</span></span>
<span class="code-fence-row"><span class="code-fence-index">36</span><span class="code-fence-code"></span></span>
<span class="code-fence-row"><span class="code-fence-index">37</span><span class="code-fence-code">Notation assert P := (P%assertion : Assertion).</span></span>
<span class="code-fence-row"><span class="code-fence-index">38</span><span class="code-fence-code">Notation mkAexp a := (a%assertion : Aexp).</span></span>
<span class="code-fence-row"><span class="code-fence-index">39</span><span class="code-fence-code">Notation &quot;~ P&quot; := (fun st =&gt; ~ assert P st) : assertion_scope.</span></span>
<span class="code-fence-row"><span class="code-fence-index">40</span><span class="code-fence-code">Notation &quot;P /\ Q&quot; := (fun st =&gt; assert P st /\ assert Q st) : assertion_scope.</span></span>
<span class="code-fence-row"><span class="code-fence-index">41</span><span class="code-fence-code">Notation &quot;P \/ Q&quot; := (fun st =&gt; assert P st \/ assert Q st) : assertion_scope.</span></span>
<span class="code-fence-row"><span class="code-fence-index">42</span><span class="code-fence-code">Notation &quot;P -&gt; Q&quot; := (fun st =&gt; assert P st -&gt; assert Q st) : assertion_scope.</span></span>
<span class="code-fence-row"><span class="code-fence-index">43</span><span class="code-fence-code">Notation &quot;P &lt;-&gt; Q&quot; := (fun st =&gt; assert P st &lt;-&gt; assert Q st) : assertion_scope.</span></span>
<span class="code-fence-row"><span class="code-fence-index">44</span><span class="code-fence-code">Notation &quot;a = b&quot; := (fun st =&gt; mkAexp a st = mkAexp b st) : assertion_scope.</span></span>
<span class="code-fence-row"><span class="code-fence-index">45</span><span class="code-fence-code">Notation &quot;a &lt;&gt; b&quot; := (fun st =&gt; mkAexp a st &lt;&gt; mkAexp b st) : assertion_scope.</span></span>
<span class="code-fence-row"><span class="code-fence-index">46</span><span class="code-fence-code">Notation &quot;a &lt;= b&quot; := (fun st =&gt; mkAexp a st &lt;= mkAexp b st) : assertion_scope.</span></span>
<span class="code-fence-row"><span class="code-fence-index">47</span><span class="code-fence-code">Notation &quot;a &lt; b&quot; := (fun st =&gt; mkAexp a st &lt; mkAexp b st) : assertion_scope.</span></span>
<span class="code-fence-row"><span class="code-fence-index">48</span><span class="code-fence-code">Notation &quot;a &gt;= b&quot; := (fun st =&gt; mkAexp a st &gt;= mkAexp b st) : assertion_scope.</span></span>
<span class="code-fence-row"><span class="code-fence-index">49</span><span class="code-fence-code">Notation &quot;a &gt; b&quot; := (fun st =&gt; mkAexp a st &gt; mkAexp b st) : assertion_scope.</span></span>
<span class="code-fence-row"><span class="code-fence-index">50</span><span class="code-fence-code">Notation &quot;a + b&quot; := (fun st =&gt; mkAexp a st + mkAexp b st) : assertion_scope.</span></span>
<span class="code-fence-row"><span class="code-fence-index">51</span><span class="code-fence-code">Notation &quot;a - b&quot; := (fun st =&gt; mkAexp a st - mkAexp b st) : assertion_scope.</span></span>
<span class="code-fence-row"><span class="code-fence-index">52</span><span class="code-fence-code">Notation &quot;a * b&quot; := (fun st =&gt; mkAexp a st * mkAexp b st) : assertion_scope.</span></span>
<span class="code-fence-row"><span class="code-fence-index">53</span><span class="code-fence-code"></span></span>
<span class="code-fence-row"><span class="code-fence-index">54</span><span class="code-fence-code">Definition ap {X} (f : nat -&gt; X) (x : Aexp) :=</span></span>
<span class="code-fence-row"><span class="code-fence-index">55</span><span class="code-fence-code">  fun st =&gt; f (x st).</span></span>
<span class="code-fence-row"><span class="code-fence-index">56</span><span class="code-fence-code">Definition ap2 {X} (f : nat -&gt; nat -&gt; X) (x : Aexp) (y : Aexp) (st : state) :=</span></span>
<span class="code-fence-row"><span class="code-fence-index">57</span><span class="code-fence-code">  f (x st) (y st).</span></span>
<span class="code-fence-row"><span class="code-fence-index">58</span><span class="code-fence-code"></span></span>
<span class="code-fence-row"><span class="code-fence-index">59</span><span class="code-fence-code">Definition hoare_triple</span></span>
<span class="code-fence-row"><span class="code-fence-index">60</span><span class="code-fence-code">           (P : Assertion) (c : com) (Q : Assertion) : Prop :=</span></span>
<span class="code-fence-row"><span class="code-fence-index">61</span><span class="code-fence-code">  forall st st&apos;,</span></span>
<span class="code-fence-row"><span class="code-fence-index">62</span><span class="code-fence-code">     st =[ c ]=&gt; st&apos; -&gt;</span></span>
<span class="code-fence-row"><span class="code-fence-index">63</span><span class="code-fence-code">     P st -&gt;</span></span>
<span class="code-fence-row"><span class="code-fence-index">64</span><span class="code-fence-code">     Q st&apos;.</span></span>
<span class="code-fence-row"><span class="code-fence-index">65</span><span class="code-fence-code"></span></span>
<span class="code-fence-row"><span class="code-fence-index">66</span><span class="code-fence-code">Notation &quot;{{ P }} c {{ Q }}&quot; :=</span></span>
<span class="code-fence-row"><span class="code-fence-index">67</span><span class="code-fence-code">  (hoare_triple P c Q) (at level 90, c custom com at level 99)</span></span>
<span class="code-fence-row"><span class="code-fence-index">68</span><span class="code-fence-code">  : hoare_spec_scope.</span></span>
<span class="code-fence-row"><span class="code-fence-index">69</span><span class="code-fence-code"></span></span>
<span class="code-fence-row"><span class="code-fence-index">70</span><span class="code-fence-code">Definition assn_sub X a (P:Assertion) : Assertion :=</span></span>
<span class="code-fence-row"><span class="code-fence-index">71</span><span class="code-fence-code">  fun (st : state) =&gt;</span></span>
<span class="code-fence-row"><span class="code-fence-index">72</span><span class="code-fence-code">    P (X !-&gt; aeval st a ; st).</span></span>
<span class="code-fence-row"><span class="code-fence-index">73</span><span class="code-fence-code"></span></span>
<span class="code-fence-row"><span class="code-fence-index">74</span><span class="code-fence-code">Notation &quot;P [ X |-&gt; a ]&quot; := (assn_sub X a P)</span></span>
<span class="code-fence-row"><span class="code-fence-index">75</span><span class="code-fence-code">  (at level 10, X at next level, a custom com).</span></span>
<span class="code-fence-row"><span class="code-fence-index">76</span><span class="code-fence-code"></span></span>
<span class="code-fence-row"><span class="code-fence-index">77</span><span class="code-fence-code">Theorem hoare_skip : forall P,</span></span>
<span class="code-fence-row"><span class="code-fence-index">78</span><span class="code-fence-code">     {{P}} skip {{P}}.</span></span>
<span class="code-fence-row"><span class="code-fence-index">79</span><span class="code-fence-code">Proof.</span></span>
<span class="code-fence-row"><span class="code-fence-index">80</span><span class="code-fence-code">  intros P st st&apos; H HP.</span></span>
<span class="code-fence-row"><span class="code-fence-index">81</span><span class="code-fence-code">  inversion H;</span></span>
<span class="code-fence-row"><span class="code-fence-index">82</span><span class="code-fence-code">  subst.</span></span>
<span class="code-fence-row"><span class="code-fence-index">83</span><span class="code-fence-code">  assumption.</span></span>
<span class="code-fence-row"><span class="code-fence-index">84</span><span class="code-fence-code">  Qed.</span></span>
<span class="code-fence-row"><span class="code-fence-index">85</span><span class="code-fence-code"></span></span>
<span class="code-fence-row"><span class="code-fence-index">86</span><span class="code-fence-code">Theorem hoare_seq : forall P Q R c1 c2,</span></span>
<span class="code-fence-row"><span class="code-fence-index">87</span><span class="code-fence-code">     {{Q}} c2 {{R}} -&gt;</span></span>
<span class="code-fence-row"><span class="code-fence-index">88</span><span class="code-fence-code">     {{P}} c1 {{Q}} -&gt;</span></span>
<span class="code-fence-row"><span class="code-fence-index">89</span><span class="code-fence-code">     {{P}} c1; c2 {{R}}.</span></span>
<span class="code-fence-row"><span class="code-fence-index">90</span><span class="code-fence-code">Proof.</span></span>
<span class="code-fence-row"><span class="code-fence-index">91</span><span class="code-fence-code">  unfold hoare_triple.</span></span>
<span class="code-fence-row"><span class="code-fence-index">92</span><span class="code-fence-code">  intros P Q R c1 c2 H1 H2 st st&apos; H12 Pre.</span></span>
<span class="code-fence-row"><span class="code-fence-index">93</span><span class="code-fence-code">  inversion H12;</span></span>
<span class="code-fence-row"><span class="code-fence-index">94</span><span class="code-fence-code">  subst.</span></span>
<span class="code-fence-row"><span class="code-fence-index">95</span><span class="code-fence-code">  eauto.</span></span>
<span class="code-fence-row"><span class="code-fence-index">96</span><span class="code-fence-code">  Qed.</span></span>
<span class="code-fence-row"><span class="code-fence-index">97</span><span class="code-fence-code"></span></span>
<span class="code-fence-row"><span class="code-fence-index">98</span><span class="code-fence-code">Theorem hoare_asgn: forall Q X a,</span></span>
<span class="code-fence-row"><span class="code-fence-index">99</span><span class="code-fence-code">  {{Q [X |-&gt; a]}} X := a {{Q}}.</span></span>
<span class="code-fence-row"><span class="code-fence-index">100</span><span class="code-fence-code">Proof.</span></span>
<span class="code-fence-row"><span class="code-fence-index">101</span><span class="code-fence-code">  unfold hoare_triple.</span></span>
<span class="code-fence-row"><span class="code-fence-index">102</span><span class="code-fence-code">  intros Q X a st st&apos; HE HQ.</span></span>
<span class="code-fence-row"><span class="code-fence-index">103</span><span class="code-fence-code">  inversion HE.</span></span>
<span class="code-fence-row"><span class="code-fence-index">104</span><span class="code-fence-code">  subst.</span></span>
<span class="code-fence-row"><span class="code-fence-index">105</span><span class="code-fence-code">  unfold assn_sub in HQ.</span></span>
<span class="code-fence-row"><span class="code-fence-index">106</span><span class="code-fence-code">  assumption.</span></span>
<span class="code-fence-row"><span class="code-fence-index">107</span><span class="code-fence-code">  Qed.</span></span>
<span class="code-fence-row"><span class="code-fence-index">108</span><span class="code-fence-code"></span></span>
<span class="code-fence-row"><span class="code-fence-index">109</span><span class="code-fence-code">Theorem hoare_consequence_pre : forall (P P&apos; Q : Assertion) c,</span></span>
<span class="code-fence-row"><span class="code-fence-index">110</span><span class="code-fence-code">  {{P&apos;}} c {{Q}} -&gt;</span></span>
<span class="code-fence-row"><span class="code-fence-index">111</span><span class="code-fence-code">  P -&gt;&gt; P&apos; -&gt;</span></span>
<span class="code-fence-row"><span class="code-fence-index">112</span><span class="code-fence-code">  {{P}} c {{Q}}.</span></span>
<span class="code-fence-row"><span class="code-fence-index">113</span><span class="code-fence-code">Proof.</span></span>
<span class="code-fence-row"><span class="code-fence-index">114</span><span class="code-fence-code">  intros p p&apos; q c H0 H1 st st&apos; H2 H3.</span></span>
<span class="code-fence-row"><span class="code-fence-index">115</span><span class="code-fence-code">  apply H0 with st. (* H0: {p&apos;} c {q} *)</span></span>
<span class="code-fence-row"><span class="code-fence-index">116</span><span class="code-fence-code">  - (* st =[ c ]=&gt; st&apos; *)</span></span>
<span class="code-fence-row"><span class="code-fence-index">117</span><span class="code-fence-code">    apply H2. (* H2: st =[ c ]=&gt; st&apos; *)</span></span>
<span class="code-fence-row"><span class="code-fence-index">118</span><span class="code-fence-code">  - (* p&apos; st *)</span></span>
<span class="code-fence-row"><span class="code-fence-index">119</span><span class="code-fence-code">    apply H1. (* H1: p -&gt;&gt; p&apos; *)</span></span>
<span class="code-fence-row"><span class="code-fence-index">120</span><span class="code-fence-code">    apply H3. (* H3: p st *)</span></span>
<span class="code-fence-row"><span class="code-fence-index">121</span><span class="code-fence-code">  Qed.</span></span>
<span class="code-fence-row"><span class="code-fence-index">122</span><span class="code-fence-code"></span></span>
<span class="code-fence-row"><span class="code-fence-index">123</span><span class="code-fence-code">Theorem hoare_consequence_post : forall (P Q Q&apos; : Assertion) c,</span></span>
<span class="code-fence-row"><span class="code-fence-index">124</span><span class="code-fence-code">  {{P}} c {{Q&apos;}} -&gt;</span></span>
<span class="code-fence-row"><span class="code-fence-index">125</span><span class="code-fence-code">  Q&apos; -&gt;&gt; Q -&gt;</span></span>
<span class="code-fence-row"><span class="code-fence-index">126</span><span class="code-fence-code">  {{P}} c {{Q}}.</span></span>
<span class="code-fence-row"><span class="code-fence-index">127</span><span class="code-fence-code">Proof.</span></span>
<span class="code-fence-row"><span class="code-fence-index">128</span><span class="code-fence-code">  intros p q q&apos; c H0 H1 st st&apos; H2 H3.</span></span>
<span class="code-fence-row"><span class="code-fence-index">129</span><span class="code-fence-code">  apply H1. (* H1: q&apos; -&gt;&gt; q *)</span></span>
<span class="code-fence-row"><span class="code-fence-index">130</span><span class="code-fence-code">  apply H0 with st. (* H0: {p} c {q&apos;} *)</span></span>
<span class="code-fence-row"><span class="code-fence-index">131</span><span class="code-fence-code">  - (* st =[ c ]=&gt; st&apos; *)</span></span>
<span class="code-fence-row"><span class="code-fence-index">132</span><span class="code-fence-code">    apply H2. (* H2: st =[ c ]=&gt; st&apos; *)</span></span>
<span class="code-fence-row"><span class="code-fence-index">133</span><span class="code-fence-code">  - (* p st *)</span></span>
<span class="code-fence-row"><span class="code-fence-index">134</span><span class="code-fence-code">    apply H3. (* H3: p st *)</span></span>
<span class="code-fence-row"><span class="code-fence-index">135</span><span class="code-fence-code">  Qed.</span></span>
<span class="code-fence-row"><span class="code-fence-index">136</span><span class="code-fence-code"></span></span>
<span class="code-fence-row"><span class="code-fence-index">137</span><span class="code-fence-code">Theorem hoare_consequence : forall (P P&apos; Q Q&apos; : Assertion) c,</span></span>
<span class="code-fence-row"><span class="code-fence-index">138</span><span class="code-fence-code">  {{P&apos;}} c {{Q&apos;}} -&gt;</span></span>
<span class="code-fence-row"><span class="code-fence-index">139</span><span class="code-fence-code">  P -&gt;&gt; P&apos; -&gt;</span></span>
<span class="code-fence-row"><span class="code-fence-index">140</span><span class="code-fence-code">  Q&apos; -&gt;&gt; Q -&gt;</span></span>
<span class="code-fence-row"><span class="code-fence-index">141</span><span class="code-fence-code">  {{P}} c {{Q}}.</span></span>
<span class="code-fence-row"><span class="code-fence-index">142</span><span class="code-fence-code">Proof.</span></span>
<span class="code-fence-row"><span class="code-fence-index">143</span><span class="code-fence-code">  intros P P&apos; Q Q&apos; c Htriple Hpre Hpost.</span></span>
<span class="code-fence-row"><span class="code-fence-index">144</span><span class="code-fence-code">  apply hoare_consequence_pre with (P&apos; := P&apos;).</span></span>
<span class="code-fence-row"><span class="code-fence-index">145</span><span class="code-fence-code">  - (* {P&apos;} c {Q} *)</span></span>
<span class="code-fence-row"><span class="code-fence-index">146</span><span class="code-fence-code">    apply hoare_consequence_post with (Q&apos; := Q&apos;).</span></span>
<span class="code-fence-row"><span class="code-fence-index">147</span><span class="code-fence-code">    + (* {P&apos;} c {Q&apos;} *)</span></span>
<span class="code-fence-row"><span class="code-fence-index">148</span><span class="code-fence-code">      assumption.</span></span>
<span class="code-fence-row"><span class="code-fence-index">149</span><span class="code-fence-code">    + (* Q&apos; -&gt;&gt; Q *)</span></span>
<span class="code-fence-row"><span class="code-fence-index">150</span><span class="code-fence-code">      assumption.</span></span>
<span class="code-fence-row"><span class="code-fence-index">151</span><span class="code-fence-code">  - (* P -&gt;&gt; P&apos; *)</span></span>
<span class="code-fence-row"><span class="code-fence-index">152</span><span class="code-fence-code">    assumption.</span></span>
<span class="code-fence-row"><span class="code-fence-index">153</span><span class="code-fence-code">  Qed.</span></span>
<span class="code-fence-row"><span class="code-fence-index">154</span><span class="code-fence-code"></span></span>
<span class="code-fence-row"><span class="code-fence-index">155</span><span class="code-fence-code">Hint Unfold assert_implies hoare_triple assn_sub t_update : core.</span></span>
<span class="code-fence-row"><span class="code-fence-index">156</span><span class="code-fence-code">Hint Unfold assert_of_Prop Aexp_of_nat Aexp_of_aexp : core.</span></span>
<span class="code-fence-row"><span class="code-fence-index">157</span><span class="code-fence-code"></span></span>
<span class="code-fence-row"><span class="code-fence-index">158</span><span class="code-fence-code">Definition bassn b : Assertion :=</span></span>
<span class="code-fence-row"><span class="code-fence-index">159</span><span class="code-fence-code">  fun st =&gt; (beval st b = true).</span></span>
<span class="code-fence-row"><span class="code-fence-index">160</span><span class="code-fence-code"></span></span>
<span class="code-fence-row"><span class="code-fence-index">161</span><span class="code-fence-code">Coercion bassn : bexp &gt;-&gt; Assertion.</span></span>
<span class="code-fence-row"><span class="code-fence-index">162</span><span class="code-fence-code">Arguments bassn /.</span></span>
<span class="code-fence-row"><span class="code-fence-index">163</span><span class="code-fence-code"></span></span>
<span class="code-fence-row"><span class="code-fence-index">164</span><span class="code-fence-code">Lemma bexp_eval_false : forall b st,</span></span>
<span class="code-fence-row"><span class="code-fence-index">165</span><span class="code-fence-code">  beval st b = false -&gt; ~ ((bassn b) st).</span></span>
<span class="code-fence-row"><span class="code-fence-index">166</span><span class="code-fence-code">Proof.</span></span>
<span class="code-fence-row"><span class="code-fence-index">167</span><span class="code-fence-code">  congruence.</span></span>
<span class="code-fence-row"><span class="code-fence-index">168</span><span class="code-fence-code">  Qed.</span></span>
<span class="code-fence-row"><span class="code-fence-index">169</span><span class="code-fence-code"></span></span>
<span class="code-fence-row"><span class="code-fence-index">170</span><span class="code-fence-code">Hint Resolve bexp_eval_false : core.</span></span>
<span class="code-fence-row"><span class="code-fence-index">171</span><span class="code-fence-code"></span></span>
<span class="code-fence-row"><span class="code-fence-index">172</span><span class="code-fence-code">Theorem hoare_if : forall P Q (b:bexp) c1 c2,</span></span>
<span class="code-fence-row"><span class="code-fence-index">173</span><span class="code-fence-code">  {{ P /\ b }} c1 {{Q}} -&gt;</span></span>
<span class="code-fence-row"><span class="code-fence-index">174</span><span class="code-fence-code">  {{ P /\ ~ b}} c2 {{Q}} -&gt;</span></span>
<span class="code-fence-row"><span class="code-fence-index">175</span><span class="code-fence-code">  {{P}} if b then c1 else c2 end {{Q}}.</span></span>
<span class="code-fence-row"><span class="code-fence-index">176</span><span class="code-fence-code">Proof.</span></span>
<span class="code-fence-row"><span class="code-fence-index">177</span><span class="code-fence-code">  intros P Q b c1 c2 H1 H2 st st&apos; H3 H4.</span></span>
<span class="code-fence-row"><span class="code-fence-index">178</span><span class="code-fence-code">  inversion H3;</span></span>
<span class="code-fence-row"><span class="code-fence-index">179</span><span class="code-fence-code">  eauto.</span></span>
<span class="code-fence-row"><span class="code-fence-index">180</span><span class="code-fence-code">  Qed.</span></span>
<span class="code-fence-row"><span class="code-fence-index">181</span><span class="code-fence-code"></span></span>
<span class="code-fence-row"><span class="code-fence-index">182</span><span class="code-fence-code">From Coq Require Import Arith.PeanoNat. Import Nat.</span></span>
<span class="code-fence-row"><span class="code-fence-index">183</span><span class="code-fence-code"></span></span>
<span class="code-fence-row"><span class="code-fence-index">184</span><span class="code-fence-code">Ltac assn_auto :=</span></span>
<span class="code-fence-row"><span class="code-fence-index">185</span><span class="code-fence-code">  unfold assert_implies, assn_sub, t_update, bassn;</span></span>
<span class="code-fence-row"><span class="code-fence-index">186</span><span class="code-fence-code">  intros st;</span></span>
<span class="code-fence-row"><span class="code-fence-index">187</span><span class="code-fence-code">  simpl in *;</span></span>
<span class="code-fence-row"><span class="code-fence-index">188</span><span class="code-fence-code">  try rewrite -&gt; eqb_eq in *;</span></span>
<span class="code-fence-row"><span class="code-fence-index">189</span><span class="code-fence-code">  try rewrite -&gt; leb_le in *;</span></span>
<span class="code-fence-row"><span class="code-fence-index">190</span><span class="code-fence-code">  auto;</span></span>
<span class="code-fence-row"><span class="code-fence-index">191</span><span class="code-fence-code">  try lia.</span></span>
<span class="code-fence-row"><span class="code-fence-index">192</span><span class="code-fence-code"></span></span>
<span class="code-fence-row"><span class="code-fence-index">193</span><span class="code-fence-code">Theorem hoare_while : forall P (b:bexp) c,</span></span>
<span class="code-fence-row"><span class="code-fence-index">194</span><span class="code-fence-code">  {{P /\ b}} c {{P}} -&gt;</span></span>
<span class="code-fence-row"><span class="code-fence-index">195</span><span class="code-fence-code">  {{P}} while b do c end {{P /\ ~ b}}.</span></span>
<span class="code-fence-row"><span class="code-fence-index">196</span><span class="code-fence-code">Proof.</span></span>
<span class="code-fence-row"><span class="code-fence-index">197</span><span class="code-fence-code">  intros P b c H_hoare st st&apos; H_while H_P.</span></span>
<span class="code-fence-row"><span class="code-fence-index">198</span><span class="code-fence-code">  remember &lt;{ while b do c end }&gt; as while_.</span></span>
<span class="code-fence-row"><span class="code-fence-index">199</span><span class="code-fence-code">  induction H_while;</span></span>
<span class="code-fence-row"><span class="code-fence-index">200</span><span class="code-fence-code">  try (inversion Heqwhile_);</span></span>
<span class="code-fence-row"><span class="code-fence-index">201</span><span class="code-fence-code">  subst;</span></span>
<span class="code-fence-row"><span class="code-fence-index">202</span><span class="code-fence-code">  eauto.</span></span>
<span class="code-fence-row"><span class="code-fence-index">203</span><span class="code-fence-code">  Qed.</span></span>
<span class="code-fence-row"><span class="code-fence-index">204</span><span class="code-fence-code"></span></span>
<span class="code-fence-row"><span class="code-fence-index">205</span><span class="code-fence-code">From Coq Require Import Bool.Bool.</span></span>
<span class="code-fence-row"><span class="code-fence-index">206</span><span class="code-fence-code">From Coq Require Import Arith.Arith.</span></span>
<span class="code-fence-row"><span class="code-fence-index">207</span><span class="code-fence-code">From Coq Require Import Arith.EqNat.</span></span>
<span class="code-fence-row"><span class="code-fence-index">208</span><span class="code-fence-code"></span></span>
<span class="code-fence-row"><span class="code-fence-index">209</span><span class="code-fence-code">Ltac verify_assn :=</span></span>
<span class="code-fence-row"><span class="code-fence-index">210</span><span class="code-fence-code">  repeat split;</span></span>
<span class="code-fence-row"><span class="code-fence-index">211</span><span class="code-fence-code">  simpl;</span></span>
<span class="code-fence-row"><span class="code-fence-index">212</span><span class="code-fence-code">  unfold assert_implies;</span></span>
<span class="code-fence-row"><span class="code-fence-index">213</span><span class="code-fence-code">  unfold ap in *; unfold ap2 in *;</span></span>
<span class="code-fence-row"><span class="code-fence-index">214</span><span class="code-fence-code">  unfold bassn in *; unfold beval in *; unfold aeval in *;</span></span>
<span class="code-fence-row"><span class="code-fence-index">215</span><span class="code-fence-code">  unfold assn_sub; intros;</span></span>
<span class="code-fence-row"><span class="code-fence-index">216</span><span class="code-fence-code">  repeat (simpl in *;</span></span>
<span class="code-fence-row"><span class="code-fence-index">217</span><span class="code-fence-code">          rewrite t_update_eq ||</span></span>
<span class="code-fence-row"><span class="code-fence-index">218</span><span class="code-fence-code">          (try rewrite t_update_neq;</span></span>
<span class="code-fence-row"><span class="code-fence-index">219</span><span class="code-fence-code">          [ | (intro X; inversion X; fail)]));</span></span>
<span class="code-fence-row"><span class="code-fence-index">220</span><span class="code-fence-code">  simpl in *;</span></span>
<span class="code-fence-row"><span class="code-fence-index">221</span><span class="code-fence-code">  repeat match goal with [H : _ /\ _ |- _] =&gt;</span></span>
<span class="code-fence-row"><span class="code-fence-index">222</span><span class="code-fence-code">                         destruct H end;</span></span>
<span class="code-fence-row"><span class="code-fence-index">223</span><span class="code-fence-code">  repeat rewrite not_true_iff_false in *;</span></span>
<span class="code-fence-row"><span class="code-fence-index">224</span><span class="code-fence-code">  repeat rewrite not_false_iff_true in *;</span></span>
<span class="code-fence-row"><span class="code-fence-index">225</span><span class="code-fence-code">  repeat rewrite negb_true_iff in *;</span></span>
<span class="code-fence-row"><span class="code-fence-index">226</span><span class="code-fence-code">  repeat rewrite negb_false_iff in *;</span></span>
<span class="code-fence-row"><span class="code-fence-index">227</span><span class="code-fence-code">  repeat rewrite eqb_eq in *;</span></span>
<span class="code-fence-row"><span class="code-fence-index">228</span><span class="code-fence-code">  repeat rewrite eqb_neq in *;</span></span>
<span class="code-fence-row"><span class="code-fence-index">229</span><span class="code-fence-code">  repeat rewrite leb_iff in *;</span></span>
<span class="code-fence-row"><span class="code-fence-index">230</span><span class="code-fence-code">  repeat rewrite leb_iff_conv in *;</span></span>
<span class="code-fence-row"><span class="code-fence-index">231</span><span class="code-fence-code">  try subst;</span></span>
<span class="code-fence-row"><span class="code-fence-index">232</span><span class="code-fence-code">  simpl in *;</span></span>
<span class="code-fence-row"><span class="code-fence-index">233</span><span class="code-fence-code">  repeat</span></span>
<span class="code-fence-row"><span class="code-fence-index">234</span><span class="code-fence-code">    match goal with</span></span>
<span class="code-fence-row"><span class="code-fence-index">235</span><span class="code-fence-code">      [st : state |- _] =&gt;</span></span>
<span class="code-fence-row"><span class="code-fence-index">236</span><span class="code-fence-code">        match goal with</span></span>
<span class="code-fence-row"><span class="code-fence-index">237</span><span class="code-fence-code">        | [H : st _ = _ |- _] =&gt;</span></span>
<span class="code-fence-row"><span class="code-fence-index">238</span><span class="code-fence-code">            rewrite -&gt; H in *; clear H</span></span>
<span class="code-fence-row"><span class="code-fence-index">239</span><span class="code-fence-code">        | [H : _ = st _ |- _] =&gt;</span></span>
<span class="code-fence-row"><span class="code-fence-index">240</span><span class="code-fence-code">            rewrite &lt;- H in *; clear H</span></span>
<span class="code-fence-row"><span class="code-fence-index">241</span><span class="code-fence-code">        end</span></span>
<span class="code-fence-row"><span class="code-fence-index">242</span><span class="code-fence-code">    end;</span></span>
<span class="code-fence-row"><span class="code-fence-index">243</span><span class="code-fence-code">  try eauto;</span></span>
<span class="code-fence-row"><span class="code-fence-index">244</span><span class="code-fence-code">  try lia.</span></span>
</code><button onclick="copy_code_to_clipboard(3)" class="copy-fenced-code">Copy</button></pre><h2 id="functional-programming">Functional Programming</h2><h3 id="map-filter-fold">Map, Filter, Fold</h3><pre class="fenced-code-block line-num-width-1"><code><span class="code-fence-row"><span class="code-fence-index">1</span><span class="code-fence-code"><span class="color-violet">Fixpoint</span> <span class="color-aqua">filter</span><span class="color-white"> {</span><span class="color-red">X</span> <span class="color-white">:</span> <span class="color-white">Type</span><span class="color-dark">}</span> <span class="color-white">(</span><span class="color-red">test</span> <span class="color-white">:</span> <span class="color-red">X</span> <span class="color-white">-</span><span class="color-white">&gt;</span> <span class="color-emerald">bool</span><span class="color-white">)</span> <span class="color-white">(</span><span class="color-red">l</span> <span class="color-white">:</span> <span class="color-emerald">list</span> <span class="color-red">X</span><span class="color-white">)</span> <span class="color-white">:</span> <span class="color-emerald">list</span> <span class="color-red">X</span> <span class="color-white">:=</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">2</span><span class="code-fence-code">  <span class="color-violet">match</span> <span class="color-red">l</span> <span class="color-violet">with</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">3</span><span class="code-fence-code">  <span class="color-white">|</span> <span class="color-white">nil</span> <span class="color-white">=</span><span class="color-white">&gt;</span> <span class="color-white">nil</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">4</span><span class="code-fence-code">  <span class="color-white">|</span> <span class="color-red">h</span> <span class="color-white">::</span> <span class="color-red">t</span> <span class="color-white">=</span><span class="color-white">&gt;</span> <span class="color-violet">if</span> <span class="color-red">test</span> <span class="color-red">h</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">5</span><span class="code-fence-code">    <span class="color-violet">then</span> <span class="color-red">h</span> <span class="color-white">::</span> <span class="color-white">(</span><span class="color-red">filter</span> <span class="color-red">test</span> <span class="color-red">t</span><span class="color-white">)</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">6</span><span class="code-fence-code">    <span class="color-violet">else</span> <span class="color-red">filter</span> <span class="color-red">test</span> <span class="color-red">t</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">7</span><span class="code-fence-code">  <span class="color-violet">end</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">8</span><span class="code-fence-code"></span></span>
<span class="code-fence-row"><span class="code-fence-index">9</span><span class="code-fence-code"><span class="color-violet">Fixpoint</span> <span class="color-aqua">map</span><span class="color-white"> {</span><span class="color-red">X</span> <span class="color-red">Y</span> <span class="color-white">:</span> <span class="color-white">Type</span><span class="color-dark">}</span> <span class="color-white">(</span><span class="color-red">f</span> <span class="color-white">:</span> <span class="color-red">X</span> <span class="color-white">-</span><span class="color-white">&gt;</span> <span class="color-red">Y</span><span class="color-white">)</span> <span class="color-white">(</span><span class="color-red">l</span> <span class="color-white">:</span> <span class="color-emerald">list</span> <span class="color-red">X</span><span class="color-white">)</span> <span class="color-white">:</span> <span class="color-emerald">list</span> <span class="color-red">Y</span> <span class="color-white">:=</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">10</span><span class="code-fence-code">  <span class="color-violet">match</span> <span class="color-red">l</span> <span class="color-violet">with</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">11</span><span class="code-fence-code">  <span class="color-white">|</span> <span class="color-white">[</span><span class="color-white">]</span> <span class="color-white">=</span><span class="color-white">&gt;</span> <span class="color-white">[</span><span class="color-white">]</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">12</span><span class="code-fence-code">  <span class="color-white">|</span> <span class="color-red">h</span> <span class="color-white">::</span> <span class="color-red">t</span> <span class="color-white">=</span><span class="color-white">&gt;</span> <span class="color-white">(</span><span class="color-red">f</span> <span class="color-red">h</span><span class="color-white">)</span> <span class="color-white">::</span> <span class="color-white">(</span><span class="color-red">map</span> <span class="color-red">f</span> <span class="color-red">t</span><span class="color-white">)</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">13</span><span class="code-fence-code">  <span class="color-violet">end</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">14</span><span class="code-fence-code"></span></span>
<span class="code-fence-row"><span class="code-fence-index">15</span><span class="code-fence-code"><span class="color-violet">Fixpoint</span> <span class="color-aqua">fold</span><span class="color-white"> {</span><span class="color-red">X</span> <span class="color-red">Y</span><span class="color-white">:</span> <span class="color-white">Type</span><span class="color-dark">}</span> <span class="color-white">(</span><span class="color-red">f</span> <span class="color-white">:</span> <span class="color-red">X</span> <span class="color-white">-</span><span class="color-white">&gt;</span> <span class="color-red">Y</span> <span class="color-white">-</span><span class="color-white">&gt;</span> <span class="color-red">Y</span><span class="color-white">)</span> <span class="color-white">(</span><span class="color-red">l</span> <span class="color-white">:</span> <span class="color-emerald">list</span> <span class="color-red">X</span><span class="color-white">)</span> <span class="color-white">(</span><span class="color-red">b</span> <span class="color-white">:</span> <span class="color-red">Y</span><span class="color-white">)</span> <span class="color-white">:</span> <span class="color-red">Y</span> <span class="color-white">:=</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">16</span><span class="code-fence-code">  <span class="color-violet">match</span> <span class="color-red">l</span> <span class="color-violet">with</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">17</span><span class="code-fence-code">  <span class="color-white">|</span> <span class="color-white">[</span><span class="color-white">]</span> <span class="color-white">=</span><span class="color-white">&gt;</span> <span class="color-red">b</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">18</span><span class="code-fence-code">  <span class="color-white">|</span> <span class="color-red">h</span> <span class="color-white">::</span> <span class="color-red">t</span> <span class="color-white">=</span><span class="color-white">&gt;</span> <span class="color-red">f</span> <span class="color-red">h</span> <span class="color-white">(</span><span class="color-red">fold</span> <span class="color-red">f</span> <span class="color-red">t</span> <span class="color-red">b</span><span class="color-white">)</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">19</span><span class="code-fence-code">  <span class="color-violet">end</span><span class="color-white">.</span></span></span>
</code><button onclick="copy_code_to_clipboard(4)" class="copy-fenced-code">Copy</button></pre><h3 id="currying">Currying</h3><p>pair와 prod의 정의도 포함시켰습니다.</p><pre class="fenced-code-block line-num-width-1"><code><span class="code-fence-row"><span class="code-fence-index">1</span><span class="code-fence-code">Inductive prod (X Y : Type) : Type :=</span></span>
<span class="code-fence-row"><span class="code-fence-index">2</span><span class="code-fence-code">| pair (x : X) (y : Y).</span></span>
<span class="code-fence-row"><span class="code-fence-index">3</span><span class="code-fence-code"></span></span>
<span class="code-fence-row"><span class="code-fence-index">4</span><span class="code-fence-code">Arguments pair {X} {Y}.</span></span>
<span class="code-fence-row"><span class="code-fence-index">5</span><span class="code-fence-code">Notation &quot;( x , y )&quot; := (pair x y).</span></span>
<span class="code-fence-row"><span class="code-fence-index">6</span><span class="code-fence-code">Notation &quot;X * Y&quot; := (prod X Y) : type_scope.</span></span>
<span class="code-fence-row"><span class="code-fence-index">7</span><span class="code-fence-code"></span></span>
<span class="code-fence-row"><span class="code-fence-index">8</span><span class="code-fence-code">Definition fst {X Y : Type} (p : X * Y) : X :=</span></span>
<span class="code-fence-row"><span class="code-fence-index">9</span><span class="code-fence-code">  match p with</span></span>
<span class="code-fence-row"><span class="code-fence-index">10</span><span class="code-fence-code">  | (x, y) =&gt; x</span></span>
<span class="code-fence-row"><span class="code-fence-index">11</span><span class="code-fence-code">  end.</span></span>
<span class="code-fence-row"><span class="code-fence-index">12</span><span class="code-fence-code">Definition snd {X Y : Type} (p : X * Y) : Y :=</span></span>
<span class="code-fence-row"><span class="code-fence-index">13</span><span class="code-fence-code">  match p with</span></span>
<span class="code-fence-row"><span class="code-fence-index">14</span><span class="code-fence-code">  | (x, y) =&gt; y</span></span>
<span class="code-fence-row"><span class="code-fence-index">15</span><span class="code-fence-code">  end.</span></span>
<span class="code-fence-row"><span class="code-fence-index">16</span><span class="code-fence-code"></span></span>
<span class="code-fence-row"><span class="code-fence-index">17</span><span class="code-fence-code">Definition prod_curry {X Y Z : Type}</span></span>
<span class="code-fence-row"><span class="code-fence-index">18</span><span class="code-fence-code">  (f : X * Y -&gt; Z) (x : X) (y : Y) : Z := f (x, y).</span></span>
<span class="code-fence-row"><span class="code-fence-index">19</span><span class="code-fence-code"></span></span>
<span class="code-fence-row"><span class="code-fence-index">20</span><span class="code-fence-code">Definition prod_uncurry {X Y Z : Type}</span></span>
<span class="code-fence-row"><span class="code-fence-index">21</span><span class="code-fence-code">  (f : X -&gt; Y -&gt; Z) (x : X * Y) : Z := f (fst x) (snd x).</span></span>
</code><button onclick="copy_code_to_clipboard(5)" class="copy-fenced-code">Copy</button></pre><h2 id="natural-numbers">Natural Numbers</h2><pre class="fenced-code-block line-num-width-1"><code><span class="code-fence-row"><span class="code-fence-index">1</span><span class="code-fence-code">Fixpoint div2 (n : nat) :=</span></span>
<span class="code-fence-row"><span class="code-fence-index">2</span><span class="code-fence-code">  match n with</span></span>
<span class="code-fence-row"><span class="code-fence-index">3</span><span class="code-fence-code">  | 0 =&gt; 0</span></span>
<span class="code-fence-row"><span class="code-fence-index">4</span><span class="code-fence-code">  | 1 =&gt; 0</span></span>
<span class="code-fence-row"><span class="code-fence-index">5</span><span class="code-fence-code">  | S (S n) =&gt; S (div2 n)</span></span>
<span class="code-fence-row"><span class="code-fence-index">6</span><span class="code-fence-code">  end.</span></span>
<span class="code-fence-row"><span class="code-fence-index">7</span><span class="code-fence-code"></span></span>
<span class="code-fence-row"><span class="code-fence-index">8</span><span class="code-fence-code">Fixpoint double (n:nat) :=</span></span>
<span class="code-fence-row"><span class="code-fence-index">9</span><span class="code-fence-code">  match n with</span></span>
<span class="code-fence-row"><span class="code-fence-index">10</span><span class="code-fence-code">  | O =&gt; O</span></span>
<span class="code-fence-row"><span class="code-fence-index">11</span><span class="code-fence-code">  | S n&apos; =&gt; S (S (double n&apos;))</span></span>
<span class="code-fence-row"><span class="code-fence-index">12</span><span class="code-fence-code">  end.</span></span>
<span class="code-fence-row"><span class="code-fence-index">13</span><span class="code-fence-code"></span></span>
<span class="code-fence-row"><span class="code-fence-index">14</span><span class="code-fence-code">Definition Even x := exists n : nat, x = double n.</span></span>
<span class="code-fence-row"><span class="code-fence-index">15</span><span class="code-fence-code"></span></span>
<span class="code-fence-row"><span class="code-fence-index">16</span><span class="code-fence-code">Fixpoint even (n : nat) :=</span></span>
<span class="code-fence-row"><span class="code-fence-index">17</span><span class="code-fence-code">  match n with</span></span>
<span class="code-fence-row"><span class="code-fence-index">18</span><span class="code-fence-code">  | 0 =&gt; true</span></span>
<span class="code-fence-row"><span class="code-fence-index">19</span><span class="code-fence-code">  | S 0 =&gt; false</span></span>
<span class="code-fence-row"><span class="code-fence-index">20</span><span class="code-fence-code">  | S (S n) =&gt; even n</span></span>
<span class="code-fence-row"><span class="code-fence-index">21</span><span class="code-fence-code">  end.</span></span>
<span class="code-fence-row"><span class="code-fence-index">22</span><span class="code-fence-code"></span></span>
<span class="code-fence-row"><span class="code-fence-index">23</span><span class="code-fence-code">Theorem add_0_r : forall n : nat, n + 0 = n.</span></span>
<span class="code-fence-row"><span class="code-fence-index">24</span><span class="code-fence-code">Proof.</span></span>
<span class="code-fence-row"><span class="code-fence-index">25</span><span class="code-fence-code">  intros n. induction n as [ | n&apos; IHn&apos;].</span></span>
<span class="code-fence-row"><span class="code-fence-index">26</span><span class="code-fence-code">  - (* n = 0 *)</span></span>
<span class="code-fence-row"><span class="code-fence-index">27</span><span class="code-fence-code">    reflexivity.</span></span>
<span class="code-fence-row"><span class="code-fence-index">28</span><span class="code-fence-code">  - (* n = S n&apos; *)</span></span>
<span class="code-fence-row"><span class="code-fence-index">29</span><span class="code-fence-code">    simpl.</span></span>
<span class="code-fence-row"><span class="code-fence-index">30</span><span class="code-fence-code">    rewrite -&gt; IHn&apos;.</span></span>
<span class="code-fence-row"><span class="code-fence-index">31</span><span class="code-fence-code">    reflexivity.</span></span>
<span class="code-fence-row"><span class="code-fence-index">32</span><span class="code-fence-code">  Qed.</span></span>
<span class="code-fence-row"><span class="code-fence-index">33</span><span class="code-fence-code"></span></span>
<span class="code-fence-row"><span class="code-fence-index">34</span><span class="code-fence-code">Theorem add_comm : forall n m : nat,</span></span>
<span class="code-fence-row"><span class="code-fence-index">35</span><span class="code-fence-code">  n + m = m + n.</span></span>
<span class="code-fence-row"><span class="code-fence-index">36</span><span class="code-fence-code">Proof.</span></span>
<span class="code-fence-row"><span class="code-fence-index">37</span><span class="code-fence-code">  induction n as [ | n&apos;].</span></span>
<span class="code-fence-row"><span class="code-fence-index">38</span><span class="code-fence-code">  - (* n = O *)</span></span>
<span class="code-fence-row"><span class="code-fence-index">39</span><span class="code-fence-code">    intros m.</span></span>
<span class="code-fence-row"><span class="code-fence-index">40</span><span class="code-fence-code">    rewrite -&gt; add_0_r.</span></span>
<span class="code-fence-row"><span class="code-fence-index">41</span><span class="code-fence-code">    reflexivity.</span></span>
<span class="code-fence-row"><span class="code-fence-index">42</span><span class="code-fence-code">  - (* n = S n&apos; *)</span></span>
<span class="code-fence-row"><span class="code-fence-index">43</span><span class="code-fence-code">    intros m. simpl.</span></span>
<span class="code-fence-row"><span class="code-fence-index">44</span><span class="code-fence-code">    rewrite -&gt; IHn&apos;.</span></span>
<span class="code-fence-row"><span class="code-fence-index">45</span><span class="code-fence-code">    rewrite &lt;- plus_n_Sm.</span></span>
<span class="code-fence-row"><span class="code-fence-index">46</span><span class="code-fence-code">    reflexivity.</span></span>
<span class="code-fence-row"><span class="code-fence-index">47</span><span class="code-fence-code">  Qed.</span></span>
<span class="code-fence-row"><span class="code-fence-index">48</span><span class="code-fence-code"></span></span>
<span class="code-fence-row"><span class="code-fence-index">49</span><span class="code-fence-code">Fixpoint eqb (n m : nat) : bool :=</span></span>
<span class="code-fence-row"><span class="code-fence-index">50</span><span class="code-fence-code">  match n with</span></span>
<span class="code-fence-row"><span class="code-fence-index">51</span><span class="code-fence-code">  | O =&gt; match m with</span></span>
<span class="code-fence-row"><span class="code-fence-index">52</span><span class="code-fence-code">    | O =&gt; true</span></span>
<span class="code-fence-row"><span class="code-fence-index">53</span><span class="code-fence-code">    | _ =&gt; false</span></span>
<span class="code-fence-row"><span class="code-fence-index">54</span><span class="code-fence-code">    end</span></span>
<span class="code-fence-row"><span class="code-fence-index">55</span><span class="code-fence-code">  | S n&apos; =&gt; match m with</span></span>
<span class="code-fence-row"><span class="code-fence-index">56</span><span class="code-fence-code">    | O =&gt; false</span></span>
<span class="code-fence-row"><span class="code-fence-index">57</span><span class="code-fence-code">    | S m&apos; =&gt; eqb n&apos; m&apos;</span></span>
<span class="code-fence-row"><span class="code-fence-index">58</span><span class="code-fence-code">    end</span></span>
<span class="code-fence-row"><span class="code-fence-index">59</span><span class="code-fence-code">  end.</span></span>
<span class="code-fence-row"><span class="code-fence-index">60</span><span class="code-fence-code"></span></span>
<span class="code-fence-row"><span class="code-fence-index">61</span><span class="code-fence-code">Fixpoint leb (m n : nat) : bool :=</span></span>
<span class="code-fence-row"><span class="code-fence-index">62</span><span class="code-fence-code">  match m with</span></span>
<span class="code-fence-row"><span class="code-fence-index">63</span><span class="code-fence-code">  | O =&gt; true</span></span>
<span class="code-fence-row"><span class="code-fence-index">64</span><span class="code-fence-code">  | S m&apos; =&gt; match n with</span></span>
<span class="code-fence-row"><span class="code-fence-index">65</span><span class="code-fence-code">    | O =&gt; false</span></span>
<span class="code-fence-row"><span class="code-fence-index">66</span><span class="code-fence-code">    | S n&apos; =&gt; leb m&apos; n&apos;</span></span>
<span class="code-fence-row"><span class="code-fence-index">67</span><span class="code-fence-code">    end</span></span>
<span class="code-fence-row"><span class="code-fence-index">68</span><span class="code-fence-code">  end.</span></span>
<span class="code-fence-row"><span class="code-fence-index">69</span><span class="code-fence-code"></span></span>
<span class="code-fence-row"><span class="code-fence-index">70</span><span class="code-fence-code">Notation &quot;x =? y&quot; := (eqb x y) (at level 70) : nat_scope.</span></span>
<span class="code-fence-row"><span class="code-fence-index">71</span><span class="code-fence-code">Notation &quot;x &lt;=? y&quot; := (leb x y) (at level 70) : nat_scope.</span></span>
</code><button onclick="copy_code_to_clipboard(6)" class="copy-fenced-code">Copy</button></pre><h2 id="list">List</h2><pre class="fenced-code-block line-num-width-1"><code><span class="code-fence-row"><span class="code-fence-index">1</span><span class="code-fence-code">Inductive list (X : Type) : Type :=</span></span>
<span class="code-fence-row"><span class="code-fence-index">2</span><span class="code-fence-code">  | nil</span></span>
<span class="code-fence-row"><span class="code-fence-index">3</span><span class="code-fence-code">  | cons (x : X) (l : list X).</span></span>
<span class="code-fence-row"><span class="code-fence-index">4</span><span class="code-fence-code"></span></span>
<span class="code-fence-row"><span class="code-fence-index">5</span><span class="code-fence-code">Arguments nil {X}.</span></span>
<span class="code-fence-row"><span class="code-fence-index">6</span><span class="code-fence-code">Arguments cons {X}.</span></span>
<span class="code-fence-row"><span class="code-fence-index">7</span><span class="code-fence-code"></span></span>
<span class="code-fence-row"><span class="code-fence-index">8</span><span class="code-fence-code">Notation &quot;x :: l&quot; := (cons x l)</span></span>
<span class="code-fence-row"><span class="code-fence-index">9</span><span class="code-fence-code">                     (at level 60, right associativity).</span></span>
<span class="code-fence-row"><span class="code-fence-index">10</span><span class="code-fence-code">Notation &quot;[ ]&quot; := nil.</span></span>
<span class="code-fence-row"><span class="code-fence-index">11</span><span class="code-fence-code">Notation &quot;[ x ; .. ; y ]&quot; := (cons x .. (cons y nil) ..).</span></span>
<span class="code-fence-row"><span class="code-fence-index">12</span><span class="code-fence-code"></span></span>
<span class="code-fence-row"><span class="code-fence-index">13</span><span class="code-fence-code">Fixpoint append {X : Type} (l1 l2 : list X) : list X :=</span></span>
<span class="code-fence-row"><span class="code-fence-index">14</span><span class="code-fence-code">  match l1 with</span></span>
<span class="code-fence-row"><span class="code-fence-index">15</span><span class="code-fence-code">  | nil =&gt; l2</span></span>
<span class="code-fence-row"><span class="code-fence-index">16</span><span class="code-fence-code">  | h :: t =&gt; h :: (append t l2)</span></span>
<span class="code-fence-row"><span class="code-fence-index">17</span><span class="code-fence-code">  end.</span></span>
<span class="code-fence-row"><span class="code-fence-index">18</span><span class="code-fence-code"></span></span>
<span class="code-fence-row"><span class="code-fence-index">19</span><span class="code-fence-code">Notation &quot;x ++ y&quot; := (append x y)</span></span>
<span class="code-fence-row"><span class="code-fence-index">20</span><span class="code-fence-code">                     (right associativity, at level 60).</span></span>
</code><button onclick="copy_code_to_clipboard(7)" class="copy-fenced-code">Copy</button></pre><script>/*<![CDATA[*/
const fenced_code_block_contents = ["Require Export Coq.Strings.String.\n\nDefinition total_map (A : Type) := string -> A.\n\nDefinition t_empty {A : Type} (v : A) : total_map A := (fun _ => v).\n\nDefinition t_update {A : Type} (m : total_map A)\n                    (x : string) (v : A) :=\n  fun x' => if String.eqb x x' then v else m x'.\n\nNotation \"'_' '!->' v\" := (t_empty v)\n  (at level 100, right associativity).\n\nNotation \"x '!->' v ';' m\" := (t_update m x v)\n  (at level 100, v at next level, right associativity).\n\nLemma t_update_eq : forall (A : Type) (m : total_map A) x v,\n  (x !-> v ; m) x = v.\nProof.\nAdmitted.\n\nTheorem t_update_neq : forall (A : Type) (m : total_map A) x1 x2 v,\n  x1 <> x2 ->\n  (x1 !-> v ; m) x2 = m x2.\nProof.\nAdmitted.", "From Coq Require Import Lia.\nFrom Coq Require Import Init.Nat.\nDefinition state := total_map nat.\n\nDefinition W : string := \"W\".\nDefinition X : string := \"X\".\nDefinition Y : string := \"Y\".\nDefinition Z : string := \"Z\".\n\nInductive aexp : Type :=\n  | ANum (n : nat)\n  | AId (x : string)\n  | APlus (a1 a2 : aexp)\n  | AMinus (a1 a2 : aexp)\n  | AMult (a1 a2 : aexp).\n\nInductive bexp : Type :=\n  | BTrue\n  | BFalse\n  | BEq (a1 a2 : aexp)\n  | BNeq (a1 a2 : aexp)\n  | BLe (a1 a2 : aexp)\n  | BGt (a1 a2 : aexp)\n  | BNot (b : bexp)\n  | BAnd (b1 b2 : bexp).\n\nInductive com : Type :=\n  | CSkip\n  | CAsgn (x : string) (a : aexp)\n  | CSeq (c1 c2 : com)\n  | CIf (b : bexp) (c1 c2 : com)\n  | CWhile (b : bexp) (c : com).\n\nCoercion AId : string >-> aexp.\nCoercion ANum : nat >-> aexp.\nDeclare Custom Entry com.\nDeclare Scope com_scope.\nNotation \"<{ e }>\" := e (at level 0, e custom com at level 99) : com_scope.\nNotation \"( x )\" := x (in custom com, x at level 99) : com_scope.\nNotation \"x\" := x (in custom com at level 0, x constr at level 0) : com_scope.\nNotation \"f x .. y\" := (.. (f x) .. y)\n                  (in custom com at level 0, only parsing,\n                  f constr at level 0, x constr at level 9,\n                  y constr at level 9) : com_scope.\nNotation \"x + y\" := (APlus x y) (in custom com at level 50, left associativity).\nNotation \"x - y\" := (AMinus x y) (in custom com at level 50, left associativity).\nNotation \"x * y\" := (AMult x y) (in custom com at level 40, left associativity).\nNotation \"'true'\" := true (at level 1).\nNotation \"'true'\" := BTrue (in custom com at level 0).\nNotation \"'false'\" := false (at level 1).\nNotation \"'false'\" := BFalse (in custom com at level 0).\nNotation \"x <= y\" := (BLe x y) (in custom com at level 70, no associativity).\nNotation \"x > y\" := (BGt x y) (in custom com at level 70, no associativity).\nNotation \"x = y\" := (BEq x y) (in custom com at level 70, no associativity).\nNotation \"x <> y\" := (BNeq x y) (in custom com at level 70, no associativity).\nNotation \"x && y\" := (BAnd x y) (in custom com at level 80, left associativity).\nNotation \"'~' b\" := (BNot b) (in custom com at level 75, right associativity).\nOpen Scope com_scope.\n\nNotation \"'skip'\" :=\n         CSkip (in custom com at level 0) : com_scope.\nNotation \"x := y\" :=\n         (CAsgn x y)\n            (in custom com at level 0, x constr at level 0,\n             y at level 85, no associativity) : com_scope.\nNotation \"x ; y\" :=\n         (CSeq x y)\n           (in custom com at level 90, right associativity) : com_scope.\nNotation \"'if' x 'then' y 'else' z 'end'\" :=\n         (CIf x y z)\n           (in custom com at level 89, x at level 99,\n            y at level 99, z at level 99) : com_scope.\nNotation \"'while' x 'do' y 'end'\" :=\n         (CWhile x y)\n            (in custom com at level 89, x at level 99, y at level 99) : com_scope.\n\nFixpoint aeval (st : state) (a : aexp) : nat :=\n  match a with\n  | ANum n => n\n  | AId x => st x\n  | <{a1 + a2}> => (aeval st a1) + (aeval st a2)\n  | <{a1 - a2}> => (aeval st a1) - (aeval st a2)\n  | <{a1 * a2}> => (aeval st a1) * (aeval st a2)\n  end.\n\nFixpoint beval (st : state) (b : bexp) : bool :=\n  match b with\n  | <{true}> => true\n  | <{false}> => false\n  | <{a1 = a2}> => (aeval st a1) =? (aeval st a2)\n  | <{a1 <> a2}> => negb ((aeval st a1) =? (aeval st a2))\n  | <{a1 <= a2}> => (aeval st a1) <=? (aeval st a2)\n  | <{a1 > a2}> => negb ((aeval st a1) <=? (aeval st a2))\n  | <{~ b1}> => negb (beval st b1)\n  | <{b1 && b2}> => andb (beval st b1) (beval st b2)\n  end.\n\nReserved Notation\n         \"st '=[' c ']=>' st'\"\n         (at level 40, c custom com at level 99,\n          st constr, st' constr at next level).\nInductive ceval : com -> state -> state -> Prop :=\n  | E_Skip : forall st,\n      st =[ skip ]=> st\n  | E_Asgn : forall st a n x,\n      aeval st a = n ->\n      st =[ x := a ]=> (x !-> n ; st)\n  | E_Seq : forall c1 c2 st st' st'',\n      st =[ c1 ]=> st' ->\n      st' =[ c2 ]=> st'' ->\n      st =[ c1 ; c2 ]=> st''\n  | E_IfTrue : forall st st' b c1 c2,\n      beval st b = true ->\n      st =[ c1 ]=> st' ->\n      st =[ if b then c1 else c2 end]=> st'\n  | E_IfFalse : forall st st' b c1 c2,\n      beval st b = false ->\n      st =[ c2 ]=> st' ->\n      st =[ if b then c1 else c2 end]=> st'\n  | E_WhileFalse : forall b st c,\n      beval st b = false ->\n      st =[ while b do c end ]=> st\n  | E_WhileTrue : forall st st' st'' b c,\n      beval st b = true ->\n      st =[ c ]=> st' ->\n      st' =[ while b do c end ]=> st'' ->\n      st =[ while b do c end ]=> st''\n\n  where \"st =[ c ]=> st'\" := (ceval c st st').", "Definition aequiv (a1 a2 : aexp) : Prop :=\n  forall (st : state),\n    aeval st a1 = aeval st a2.\n\nDefinition bequiv (b1 b2 : bexp) : Prop :=\n  forall (st : state),\n    beval st b1 = beval st b2.\n\nDefinition cequiv (c1 c2 : com) : Prop :=\n  forall (st st' : state),\n    (st =[ c1 ]=> st') <-> (st =[ c2 ]=> st').\n\nTheorem if_true: forall b c1 c2,\n  bequiv b <{true}> ->\n  cequiv\n    <{ if b then c1 else c2 end }>\n    c1.\nProof.\n  intros b c1 c2 H st st'.\n  split;\n  intros H2.\n  - (* if -> c1 *)\n    inversion H2;\n    subst.\n    + (* H7: st =[c1]=> st' *)\n      assumption.\n    + (* H7: st =[c2]=> st' *)\n      rewrite H in H6.\n      unfold beval in H6.\n      discriminate.\n  - (* c1 -> if *)\n    apply E_IfTrue.\n    + (* b = true *)\n      apply H.\n    + (* st =[c1]=> st' *)\n      assumption.\n  Qed.\n\nTheorem if_false: forall b c1 c2,\n  bequiv b <{false}> ->\n  cequiv\n    <{ if b then c1 else c2 end }>\n    c2.\nProof.\n  intros b c1 c2 H st st'.\n  split;\n  intros H2.\n  - (* if -> c2 *)\n    inversion H2;\n    subst.\n    + (* H7: st =[ c1 ]=> st' *)\n      rewrite H in H6.\n      unfold beval in H6.\n      discriminate.\n    + (* H7: st =[c2]=> st' *)\n      assumption.\n  - (* c2 -> if *)\n    apply E_IfFalse.\n    + (* b = false *)\n      apply H.\n    + (* st =[c2]=> st' *)\n      assumption.\n  Qed.\n\nTheorem while_false : forall b c,\n  bequiv b <{false}> ->\n  cequiv\n    <{ while b do c end }>\n    <{ skip }>.\nProof.\n  intros b c Hb.\n  split;\n  intros H.\n  - (* while -> skip *)\n    inversion H. subst.\n    + (* E_WhileFalse *)\n      apply E_Skip.\n    + (* E_WhileTrue *)\n      rewrite Hb in H2.\n      discriminate.\n  - (* skip -> while *)\n    inversion H.\n    subst.\n    apply E_WhileFalse.\n    apply Hb.\n  Qed.\n\nLemma while_true_nonterm : forall b c st st',\n  bequiv b <{true}> ->\n  ~( st =[ while b do c end ]=> st' ).\nProof.\n  intros b c st st' Hb H.\n  remember <{ while b do c end }> as cw eqn:Heqcw.\n  induction H;\n  inversion Heqcw;\n  subst;\n  clear Heqcw.\n  (* The two interesting cases are the ones for while loops: *)\n  - (* E_WhileFalse *)\n    unfold bequiv in Hb.\n    (* rewrite is able to instantiate the quantifier in st *)\n    rewrite Hb in H.\n    discriminate.\n  - (* E_WhileTrue *)\n    apply IHceval2.\n    reflexivity.\n  Qed.\n\nTheorem while_true : forall b c,\n  bequiv b <{true}> ->\n  cequiv\n    <{ while b do c end }>\n    <{ while true do skip end }>.\nProof.\n  intros b c H st st'.\n  split;\n  intros H2.\n  - (* true -> nonterm *)\n    apply (while_true_nonterm b c st st') in H.\n    apply H in H2.\n    destruct H2. (* H2: False *)\n  - (* nonterm -> true *)\n    destruct b;\n    remember <{while true do skip end}> as cw eqn: H2eqcw.\n    induction H2;\n    inversion H2eqcw;\n    subst;\n    clear H2eqcw.\n    +\n      unfold beval in H0.\n      discriminate H0.\n    +\n      clear H.\n      clear H0.\n      assert (H3: st' =[ while true do c end ]=> st'').\n      { apply IHceval2. reflexivity. }\n      assert (H4: st =[ while true do c end ]=> st').\n      Admitted. (* TODO *)\n\nLemma refl_aequiv : forall (a : aexp),\n  aequiv a a.\nProof.\n  intros a st.\n  reflexivity.\n  Qed.\n\nLemma sym_aequiv : forall (a1 a2 : aexp),\n  aequiv a1 a2 -> aequiv a2 a1.\nProof.\n  intros a1 a2 H st.\n  symmetry.\n  apply H.\n  Qed.\n\nLemma trans_aequiv : forall (a1 a2 a3 : aexp),\n  aequiv a1 a2 -> aequiv a2 a3 -> aequiv a1 a3.\nProof.\n  unfold aequiv.\n  intros a1 a2 a3 H12 H23 st.\n  rewrite (H12 st).\n  rewrite (H23 st).\n  reflexivity.\n  Qed.\n\nLemma refl_bequiv : forall (b : bexp),\n  bequiv b b.\nProof.\n  intros b st.\n  reflexivity.\n  Qed.\n\nLemma sym_bequiv : forall (b1 b2 : bexp),\n  bequiv b1 b2 -> bequiv b2 b1.\nProof.\n  intros b1 b2 H st.\n  symmetry.\n  apply H.\n  Qed.\n\nLemma trans_bequiv : forall (b1 b2 b3 : bexp),\n  bequiv b1 b2 -> bequiv b2 b3 -> bequiv b1 b3.\nProof.\n  intros b1 b2 b3 H12 H23 st.\n  rewrite (H12 st).\n  rewrite (H23 st).\n  reflexivity.\n  Qed.\n\nLemma refl_cequiv : forall (c : com),\n  cequiv c c.\nProof.\n  intros c st st'.\n  reflexivity.\n  Qed.\n\nLemma sym_cequiv : forall (c1 c2 : com),\n  cequiv c1 c2 -> cequiv c2 c1.\nProof.\n  unfold cequiv.\n  intros c1 c2 H st st'.\n  rewrite H.\n  reflexivity.\n  Qed.\n\nLemma trans_cequiv : forall (c1 c2 c3 : com),\n  cequiv c1 c2 -> cequiv c2 c3 -> cequiv c1 c3.\nProof.\n  unfold cequiv.\n  intros c1 c2 c3 H12 H23 st st'.\n  rewrite H12.\n  apply H23.\n  Qed.\n\nTheorem CAsgn_congruence : forall x a a',\n  aequiv a a' ->\n  cequiv <{x := a}> <{x := a'}>.\nProof.\n  intros x a a' H st st'.\n  split;\n  intros H2;\n  inversion H2;\n  subst;\n  apply E_Asgn;\n  rewrite H;\n  reflexivity.\n  Qed.\n\nTheorem CSeq_congruence : forall c1 c1' c2 c2',\n  cequiv c1 c1' -> cequiv c2 c2' -> cequiv <{ c1;c2 }> <{ c1';c2' }>.\nProof.\n  intros c1 c1' c2 c2' H1 H2 st st'.\n  split;\n  intros H3;\n  inversion H3;\n  subst.\n  - (* c1 -> c1' *)\n    assert (H5: st =[ c1' ]=> st'0).\n      { apply H1. apply H4. }\n    assert (H6: st'0 =[ c2' ]=> st').\n      { apply H2. apply H7. }\n    apply (E_Seq c1' c2' st st'0 st' H5 H6).\n  - (* c1' -> c1 *)\n    assert (H5: st =[ c1 ]=> st'0).\n      { apply H1. apply H4. }\n    assert (H6: st'0 =[ c2 ]=> st').\n      { apply H2. apply H7. }\n    apply (E_Seq c1 c2 st st'0 st' H5 H6).\n  Qed.\n\nTheorem CIf_congruence : forall b b' c1 c1' c2 c2',\n  bequiv b b' -> cequiv c1 c1' -> cequiv c2 c2' ->\n  cequiv <{ if b then c1 else c2 end }>\n         <{ if b' then c1' else c2' end }>.\nProof.\n  intros b b' c1 c1' c2 c2' H1 H2 H3 st st'.\n  split;\n  intros H4;\n  inversion H4;\n  subst.\n  - (* b -> b', b = true *)\n    assert (H5: beval st b' = true).\n    { rewrite <- H8. rewrite H1. reflexivity. }\n    assert (H6: st =[ c1' ]=> st').\n    { apply H2. apply H9. }\n    apply (E_IfTrue st st' b' c1' c2' H5 H6).\n  - (* b -> b', b = false *)\n    assert (H5: beval st b' = false).\n    { rewrite <- H8. rewrite H1. reflexivity. }\n    assert (H6: st =[ c2' ]=> st').\n    { apply H3. apply H9. }\n    apply (E_IfFalse st st' b' c1' c2' H5 H6).\n  - (* b' -> b, b' = true *)\n    assert (H5: beval st b = true).\n    { rewrite <- H8. rewrite H1. reflexivity. }\n    assert (H6: st =[ c1 ]=> st').\n    { apply H2. apply H9. }\n    apply (E_IfTrue st st' b c1 c2 H5 H6).\n  - (* b' -> b, b' = false *)\n    assert (H5: beval st b = false).\n    { rewrite <- H8. rewrite H1. reflexivity. }\n    assert (H6: st =[ c2 ]=> st').\n    { apply H3. apply H9. }\n    apply (E_IfFalse st st' b c1 c2 H5 H6).\n  Qed.\n\nTheorem CWhile_congruence : forall b b' c c',\n  bequiv b b' -> cequiv c c' ->\n  cequiv <{ while b do c end }> <{ while b' do c' end }>.\nProof.\n  assert (A: forall (b b' : bexp) (c c' : com) (st st' : state),\n             bequiv b b' -> cequiv c c' ->\n             st =[ while b do c end ]=> st' ->\n             st =[ while b' do c' end ]=> st').\n  { \n    unfold bequiv, cequiv.\n    intros b b' c c' st st' Hbe Hc1e Hce.\n    remember <{ while b do c end }> as cwhile eqn:Heqcwhile.\n    induction Hce;\n    inversion Heqcwhile;\n    subst.\n    + (* E_WhileFalse *)\n      apply E_WhileFalse.\n      rewrite <- Hbe.\n      apply H.\n    + (* E_WhileTrue *)\n      apply E_WhileTrue with (st' := st').\n      * (* show loop runs *)\n        rewrite <- Hbe.\n        apply H.\n      * (* body execution *)\n        apply (Hc1e st st').\n        apply Hce1.\n      * (* subsequent loop execution *)\n        apply IHHce2.\n        reflexivity.\n  }\n  intros.\n  split.\n  - (* b -> b' *)\n    apply A;\n    assumption.\n  - (* b' -> b *)\n    apply A;\n    try apply sym_bequiv;\n    try apply sym_cequiv;\n    assumption.\n  Qed.\n\nDefinition atrans_sound (atrans : aexp -> aexp) : Prop :=\n  forall (a : aexp),\n    aequiv a (atrans a).\n\nDefinition btrans_sound (btrans : bexp -> bexp) : Prop :=\n  forall (b : bexp),\n    bequiv b (btrans b).\n\nDefinition ctrans_sound (ctrans : com -> com) : Prop :=\n  forall (c : com),\n    cequiv c (ctrans c).", "Definition Assertion := state -> Prop.\n\nDefinition assert_implies (P Q : Assertion) : Prop :=\n  forall st, P st -> Q st.\n\nDeclare Scope hoare_spec_scope.\nNotation \"P ->> Q\" := (assert_implies P Q)\n                      (at level 80) : hoare_spec_scope.\nOpen Scope hoare_spec_scope.\n\nNotation \"P <<->> Q\" :=\n  (P ->> Q /\\ Q ->> P) (at level 80) : hoare_spec_scope.\n\nDefinition Aexp : Type := state -> nat.\n\nDefinition assert_of_Prop (P : Prop) : Assertion := fun _ => P.\nDefinition Aexp_of_nat (n : nat) : Aexp := fun _ => n.\nDefinition Aexp_of_aexp (a : aexp) : Aexp := fun st => aeval st a.\n\nCoercion assert_of_Prop : Sortclass >-> Assertion.\nCoercion Aexp_of_nat : nat >-> Aexp.\nCoercion Aexp_of_aexp : aexp >-> Aexp.\n\nAdd Printing Coercion Aexp_of_nat Aexp_of_aexp assert_of_Prop.\n\nArguments assert_of_Prop /.\nArguments Aexp_of_nat /.\nArguments Aexp_of_aexp /.\n\nAdd Printing Coercion Aexp_of_nat Aexp_of_aexp assert_of_Prop.\n\nDeclare Scope assertion_scope.\nBind Scope assertion_scope with Assertion.\nBind Scope assertion_scope with Aexp.\nDelimit Scope assertion_scope with assertion.\n\nNotation assert P := (P%assertion : Assertion).\nNotation mkAexp a := (a%assertion : Aexp).\nNotation \"~ P\" := (fun st => ~ assert P st) : assertion_scope.\nNotation \"P /\\ Q\" := (fun st => assert P st /\\ assert Q st) : assertion_scope.\nNotation \"P \\/ Q\" := (fun st => assert P st \\/ assert Q st) : assertion_scope.\nNotation \"P -> Q\" := (fun st => assert P st -> assert Q st) : assertion_scope.\nNotation \"P <-> Q\" := (fun st => assert P st <-> assert Q st) : assertion_scope.\nNotation \"a = b\" := (fun st => mkAexp a st = mkAexp b st) : assertion_scope.\nNotation \"a <> b\" := (fun st => mkAexp a st <> mkAexp b st) : assertion_scope.\nNotation \"a <= b\" := (fun st => mkAexp a st <= mkAexp b st) : assertion_scope.\nNotation \"a < b\" := (fun st => mkAexp a st < mkAexp b st) : assertion_scope.\nNotation \"a >= b\" := (fun st => mkAexp a st >= mkAexp b st) : assertion_scope.\nNotation \"a > b\" := (fun st => mkAexp a st > mkAexp b st) : assertion_scope.\nNotation \"a + b\" := (fun st => mkAexp a st + mkAexp b st) : assertion_scope.\nNotation \"a - b\" := (fun st => mkAexp a st - mkAexp b st) : assertion_scope.\nNotation \"a * b\" := (fun st => mkAexp a st * mkAexp b st) : assertion_scope.\n\nDefinition ap {X} (f : nat -> X) (x : Aexp) :=\n  fun st => f (x st).\nDefinition ap2 {X} (f : nat -> nat -> X) (x : Aexp) (y : Aexp) (st : state) :=\n  f (x st) (y st).\n\nDefinition hoare_triple\n           (P : Assertion) (c : com) (Q : Assertion) : Prop :=\n  forall st st',\n     st =[ c ]=> st' ->\n     P st ->\n     Q st'.\n\nNotation \"{{ P }} c {{ Q }}\" :=\n  (hoare_triple P c Q) (at level 90, c custom com at level 99)\n  : hoare_spec_scope.\n\nDefinition assn_sub X a (P:Assertion) : Assertion :=\n  fun (st : state) =>\n    P (X !-> aeval st a ; st).\n\nNotation \"P [ X |-> a ]\" := (assn_sub X a P)\n  (at level 10, X at next level, a custom com).\n\nTheorem hoare_skip : forall P,\n     {{P}} skip {{P}}.\nProof.\n  intros P st st' H HP.\n  inversion H;\n  subst.\n  assumption.\n  Qed.\n\nTheorem hoare_seq : forall P Q R c1 c2,\n     {{Q}} c2 {{R}} ->\n     {{P}} c1 {{Q}} ->\n     {{P}} c1; c2 {{R}}.\nProof.\n  unfold hoare_triple.\n  intros P Q R c1 c2 H1 H2 st st' H12 Pre.\n  inversion H12;\n  subst.\n  eauto.\n  Qed.\n\nTheorem hoare_asgn: forall Q X a,\n  {{Q [X |-> a]}} X := a {{Q}}.\nProof.\n  unfold hoare_triple.\n  intros Q X a st st' HE HQ.\n  inversion HE.\n  subst.\n  unfold assn_sub in HQ.\n  assumption.\n  Qed.\n\nTheorem hoare_consequence_pre : forall (P P' Q : Assertion) c,\n  {{P'}} c {{Q}} ->\n  P ->> P' ->\n  {{P}} c {{Q}}.\nProof.\n  intros p p' q c H0 H1 st st' H2 H3.\n  apply H0 with st. (* H0: {p'} c {q} *)\n  - (* st =[ c ]=> st' *)\n    apply H2. (* H2: st =[ c ]=> st' *)\n  - (* p' st *)\n    apply H1. (* H1: p ->> p' *)\n    apply H3. (* H3: p st *)\n  Qed.\n\nTheorem hoare_consequence_post : forall (P Q Q' : Assertion) c,\n  {{P}} c {{Q'}} ->\n  Q' ->> Q ->\n  {{P}} c {{Q}}.\nProof.\n  intros p q q' c H0 H1 st st' H2 H3.\n  apply H1. (* H1: q' ->> q *)\n  apply H0 with st. (* H0: {p} c {q'} *)\n  - (* st =[ c ]=> st' *)\n    apply H2. (* H2: st =[ c ]=> st' *)\n  - (* p st *)\n    apply H3. (* H3: p st *)\n  Qed.\n\nTheorem hoare_consequence : forall (P P' Q Q' : Assertion) c,\n  {{P'}} c {{Q'}} ->\n  P ->> P' ->\n  Q' ->> Q ->\n  {{P}} c {{Q}}.\nProof.\n  intros P P' Q Q' c Htriple Hpre Hpost.\n  apply hoare_consequence_pre with (P' := P').\n  - (* {P'} c {Q} *)\n    apply hoare_consequence_post with (Q' := Q').\n    + (* {P'} c {Q'} *)\n      assumption.\n    + (* Q' ->> Q *)\n      assumption.\n  - (* P ->> P' *)\n    assumption.\n  Qed.\n\nHint Unfold assert_implies hoare_triple assn_sub t_update : core.\nHint Unfold assert_of_Prop Aexp_of_nat Aexp_of_aexp : core.\n\nDefinition bassn b : Assertion :=\n  fun st => (beval st b = true).\n\nCoercion bassn : bexp >-> Assertion.\nArguments bassn /.\n\nLemma bexp_eval_false : forall b st,\n  beval st b = false -> ~ ((bassn b) st).\nProof.\n  congruence.\n  Qed.\n\nHint Resolve bexp_eval_false : core.\n\nTheorem hoare_if : forall P Q (b:bexp) c1 c2,\n  {{ P /\\ b }} c1 {{Q}} ->\n  {{ P /\\ ~ b}} c2 {{Q}} ->\n  {{P}} if b then c1 else c2 end {{Q}}.\nProof.\n  intros P Q b c1 c2 H1 H2 st st' H3 H4.\n  inversion H3;\n  eauto.\n  Qed.\n\nFrom Coq Require Import Arith.PeanoNat. Import Nat.\n\nLtac assn_auto :=\n  unfold assert_implies, assn_sub, t_update, bassn;\n  intros st;\n  simpl in *;\n  try rewrite -> eqb_eq in *;\n  try rewrite -> leb_le in *;\n  auto;\n  try lia.\n\nTheorem hoare_while : forall P (b:bexp) c,\n  {{P /\\ b}} c {{P}} ->\n  {{P}} while b do c end {{P /\\ ~ b}}.\nProof.\n  intros P b c H_hoare st st' H_while H_P.\n  remember <{ while b do c end }> as while_.\n  induction H_while;\n  try (inversion Heqwhile_);\n  subst;\n  eauto.\n  Qed.\n\nFrom Coq Require Import Bool.Bool.\nFrom Coq Require Import Arith.Arith.\nFrom Coq Require Import Arith.EqNat.\n\nLtac verify_assn :=\n  repeat split;\n  simpl;\n  unfold assert_implies;\n  unfold ap in *; unfold ap2 in *;\n  unfold bassn in *; unfold beval in *; unfold aeval in *;\n  unfold assn_sub; intros;\n  repeat (simpl in *;\n          rewrite t_update_eq ||\n          (try rewrite t_update_neq;\n          [ | (intro X; inversion X; fail)]));\n  simpl in *;\n  repeat match goal with [H : _ /\\ _ |- _] =>\n                         destruct H end;\n  repeat rewrite not_true_iff_false in *;\n  repeat rewrite not_false_iff_true in *;\n  repeat rewrite negb_true_iff in *;\n  repeat rewrite negb_false_iff in *;\n  repeat rewrite eqb_eq in *;\n  repeat rewrite eqb_neq in *;\n  repeat rewrite leb_iff in *;\n  repeat rewrite leb_iff_conv in *;\n  try subst;\n  simpl in *;\n  repeat\n    match goal with\n      [st : state |- _] =>\n        match goal with\n        | [H : st _ = _ |- _] =>\n            rewrite -> H in *; clear H\n        | [H : _ = st _ |- _] =>\n            rewrite <- H in *; clear H\n        end\n    end;\n  try eauto;\n  try lia.", "Fixpoint filter {X : Type} (test : X -> bool) (l : list X) : list X :=\n  match l with\n  | nil => nil\n  | h :: t => if test h\n    then h :: (filter test t)\n    else filter test t\n  end.\n\nFixpoint map {X Y : Type} (f : X -> Y) (l : list X) : list Y :=\n  match l with\n  | [] => []\n  | h :: t => (f h) :: (map f t)\n  end.\n\nFixpoint fold {X Y: Type} (f : X -> Y -> Y) (l : list X) (b : Y) : Y :=\n  match l with\n  | [] => b\n  | h :: t => f h (fold f t b)\n  end.", "Inductive prod (X Y : Type) : Type :=\n| pair (x : X) (y : Y).\n\nArguments pair {X} {Y}.\nNotation \"( x , y )\" := (pair x y).\nNotation \"X * Y\" := (prod X Y) : type_scope.\n\nDefinition fst {X Y : Type} (p : X * Y) : X :=\n  match p with\n  | (x, y) => x\n  end.\nDefinition snd {X Y : Type} (p : X * Y) : Y :=\n  match p with\n  | (x, y) => y\n  end.\n\nDefinition prod_curry {X Y Z : Type}\n  (f : X * Y -> Z) (x : X) (y : Y) : Z := f (x, y).\n\nDefinition prod_uncurry {X Y Z : Type}\n  (f : X -> Y -> Z) (x : X * Y) : Z := f (fst x) (snd x).", "Fixpoint div2 (n : nat) :=\n  match n with\n  | 0 => 0\n  | 1 => 0\n  | S (S n) => S (div2 n)\n  end.\n\nFixpoint double (n:nat) :=\n  match n with\n  | O => O\n  | S n' => S (S (double n'))\n  end.\n\nDefinition Even x := exists n : nat, x = double n.\n\nFixpoint even (n : nat) :=\n  match n with\n  | 0 => true\n  | S 0 => false\n  | S (S n) => even n\n  end.\n\nTheorem add_0_r : forall n : nat, n + 0 = n.\nProof.\n  intros n. induction n as [ | n' IHn'].\n  - (* n = 0 *)\n    reflexivity.\n  - (* n = S n' *)\n    simpl.\n    rewrite -> IHn'.\n    reflexivity.\n  Qed.\n\nTheorem add_comm : forall n m : nat,\n  n + m = m + n.\nProof.\n  induction n as [ | n'].\n  - (* n = O *)\n    intros m.\n    rewrite -> add_0_r.\n    reflexivity.\n  - (* n = S n' *)\n    intros m. simpl.\n    rewrite -> IHn'.\n    rewrite <- plus_n_Sm.\n    reflexivity.\n  Qed.\n\nFixpoint eqb (n m : nat) : bool :=\n  match n with\n  | O => match m with\n    | O => true\n    | _ => false\n    end\n  | S n' => match m with\n    | O => false\n    | S m' => eqb n' m'\n    end\n  end.\n\nFixpoint leb (m n : nat) : bool :=\n  match m with\n  | O => true\n  | S m' => match n with\n    | O => false\n    | S n' => leb m' n'\n    end\n  end.\n\nNotation \"x =? y\" := (eqb x y) (at level 70) : nat_scope.\nNotation \"x <=? y\" := (leb x y) (at level 70) : nat_scope.", "Inductive list (X : Type) : Type :=\n  | nil\n  | cons (x : X) (l : list X).\n\nArguments nil {X}.\nArguments cons {X}.\n\nNotation \"x :: l\" := (cons x l)\n                     (at level 60, right associativity).\nNotation \"[ ]\" := nil.\nNotation \"[ x ; .. ; y ]\" := (cons x .. (cons y nil) ..).\n\nFixpoint append {X : Type} (l1 l2 : list X) : list X :=\n  match l1 with\n  | nil => l2\n  | h :: t => h :: (append t l2)\n  end.\n\nNotation \"x ++ y\" := (append x y)\n                     (right associativity, at level 60)."];

function copy_code_to_clipboard(index) {
    navigator.clipboard.writeText(fenced_code_block_contents[index]);
}/*]]>*/</script>
        <a id="bottom"></a>
    </article>




    <footer class="markdown">
<p><br/></p><p><br/></p><hr/><div class="align-center"><p>2021 ~ 2023 &copy; Baehyunsol</p></div>
    </footer>


    <script src="colors.js"></script>

    
    <script src="nav.js"></script>
    
    
    
    <script src="header.js"></script>
    
</body>

</html>