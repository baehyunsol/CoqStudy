<!DOCTYPE html><html>

<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width"/>
    
    <title>Chap14-2</title>
    
    <link rel="preload" href="https://fonts.googleapis.com/css2?family=Nanum+Gothic+Coding&amp;display=swap" as="style" onload="this.onload=null;this.rel='stylesheet'"/>
    <!--<link href="https://fonts.googleapis.com/css2?family=Nanum+Gothic+Coding&amp;display=swap" rel="stylesheet"/> -->
    
    <link href="page.css" rel="stylesheet"/><link href="markdown.css" rel="stylesheet"/><link href="nav.css" rel="stylesheet"/><link href="header.css" rel="stylesheet"/>
    
</head>

<body>


    <header>
<p><div class="topmenu deactivated"><a href="index.html">Home</a> <a href="index.html#index-by-chapter">단원별 목차</a> <a href="index.html#index-by-keyword">키워드 목차</a> <a href="Appendix.html">부록</a></div><div class="mobileview"><a id="navbutton">&#9776;</a></div></p>
    </header>



    <nav>
<p><a id="settingsopenbutton">&#9728;</a><a href="#top">&#9650;</a><a href="#bottom">&#9660;</a></p><div id="settingsmenubg"><p><div id="settingsmenu"> <a id="settingsclosebutton">&#10006;</a> <a id="changethemebutton">Set Light Theme</a> <a id="growhorizontalbutton">Grow Horizontally</a> <a id="shrinkhorizontalbutton">Shrink Horizontally</a> <a id="growfontbutton">Grow Font</a> <a id="shrinkfontbutton">Shrink Font</a> </div></p></div>
    </nav>


    <article class="markdown">
        <a id="top"></a>
<table><thead id="table-collapse-toggle-0" class="collapsible collapsed" onclick="collapse_table('0')"><tr><th>목차</th></tr></thead><tbody id="collapsible-table-0" class="invisible"><tr><td><div class="toc"><ol type="1"><li><a href="#proof-rules">Proof Rules</a><ol type="1"><li><a href="#skip">Skip</a></li><li><a href="#sequencing">Sequencing</a></li><li><a href="#assignment">Assignment</a></li><li><a href="#consequences">Consequences</a></li></ol></li></ol></div></td></tr></tbody></table><h1 id="proof-rules">Proof Rules</h1><p>Hoare Logic으로 프로그램을 검증하기 위해선 간단한 정리들을 먼저 증명하고 시작해야합니다. 언제나 그랬듯이 간단한 정리들을 조합하여 복잡한 정리들을 증명하겠습니다.</p><h2 id="skip">Skip</h2><pre class="fenced-code-block line-num-width-0"><code><span class="code-fence-row"><span class="code-fence-index">1</span><span class="code-fence-code"><span class="color-gold">Theorem</span><span class="color-white"> hoare_skip </span><span class="color-white">:</span><span class="color-white"> forall </span><span class="color-gold">P</span><span class="color-white">,</span>
</span></span>
<span class="code-fence-row"><span class="code-fence-index">2</span><span class="code-fence-code"><span class="color-white">     {{</span><span class="color-gold">P</span><span class="color-white">}} skip {{</span><span class="color-gold">P</span><span class="color-white">}}</span><span class="color-white">.</span>
</span></span>
<span class="code-fence-row"><span class="code-fence-index">3</span><span class="code-fence-code"><span class="color-gold">Proof</span><span class="color-white">.</span>
</span></span>
<span class="code-fence-row"><span class="code-fence-index">4</span><span class="code-fence-code"><span class="color-white">  intros </span><span class="color-gold">P</span><span class="color-white"> st st&apos; </span><span class="color-gold">H</span> <span class="color-gold">HP</span><span class="color-white">.</span>
</span></span>
<span class="code-fence-row"><span class="code-fence-index">5</span><span class="code-fence-code"><span class="color-white">  inversion </span><span class="color-gold">H</span><span class="color-white">;
</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">6</span><span class="code-fence-code"><span class="color-white">  subst</span><span class="color-white">.</span>
</span></span>
<span class="code-fence-row"><span class="code-fence-index">7</span><span class="code-fence-code"><span class="color-white">  assumption</span><span class="color-white">.</span>
</span></span>
<span class="code-fence-row"><span class="code-fence-index">8</span><span class="code-fence-code"><span class="color-gold">Qed</span><span class="color-white">.</span></span></span>
</code><button class="copy-fenced-code" onclick="copy_code_to_clipboard(0)">Copy</button></pre><p>먼저, <code class="inline-code-span">skip</code>을 하더라도 assertion이 변하지 않는다는 것을 증명했습니다.</p><h2 id="sequencing">Sequencing</h2><pre class="fenced-code-block line-num-width-1"><code><span class="code-fence-row"><span class="code-fence-index">1</span><span class="code-fence-code"><span class="color-gold">Theorem</span><span class="color-white"> hoare_seq </span><span class="color-white">:</span><span class="color-white"> forall </span><span class="color-gold">P</span> <span class="color-gold">Q</span> <span class="color-gold">R</span><span class="color-white"> c1 c2</span><span class="color-white">,</span>
</span></span>
<span class="code-fence-row"><span class="code-fence-index">2</span><span class="code-fence-code"><span class="color-white">     {{</span><span class="color-gold">Q</span><span class="color-white">}} c2 {{</span><span class="color-gold">R</span><span class="color-white">}} </span><span class="color-white">-&gt;</span>
</span></span>
<span class="code-fence-row"><span class="code-fence-index">3</span><span class="code-fence-code"><span class="color-white">     {{</span><span class="color-gold">P</span><span class="color-white">}} c1 {{</span><span class="color-gold">Q</span><span class="color-white">}} </span><span class="color-white">-&gt;</span>
</span></span>
<span class="code-fence-row"><span class="code-fence-index">4</span><span class="code-fence-code"><span class="color-white">     {{</span><span class="color-gold">P</span><span class="color-white">}} c1; c2 {{</span><span class="color-gold">R</span><span class="color-white">}}</span><span class="color-white">.</span>
</span></span>
<span class="code-fence-row"><span class="code-fence-index">5</span><span class="code-fence-code"><span class="color-gold">Proof</span><span class="color-white">.</span>
</span></span>
<span class="code-fence-row"><span class="code-fence-index">6</span><span class="code-fence-code"><span class="color-white">  unfold hoare_triple</span><span class="color-white">.</span>
</span></span>
<span class="code-fence-row"><span class="code-fence-index">7</span><span class="code-fence-code"><span class="color-white">  intros </span><span class="color-gold">P</span> <span class="color-gold">Q</span> <span class="color-gold">R</span><span class="color-white"> c1 c2 </span><span class="color-gold">H1</span> <span class="color-gold">H2</span><span class="color-white"> st st&apos; </span><span class="color-gold">H12</span> <span class="color-gold">Pre</span><span class="color-white">.</span>
</span></span>
<span class="code-fence-row"><span class="code-fence-index">8</span><span class="code-fence-code"><span class="color-white">  inversion </span><span class="color-gold">H12</span><span class="color-white">;
</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">9</span><span class="code-fence-code"><span class="color-white">  subst</span><span class="color-white">.</span>
</span></span>
<span class="code-fence-row"><span class="code-fence-index">10</span><span class="code-fence-code"><span class="color-white">  eauto</span><span class="color-white">.</span>
</span></span>
<span class="code-fence-row"><span class="code-fence-index">11</span><span class="code-fence-code"><span class="color-gold">Qed</span><span class="color-white">.</span></span></span>
</code><button class="copy-fenced-code" onclick="copy_code_to_clipboard(1)">Copy</button></pre><p>어떤 명령어 <code class="inline-code-span">c1</code>과 <code class="inline-code-span">c2</code>에 대해서, <code class="inline-code-span">{P} c1 {Q}</code>이고 <code class="inline-code-span">{Q} c2 {R}</code>이면 <code class="inline-code-span">{P} c1;c2 {R}</code>이라는 것을 증명했습니다. 연속된 명령어는 각각의 명령어로 쪼갤 수 있다는 뜻이죠. <a href="Chap12-2.html#keywordauto">12-2 단원</a>에서 배웠던 <code class="inline-code-span">auto</code>와 비슷한 <code class="inline-code-span">eauto</code>를 사용했습니다.</p><p><code class="inline-code-span">hoare_seq</code>의 정의에 보면 <code class="inline-code-span">c2</code>가 <code class="inline-code-span">c1</code>보다 먼저 등장합니다. 윗 문단에서 한국어로 했던 정의와 순서가 반대네요. 왜 그럴까요? 보통 증명을 할 때 정보를 뒤에서부터 받기 때문입니다. 뒤에서도 더 보겠지만, 보통은 마지막 postcondition을 아는 상태에서 명령어를 반대로 받으면서 첫번째 precondition까지 거슬러 올라갑니다. 즉, <code class="inline-code-span">R</code>을 아는 상태에서 <code class="inline-code-span">c2</code>와 <code class="inline-code-span">c1</code>을 갖고 <code class="inline-code-span">P</code>를 관찰하는게 보편적입니다.</p><h2 id="assignment">Assignment</h2><p><code class="inline-code-span">{??} X := Y {X = 1}</code>라는 hoare triple을 생각해봅시다. precondition으로 들어갈 수 있는 건 뭐가 있을까요? <code class="inline-code-span">Y = 1</code>이 있겠네요. 말이 되긴 하지만 더 복잡한 상황에서도 일반화가 가능할까요? <code class="inline-code-span">{??} X := X + Y {X = 1}</code>에서는 precondition으로 뭐가 가능할까요? <code class="inline-code-span">X + Y = 1</code>이 가능하네요.</p><p>이제 일반화를 해봅시다. 방금 본 hoare triple들에서 대입의 좌변은 <code class="inline-code-span">X</code>, postcondition의 좌변도 <code class="inline-code-span">X</code>였습니다. 그때 precondition의 좌변에는 대입의 우변이 들어가고, precondition의 우변에는 postcondition의 우변이 들어갑니다. 이 규칙만 있으면 모든 대입 연산에 대해서 hoare triple을 만들 수 있습니다.</p><p>여기서 좀 더 일반화를 해봅시다. <code class="inline-code-span">{??} X := a {Q}</code>의 precondition으로 가능한 건 뭐가 있을까요? precondition에 <code class="inline-code-span">X</code>가 들어있었다면, <code class="inline-code-span">Q</code>에는 똑같은 자리에 <code class="inline-code-span">X</code> 대신 <code class="inline-code-span">a</code>가 들어있을 겁니다. 그걸 예쁘게 쓰면 <code class="inline-code-span">{Q [X |-&gt; a]} X := a {Q}</code>가 됩니다. 안 예쁜가요? <code class="inline-code-span">Q [X |-&gt; a]</code>는 <u><code class="inline-code-span">Q</code>에서 <code class="inline-code-span">X</code>를 전부 없애고 그 자리에 <code class="inline-code-span">a</code>를 대신 써라</u>라는 뜻입니다. Coq로 정의하면 아래와 같습니다.</p><pre class="fenced-code-block line-num-width-0"><code><span class="code-fence-row"><span class="code-fence-index">1</span><span class="code-fence-code"><span class="color-gold">Definition</span><span class="color-white"> assn_sub </span><span class="color-gold">X</span><span class="color-white"> a (</span><span class="color-gold">P</span><span class="color-white">:</span><span class="color-gold">Assertion</span><span class="color-white">) </span><span class="color-white">:</span> <span class="color-gold">Assertion</span> <span class="color-white">:=</span>
</span></span>
<span class="code-fence-row"><span class="code-fence-index">2</span><span class="code-fence-code"><span class="color-white">  fun (st </span><span class="color-white">:</span><span class="color-white"> state) </span><span class="color-white">=&gt;</span>
</span></span>
<span class="code-fence-row"><span class="code-fence-index">3</span><span class="code-fence-code">    <span class="color-gold">P</span><span class="color-white"> (</span><span class="color-gold">X</span> <span class="color-white">!-&gt;</span><span class="color-white"> aeval st a ; st)</span><span class="color-white">.</span>
</span></span>
<span class="code-fence-row"><span class="code-fence-index">4</span><span class="code-fence-code">
</span></span>
<span class="code-fence-row"><span class="code-fence-index">5</span><span class="code-fence-code"><span class="color-gold">Notation</span> <span class="color-white">&quot;</span><span class="color-green">P [ X |-&gt; a ]</span><span class="color-white">&quot;</span> <span class="color-white">:=</span><span class="color-white"> (assn_sub </span><span class="color-gold">X</span><span class="color-white"> a </span><span class="color-gold">P</span><span class="color-white">)
</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">6</span><span class="code-fence-code"><span class="color-white">  (at level </span><span class="color-gold">10</span><span class="color-white">,</span> <span class="color-gold">X</span><span class="color-white"> at next level</span><span class="color-white">,</span><span class="color-white"> a custom com)</span><span class="color-white">.</span></span></span>
</code><button class="copy-fenced-code" onclick="copy_code_to_clipboard(2)">Copy</button></pre><p>방금 한 얘기가 참이라는 걸 Coq으로 증명해보겠습니다. 아래를 봅시다.</p><pre class="fenced-code-block line-num-width-1"><code><span class="code-fence-row"><span class="code-fence-index">1</span><span class="code-fence-code"><span class="color-gold">Theorem</span><span class="color-white"> hoare_asgn</span><span class="color-white">:</span><span class="color-white"> forall </span><span class="color-gold">Q</span> <span class="color-gold">X</span><span class="color-white"> a</span><span class="color-white">,</span>
</span></span>
<span class="code-fence-row"><span class="code-fence-index">2</span><span class="code-fence-code"><span class="color-white">  {{</span><span class="color-gold">Q</span><span class="color-white"> [</span><span class="color-gold">X</span> <span class="color-white">|-&gt;</span><span class="color-white"> a]}} </span><span class="color-gold">X</span> <span class="color-white">:=</span><span class="color-white"> a {{</span><span class="color-gold">Q</span><span class="color-white">}}</span><span class="color-white">.</span>
</span></span>
<span class="code-fence-row"><span class="code-fence-index">3</span><span class="code-fence-code"><span class="color-gold">Proof</span><span class="color-white">.</span>
</span></span>
<span class="code-fence-row"><span class="code-fence-index">4</span><span class="code-fence-code"><span class="color-white">  unfold hoare_triple</span><span class="color-white">.</span>
</span></span>
<span class="code-fence-row"><span class="code-fence-index">5</span><span class="code-fence-code"><span class="color-white">  intros </span><span class="color-gold">Q</span> <span class="color-gold">X</span><span class="color-white"> a st st&apos; </span><span class="color-gold">HE</span> <span class="color-gold">HQ</span><span class="color-white">.</span>
</span></span>
<span class="code-fence-row"><span class="code-fence-index">6</span><span class="code-fence-code"><span class="color-white">  inversion </span><span class="color-gold">HE</span><span class="color-white">.</span>
</span></span>
<span class="code-fence-row"><span class="code-fence-index">7</span><span class="code-fence-code"><span class="color-white">  subst</span><span class="color-white">.</span>
</span></span>
<span class="code-fence-row"><span class="code-fence-index">8</span><span class="code-fence-code"><span class="color-white">  unfold assn_sub </span><span class="color-violet">in</span> <span class="color-gold">HQ</span><span class="color-white">.</span>
</span></span>
<span class="code-fence-row"><span class="code-fence-index">9</span><span class="code-fence-code"><span class="color-white">  assumption</span><span class="color-white">.</span>
</span></span>
<span class="code-fence-row"><span class="code-fence-index">10</span><span class="code-fence-code">  <span class="color-gold">Qed</span><span class="color-white">.</span>
</span></span>
<span class="code-fence-row"><span class="code-fence-index">11</span><span class="code-fence-code">
</span></span>
<span class="code-fence-row"><span class="code-fence-index">12</span><span class="code-fence-code"><span class="color-gold">Example</span><span class="color-white"> assn_sub_example</span><span class="color-white">:</span>
</span></span>
<span class="code-fence-row"><span class="code-fence-index">13</span><span class="code-fence-code"><span class="color-white">  {{(</span><span class="color-gold">X</span> <span class="color-white">&lt;</span> <span class="color-gold">5</span><span class="color-white">) [</span><span class="color-gold">X</span> <span class="color-white">|-&gt;</span> <span class="color-gold">X</span> <span class="color-white">+</span> <span class="color-gold">1</span><span class="color-white">]}}
</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">14</span><span class="code-fence-code">    <span class="color-gold">X</span> <span class="color-white">:=</span> <span class="color-gold">X</span> <span class="color-white">+</span> <span class="color-gold">1</span>
</span></span>
<span class="code-fence-row"><span class="code-fence-index">15</span><span class="code-fence-code"><span class="color-white">  {{</span><span class="color-gold">X</span> <span class="color-white">&lt;</span> <span class="color-gold">5</span><span class="color-white">}}</span><span class="color-white">.</span>
</span></span>
<span class="code-fence-row"><span class="code-fence-index">16</span><span class="code-fence-code"><span class="color-gold">Proof</span><span class="color-white">.</span>
</span></span>
<span class="code-fence-row"><span class="code-fence-index">17</span><span class="code-fence-code"><span class="color-white">  apply hoare_asgn</span><span class="color-white">.</span>
</span></span>
<span class="code-fence-row"><span class="code-fence-index">18</span><span class="code-fence-code">  <span class="color-gold">Qed</span><span class="color-white">.</span></span></span>
</code><button class="copy-fenced-code" onclick="copy_code_to_clipboard(3)">Copy</button></pre><h2 id="consequences">Consequences</h2><p>Coq은 멍청합니다. <code class="inline-code-span">{(X = 3) [X |-&gt; 3]} X := 3 {X = 3}</code>가 말이 되는 건 <code class="inline-code-span">hoare_asgn</code>을 이용해서 바로 증명이 되지만 <code class="inline-code-span">{True} X := 3 {X = 3}</code>은 안됩니다. 사람이 보기엔 둘이 같은 말인데 말이죠. Coq을 위해서 몇가지 정리를 추가해줍시다.</p><p><code class="inline-code-span">{P} c {Q}</code>가 참일 때, 아래의 2가지도 참입니다.</p><ul><li>precondition이 강해지는 경우, 즉 <code class="inline-code-span">P&apos; -&gt;&gt; P</code>일 때 <code class="inline-code-span">{P&apos;} c {Q}</code></li><li>postcondition이 약해지는 경우, 즉 <code class="inline-code-span">Q -&gt;&gt; Q&apos;</code>일 때 <code class="inline-code-span">{P} c {Q&apos;}</code></li></ul><p>TODO</p><hr/><div class="align-center"><p><a href="index.html">메인으로 돌아가기</a></p></div><div class="align-left"><p>&lt;&lt; <a href="Chap14-1.html">Chapter 14-1. Hoare Logic</a></p></div><div class="align-right"><p><a href="Chap14-3.html">Chapter 14-3. ??</a> &gt;&gt;</p></div><script>/*<![CDATA[*/
const fenced_code_block_contents = ["Theorem hoare_skip : forall P,\n     {{P}} skip {{P}}.\nProof.\n  intros P st st' H HP.\n  inversion H;\n  subst.\n  assumption.\nQed.", "Theorem hoare_seq : forall P Q R c1 c2,\n     {{Q}} c2 {{R}} ->\n     {{P}} c1 {{Q}} ->\n     {{P}} c1; c2 {{R}}.\nProof.\n  unfold hoare_triple.\n  intros P Q R c1 c2 H1 H2 st st' H12 Pre.\n  inversion H12;\n  subst.\n  eauto.\nQed.", "Definition assn_sub X a (P:Assertion) : Assertion :=\n  fun (st : state) =>\n    P (X !-> aeval st a ; st).\n\nNotation \"P [ X |-> a ]\" := (assn_sub X a P)\n  (at level 10, X at next level, a custom com).", "Theorem hoare_asgn: forall Q X a,\n  {{Q [X |-> a]}} X := a {{Q}}.\nProof.\n  unfold hoare_triple.\n  intros Q X a st st' HE HQ.\n  inversion HE.\n  subst.\n  unfold assn_sub in HQ.\n  assumption.\n  Qed.\n\nExample assn_sub_example:\n  {{(X < 5) [X |-> X + 1]}}\n    X := X + 1\n  {{X < 5}}.\nProof.\n  apply hoare_asgn.\n  Qed."];

function copy_code_to_clipboard(index) {
    navigator.clipboard.writeText(fenced_code_block_contents[index]);
}/*]]>*/</script>
        <a id="bottom"></a>
    </article>




    <footer class="markdown">
<p><br/></p><p><br/></p><hr/><div class="align-center"><p>2021 ~ 2023 &copy; Baehyunsol</p></div>
    </footer>


    <script src="colors.js"></script>

    
    <script src="nav.js"></script>
    
    
    
    <script src="header.js"></script>
    
<script src="collapsible_tables.js"></script></body>

</html>