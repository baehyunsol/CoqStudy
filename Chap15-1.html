<!DOCTYPE html><html>

<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width"/>
    
    <title>Chap15-1</title>
    
    <link rel="preload" href="https://fonts.googleapis.com/css2?family=Nanum+Gothic+Coding&amp;display=swap" as="style" onload="this.onload=null;this.rel='stylesheet'"/>
    <!--<link href="https://fonts.googleapis.com/css2?family=Nanum+Gothic+Coding&amp;display=swap" rel="stylesheet"/> -->
    
    <link href="page.css" rel="stylesheet"/><link href="markdown.css" rel="stylesheet"/><link href="nav.css" rel="stylesheet"/><link href="header.css" rel="stylesheet"/>
    
</head>

<body>


    <header>
<p><div class="topmenu deactivated"><a href="index.html">Home</a> <a href="index.html#index-by-chapter">단원별 목차</a> <a href="index.html#index-by-keyword">키워드 목차</a> <a href="Appendix.html">부록</a></div><div class="mobileview"><a id="navbutton">&#9776;</a></div></p>
    </header>



    <nav>
<p><a id="settingsopenbutton">&#9728;</a><a href="#top">&#9650;</a><a href="#bottom">&#9660;</a></p><div id="settingsmenubg"><div id="settingsmenu"><table><thead><tr><th colspan="2"><div class="align-right"> <span class="size-giant"><a id="settingsclosebutton">&#10006;</a></span></div></th></tr></thead><tbody><tr><td><div class="align-right">Theme:</div></td><td><div class="align-left"><a id="changethemebutton">Set Light Theme</a></div></td></tr><tr><td><div class="align-right">Horizontal Padding:</div></td><td><div class="align-left"><a id="growhorizontalbutton">Grow</a> <a id="shrinkhorizontalbutton">Shrink</a></div></td></tr><tr><td><div class="align-right">Font Size:</div></td><td><div class="align-left"><a id="growfontbutton">Grow</a> <a id="shrinkfontbutton">Shrink</a></div></td></tr><tr><td><div class="align-right">Settings:</div></td><td><div class="align-left"><a id="savesettingsbutton">Save All</a> <a id="discardsettingsbutton">Discard All</a></div></td></tr></tbody></table></div></div>
    </nav>


    <article class="markdown">
        <a id="top"></a>
<table><thead onclick="collapse_table('0')" id="table-collapse-toggle-0" class="collapsible collapsed"><tr><th>목차</th></tr></thead><tbody id="collapsible-table-0" class="invisible"><tr><td><div class="toc"><ol type="1"><li><a href="#basics">Basics</a><ol type="1"><li><a href="#tm">tm</a><ol type="1"><li><a href="#operational-semantics">Operational Semantics</a></li></ol></li><li><a href="#types">Types</a></li><li><a href="#type-soundness">Type Soundness</a></li></ol></li></ol></div></td></tr></tbody></table><h1 id="basics">Basics</h1><p>이번 단원에서는 프로그래밍 언어의 아주 큰 주제 중 하나인 type system에 대해서 공부하겠습니다. 언제나 그랬듯이 간단한 언어를 하나 정의하고 그 언어를 통해서 개념을 공부하겠습니다.</p><p>이번 단원을 공부하기 전에 <a href="lectures.html">부록</a>에 있는 허충길 교수님의 강의 내용을 읽고 오는 것이 도움이 됩니다.</p><h2 id="tm">tm</h2><p>이번에 정의할 언어는 14단원 <a href="14-6.html#tm">끝자락</a>에서 정의한 tm과 비슷하게 생겼습니다. 다만 tm은 너무 단순해서 타입을 정의할 수가 없으니 bool과 자연수 타입을 가지는 좀 더 복잡한 언어를 정의해봅시다.</p><pre class="fenced-code-block line-num-width-0"><code><span class="code-fence-row"><span class="code-fence-index">1</span><span class="code-fence-code">t ::= true</span></span>
<span class="code-fence-row"><span class="code-fence-index">2</span><span class="code-fence-code">    | false</span></span>
<span class="code-fence-row"><span class="code-fence-index">3</span><span class="code-fence-code">    | if t then t else t</span></span>
<span class="code-fence-row"><span class="code-fence-index">4</span><span class="code-fence-code">    | 0</span></span>
<span class="code-fence-row"><span class="code-fence-index">5</span><span class="code-fence-code">    | succ t</span></span>
<span class="code-fence-row"><span class="code-fence-index">6</span><span class="code-fence-code">    | pred t</span></span>
<span class="code-fence-row"><span class="code-fence-index">7</span><span class="code-fence-code">    | iszero t</span></span>
</code><button onclick="copy_code_to_clipboard(0)" class="copy-fenced-code">Copy</button></pre><p>Coq으로 한 정의는 너무 길어서 간략한 정의만 실었습니다. 위의 표기들이 tm이 가질 수 있는 모든 표기입니다. 14단원에서도 <code class="inline-code-span">value</code>를 정의했죠? 더 이상 계산이 불가능한 상수 상태를 <code class="inline-code-span">value</code>로 정의했습니다. 이번에도 똑같이 정의해보겠습니다.</p><pre class="fenced-code-block line-num-width-1"><code><span class="code-fence-row"><span class="code-fence-index">1</span><span class="code-fence-code"><span class="color-violet">Inductive</span> <span class="color-aqua">bvalue</span> <span class="color-white">:</span> <span class="color-violet">tm</span> <span class="color-white">-</span><span class="color-white">&gt;</span> <span class="color-white">Prop</span> <span class="color-white">:=</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">2</span><span class="code-fence-code">  <span class="color-white">|</span> <span class="color-aqua">bv_True</span> <span class="color-white">:</span> <span class="color-violet">bvalue</span> <span class="color-white">&lt;</span><span class="color-white">{</span> <span class="color-red">true</span> <span class="color-white">}</span><span class="color-white">&gt;</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">3</span><span class="code-fence-code">  <span class="color-white">|</span> <span class="color-aqua">bv_false</span> <span class="color-white">:</span> <span class="color-violet">bvalue</span> <span class="color-white">&lt;</span><span class="color-white">{</span> <span class="color-red">false</span> <span class="color-white">}</span><span class="color-white">&gt;</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">4</span><span class="code-fence-code"></span></span>
<span class="code-fence-row"><span class="code-fence-index">5</span><span class="code-fence-code"><span class="color-violet">Inductive</span> <span class="color-aqua">nvalue</span> <span class="color-white">:</span> <span class="color-violet">tm</span> <span class="color-white">-</span><span class="color-white">&gt;</span> <span class="color-white">Prop</span> <span class="color-white">:=</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">6</span><span class="code-fence-code">  <span class="color-white">|</span> <span class="color-aqua">nv_0</span> <span class="color-white">:</span> <span class="color-violet">nvalue</span> <span class="color-white">&lt;</span><span class="color-white">{</span><span class="color-white"> 0 </span><span class="color-white">}</span><span class="color-white">&gt;</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">7</span><span class="code-fence-code">  <span class="color-white">|</span> <span class="color-aqua">nv_succ</span> <span class="color-white">:</span> <span class="color-violet">forall</span> <span class="color-red">t</span><span class="color-white">,</span> <span class="color-violet">nvalue</span> <span class="color-violet">t</span> <span class="color-white">-</span><span class="color-white">&gt;</span> <span class="color-violet">nvalue</span> <span class="color-white">&lt;</span><span class="color-white">{</span> <span class="color-red">succ</span> <span class="color-red">t</span> <span class="color-white">}</span><span class="color-white">&gt;</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">8</span><span class="code-fence-code"></span></span>
<span class="code-fence-row"><span class="code-fence-index">9</span><span class="code-fence-code"><span class="color-violet">Definition</span> <span class="color-aqua">value</span> <span class="color-white">(</span><span class="color-red">t</span> <span class="color-white">:</span> <span class="color-violet">tm</span><span class="color-white">)</span> <span class="color-white">:=</span> <span class="color-red">bvalue</span> <span class="color-red">t</span> <span class="color-white">\/</span> <span class="color-red">nvalue</span> <span class="color-white">t</span><span class="color-white">.</span></span></span>
</code><button onclick="copy_code_to_clipboard(1)" class="copy-fenced-code">Copy</button></pre><p>이번에는 tm이 가질 수 있는 값의 종류가 2 종류라서 <code class="inline-code-span">bvalue</code>와 <code class="inline-code-span">nvalue</code>를 따로 정의하고 둘을 합쳐서 <code class="inline-code-span">value</code>라고 정의했습니다.</p><h3 id="operational-semantics">Operational Semantics</h3><p>새로 만든 tm의 single-step relation을 정의해보겠습니다. 이번에도 Coq 정의는 생략하고 글로만 적겠습니다.</p><pre class="fenced-code-block line-num-width-1"><code><span class="code-fence-row"><span class="code-fence-index">1</span><span class="code-fence-code"></span></span>
<span class="code-fence-row"><span class="code-fence-index">2</span><span class="code-fence-code">           -------------------------------                   (ST_IfTrue)</span></span>
<span class="code-fence-row"><span class="code-fence-index">3</span><span class="code-fence-code">           if true then t1 else t2 --&gt; t1</span></span>
<span class="code-fence-row"><span class="code-fence-index">4</span><span class="code-fence-code"></span></span>
<span class="code-fence-row"><span class="code-fence-index">5</span><span class="code-fence-code">           -------------------------------                  (ST_IfFalse)</span></span>
<span class="code-fence-row"><span class="code-fence-index">6</span><span class="code-fence-code">           if false then t1 else t2 --&gt; t2</span></span>
<span class="code-fence-row"><span class="code-fence-index">7</span><span class="code-fence-code"></span></span>
<span class="code-fence-row"><span class="code-fence-index">8</span><span class="code-fence-code">                       t1 --&gt; t1&apos;</span></span>
<span class="code-fence-row"><span class="code-fence-index">9</span><span class="code-fence-code">    ------------------------------------------------             (ST_If)</span></span>
<span class="code-fence-row"><span class="code-fence-index">10</span><span class="code-fence-code">    if t1 then t2 else t3 --&gt; if t1&apos; then t2 else t3</span></span>
<span class="code-fence-row"><span class="code-fence-index">11</span><span class="code-fence-code"></span></span>
<span class="code-fence-row"><span class="code-fence-index">12</span><span class="code-fence-code">                     t1 --&gt; t1&apos;</span></span>
<span class="code-fence-row"><span class="code-fence-index">13</span><span class="code-fence-code">                 --------------------                          (ST_Succ)</span></span>
<span class="code-fence-row"><span class="code-fence-index">14</span><span class="code-fence-code">                 succ t1 --&gt; succ t1&apos;</span></span>
<span class="code-fence-row"><span class="code-fence-index">15</span><span class="code-fence-code"></span></span>
<span class="code-fence-row"><span class="code-fence-index">16</span><span class="code-fence-code">                   ------------                               (ST_Pred0)</span></span>
<span class="code-fence-row"><span class="code-fence-index">17</span><span class="code-fence-code">                   pred 0 --&gt; 0</span></span>
<span class="code-fence-row"><span class="code-fence-index">18</span><span class="code-fence-code"></span></span>
<span class="code-fence-row"><span class="code-fence-index">19</span><span class="code-fence-code">                 numeric value v</span></span>
<span class="code-fence-row"><span class="code-fence-index">20</span><span class="code-fence-code">                -------------------                        (ST_PredSucc)</span></span>
<span class="code-fence-row"><span class="code-fence-index">21</span><span class="code-fence-code">                pred (succ v) --&gt; v</span></span>
<span class="code-fence-row"><span class="code-fence-index">22</span><span class="code-fence-code"></span></span>
<span class="code-fence-row"><span class="code-fence-index">23</span><span class="code-fence-code">                      t1 --&gt; t1&apos;</span></span>
<span class="code-fence-row"><span class="code-fence-index">24</span><span class="code-fence-code">                 --------------------                          (ST_Pred)</span></span>
<span class="code-fence-row"><span class="code-fence-index">25</span><span class="code-fence-code">                 pred t1 --&gt; pred t1&apos;</span></span>
<span class="code-fence-row"><span class="code-fence-index">26</span><span class="code-fence-code"></span></span>
<span class="code-fence-row"><span class="code-fence-index">27</span><span class="code-fence-code">                  -----------------                         (ST_IsZero0)</span></span>
<span class="code-fence-row"><span class="code-fence-index">28</span><span class="code-fence-code">                  iszero 0 --&gt; true</span></span>
<span class="code-fence-row"><span class="code-fence-index">29</span><span class="code-fence-code"></span></span>
<span class="code-fence-row"><span class="code-fence-index">30</span><span class="code-fence-code">                 numeric value v</span></span>
<span class="code-fence-row"><span class="code-fence-index">31</span><span class="code-fence-code">              -------------------------                  (ST_IszeroSucc)</span></span>
<span class="code-fence-row"><span class="code-fence-index">32</span><span class="code-fence-code">              iszero (succ v) --&gt; false</span></span>
<span class="code-fence-row"><span class="code-fence-index">33</span><span class="code-fence-code"></span></span>
<span class="code-fence-row"><span class="code-fence-index">34</span><span class="code-fence-code">                    t1 --&gt; t1&apos;</span></span>
<span class="code-fence-row"><span class="code-fence-index">35</span><span class="code-fence-code">               ------------------------                      (ST_Iszero)</span></span>
<span class="code-fence-row"><span class="code-fence-index">36</span><span class="code-fence-code">               iszero t1 --&gt; iszero t1&apos;</span></span>
</code><button onclick="copy_code_to_clipboard(2)" class="copy-fenced-code">Copy</button></pre><p>각 상황마다 다음 단계로 넘어가는 step을 정의했습니다. 타입이 맞지 않은 식을 넣으면 (예: <code class="inline-code-span">succ if true then true else false</code>), 할 수 있는한 최대한 step을 많이 밟은 후, 상수가 되지 못하고 멈추게(stuck) 됩니다. (예: <code class="inline-code-span">succ true</code>)</p><p>이번 tm은 14장의 tm과 다르게 멈추는 경우가 있으므로 normal form과 관련된 정의도 다시 해줘야합니다.</p><pre class="fenced-code-block line-num-width-0"><code><span class="code-fence-row"><span class="code-fence-index">1</span><span class="code-fence-code"><span class="color-dark">Notation</span><span class="color-white"> step_normal_form := (normal_form step)</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">2</span><span class="code-fence-code"></span></span>
<span class="code-fence-row"><span class="code-fence-index">3</span><span class="code-fence-code"><span class="color-violet">Definition</span> <span class="color-aqua">stuck</span> <span class="color-white">(</span><span class="color-red">t</span> <span class="color-white">:</span> <span class="color-violet">tm</span><span class="color-white">)</span> <span class="color-white">:</span> <span class="color-white">Prop</span> <span class="color-white">:=</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">4</span><span class="code-fence-code">  <span class="color-red">step_normal_form</span> <span class="color-red">t</span> <span class="color-white">/\</span> <span class="color-white">~</span> <span class="color-red">value</span> <span class="color-white">t</span><span class="color-white">.</span></span></span>
</code><button onclick="copy_code_to_clipboard(3)" class="copy-fenced-code">Copy</button></pre><p>이제는 <code class="inline-code-span">value</code>가 아니지만 더 이상 step을 밟을 수 없는 경우가 생겼습니다. 하지만 여전히 <code class="inline-code-span">value</code>에서 step을 밟을 수 있는 경우는 존재하지 않습니다.</p><table><thead><tr><th></th><th>Value임</th><th>Value가 아님</th></tr></thead><tbody><tr><td>Step 밟을 수 있음</td><td>無</td><td>有</td></tr><tr><td>Step 밟을 수 없음</td><td>有</td><td>有</td></tr></tbody></table><h2 id="types">Types</h2><p>이제 타입과 관련된 정의들을 살펴보겠습니다. 먼저 타입을 나타내는 <code class="inline-code-span">ty</code>라는 <code class="inline-code-span">Type</code>을 추가하겠습니다.</p><pre class="fenced-code-block line-num-width-0"><code><span class="code-fence-row"><span class="code-fence-index">1</span><span class="code-fence-code"><span class="color-violet">Inductive</span> <span class="color-aqua">ty</span> <span class="color-white">:</span> <span class="color-white">Type</span> <span class="color-white">:=</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">2</span><span class="code-fence-code">  <span class="color-white">|</span> <span class="color-aqua">Bool</span> <span class="color-white">:</span> <span class="color-violet">ty</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">3</span><span class="code-fence-code">  <span class="color-white">|</span> <span class="color-aqua">Nat</span> <span class="color-white">:</span> <span class="color-violet">ty</span><span class="color-white">.</span></span></span>
</code><button onclick="copy_code_to_clipboard(4)" class="copy-fenced-code">Copy</button></pre><p>첫번째 줄에서 <code class="inline-code-span">ty</code>는 tm의 타입이고, <code class="inline-code-span">Type</code>은 Coq의 타입입니다. 또, 타입을 나타내는 기호도 하나 추가하겠습니다. <code class="inline-code-span">⊢ t ∈ T</code>라고 쓰면 <u><code class="inline-code-span">t</code> has type <code class="inline-code-span">T</code></u>라는 뜻입니다. 이 기호를 이용해서 tm의 모든 표현에 타입을 부여할 수 있습니다. 아래처럼요.</p><pre class="fenced-code-block line-num-width-1"><code><span class="code-fence-row"><span class="code-fence-index">1</span><span class="code-fence-code"></span></span>
<span class="code-fence-row"><span class="code-fence-index">2</span><span class="code-fence-code">                  --------------                      (T_True)</span></span>
<span class="code-fence-row"><span class="code-fence-index">3</span><span class="code-fence-code">                  ⊢ true ∈ Bool</span></span>
<span class="code-fence-row"><span class="code-fence-index">4</span><span class="code-fence-code"></span></span>
<span class="code-fence-row"><span class="code-fence-index">5</span><span class="code-fence-code">                 ---------------                      (T_False)</span></span>
<span class="code-fence-row"><span class="code-fence-index">6</span><span class="code-fence-code">                 ⊢ false ∈ Bool</span></span>
<span class="code-fence-row"><span class="code-fence-index">7</span><span class="code-fence-code"></span></span>
<span class="code-fence-row"><span class="code-fence-index">8</span><span class="code-fence-code">        ⊢ t1 ∈ Bool    ⊢ t2 ∈ T    ⊢ t3 ∈ T</span></span>
<span class="code-fence-row"><span class="code-fence-index">9</span><span class="code-fence-code">    --------------------------------------------      (T_If)</span></span>
<span class="code-fence-row"><span class="code-fence-index">10</span><span class="code-fence-code">           ⊢ if t1 then t2 else t3 ∈ T</span></span>
<span class="code-fence-row"><span class="code-fence-index">11</span><span class="code-fence-code"></span></span>
<span class="code-fence-row"><span class="code-fence-index">12</span><span class="code-fence-code">                    ---------                         (T_0)</span></span>
<span class="code-fence-row"><span class="code-fence-index">13</span><span class="code-fence-code">                    ⊢ 0 ∈ Nat</span></span>
<span class="code-fence-row"><span class="code-fence-index">14</span><span class="code-fence-code"></span></span>
<span class="code-fence-row"><span class="code-fence-index">15</span><span class="code-fence-code">                   ⊢ t1 ∈ Nat</span></span>
<span class="code-fence-row"><span class="code-fence-index">16</span><span class="code-fence-code">                 ---------------                      (T_Succ)</span></span>
<span class="code-fence-row"><span class="code-fence-index">17</span><span class="code-fence-code">                 ⊢ succ t1 ∈ Nat</span></span>
<span class="code-fence-row"><span class="code-fence-index">18</span><span class="code-fence-code"></span></span>
<span class="code-fence-row"><span class="code-fence-index">19</span><span class="code-fence-code">                   ⊢ t1 ∈ Nat</span></span>
<span class="code-fence-row"><span class="code-fence-index">20</span><span class="code-fence-code">                 ---------------                      (T_Pred)</span></span>
<span class="code-fence-row"><span class="code-fence-index">21</span><span class="code-fence-code">                 ⊢ pred t1 ∈ Nat</span></span>
<span class="code-fence-row"><span class="code-fence-index">22</span><span class="code-fence-code"></span></span>
<span class="code-fence-row"><span class="code-fence-index">23</span><span class="code-fence-code">                   ⊢ t1 ∈ Nat</span></span>
<span class="code-fence-row"><span class="code-fence-index">24</span><span class="code-fence-code">                 ------------------                   (T_Iszero)</span></span>
<span class="code-fence-row"><span class="code-fence-index">25</span><span class="code-fence-code">                 ⊢ iszero t1 ∈ Bool</span></span>
</code><button onclick="copy_code_to_clipboard(5)" class="copy-fenced-code">Copy</button></pre><p>정의를 자세히 살펴보면, <code class="inline-code-span">0</code>과 <code class="inline-code-span">true</code>, <code class="inline-code-span">false</code> 같은 기초적인 값들은 타입을 직접 부여했고, <code class="inline-code-span">succ</code>과 <code class="inline-code-span">pred</code>, <code class="inline-code-span">iszero</code>등의 함수는 인수와 반환값의 타입을 정의했습니다. 또한 <code class="inline-code-span">if</code>의 타입도 정의했습니다. 이 언어에서 <code class="inline-code-span">if</code>는 문(statement)이 아니고 식(expression)이거든요. Coq으로 정의하면 아래와 같습니다.</p><pre class="fenced-code-block line-num-width-1"><code><span class="code-fence-row"><span class="code-fence-index">1</span><span class="code-fence-code">Reserved Notation &quot;&apos;|-&apos; t &apos;\in&apos; T&quot; (at level 40).</span></span>
<span class="code-fence-row"><span class="code-fence-index">2</span><span class="code-fence-code"></span></span>
<span class="code-fence-row"><span class="code-fence-index">3</span><span class="code-fence-code">Inductive has_type : tm -&gt; ty -&gt; Prop :=</span></span>
<span class="code-fence-row"><span class="code-fence-index">4</span><span class="code-fence-code">  | T_True :</span></span>
<span class="code-fence-row"><span class="code-fence-index">5</span><span class="code-fence-code">       |- &lt;{ true }&gt; \in Bool</span></span>
<span class="code-fence-row"><span class="code-fence-index">6</span><span class="code-fence-code">  | T_False :</span></span>
<span class="code-fence-row"><span class="code-fence-index">7</span><span class="code-fence-code">       |- &lt;{ false }&gt; \in Bool</span></span>
<span class="code-fence-row"><span class="code-fence-index">8</span><span class="code-fence-code">  | T_If : forall t1 t2 t3 T,</span></span>
<span class="code-fence-row"><span class="code-fence-index">9</span><span class="code-fence-code">       |- t1 \in Bool -&gt;</span></span>
<span class="code-fence-row"><span class="code-fence-index">10</span><span class="code-fence-code">       |- t2 \in T -&gt;</span></span>
<span class="code-fence-row"><span class="code-fence-index">11</span><span class="code-fence-code">       |- t3 \in T -&gt;</span></span>
<span class="code-fence-row"><span class="code-fence-index">12</span><span class="code-fence-code">       |- &lt;{ if t1 then t2 else t3 }&gt; \in T</span></span>
<span class="code-fence-row"><span class="code-fence-index">13</span><span class="code-fence-code">  | T_0 :</span></span>
<span class="code-fence-row"><span class="code-fence-index">14</span><span class="code-fence-code">       |- &lt;{ 0 }&gt; \in Nat</span></span>
<span class="code-fence-row"><span class="code-fence-index">15</span><span class="code-fence-code">  | T_Succ : forall t1,</span></span>
<span class="code-fence-row"><span class="code-fence-index">16</span><span class="code-fence-code">       |- t1 \in Nat -&gt;</span></span>
<span class="code-fence-row"><span class="code-fence-index">17</span><span class="code-fence-code">       |- &lt;{ succ t1 }&gt; \in Nat</span></span>
<span class="code-fence-row"><span class="code-fence-index">18</span><span class="code-fence-code">  | T_Pred : forall t1,</span></span>
<span class="code-fence-row"><span class="code-fence-index">19</span><span class="code-fence-code">       |- t1 \in Nat -&gt;</span></span>
<span class="code-fence-row"><span class="code-fence-index">20</span><span class="code-fence-code">       |- &lt;{ pred t1 }&gt; \in Nat</span></span>
<span class="code-fence-row"><span class="code-fence-index">21</span><span class="code-fence-code">  | T_Iszero : forall t1,</span></span>
<span class="code-fence-row"><span class="code-fence-index">22</span><span class="code-fence-code">       |- t1 \in Nat -&gt;</span></span>
<span class="code-fence-row"><span class="code-fence-index">23</span><span class="code-fence-code">       |- &lt;{ iszero t1 }&gt; \in Bool</span></span>
<span class="code-fence-row"><span class="code-fence-index">24</span><span class="code-fence-code"></span></span>
<span class="code-fence-row"><span class="code-fence-index">25</span><span class="code-fence-code">where &quot;&apos;|-&apos; t &apos;\in&apos; T&quot; := (has_type t T).</span></span>
<span class="code-fence-row"><span class="code-fence-index">26</span><span class="code-fence-code"></span></span>
<span class="code-fence-row"><span class="code-fence-index">27</span><span class="code-fence-code">Hint Constructors has_type : core.</span></span>
</code><button onclick="copy_code_to_clipboard(6)" class="copy-fenced-code">Copy</button></pre><p>방금 정의한 타입은 보수적(conservative)입니다. 타입이 맞을 때는 맞다고 알려주지만 틀렸을 때는 아무런 정보도 주지 않습니다. 아래의 예시를 보겠습니다.</p><pre class="fenced-code-block line-num-width-1"><code><span class="code-fence-row"><span class="code-fence-index">1</span><span class="code-fence-code"><span class="color-violet">Example</span> <span class="color-aqua">has_type_not</span> <span class="color-white">:</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">2</span><span class="code-fence-code">  <span class="color-white">~</span> <span class="color-white">(</span> <span class="color-white">|</span><span class="color-white">-</span> <span class="color-white">&lt;</span><span class="color-white">{</span> <span class="color-violet">if</span> <span class="color-white">false</span> <span class="color-violet">then</span> <span class="color-gold">0</span> <span class="color-violet">else</span> <span class="color-white">true</span><span class="color-white">}</span><span class="color-white">&gt;</span> <span class="color-dark">\</span><span class="color-violet">in</span> <span class="color-red">Bool</span> <span class="color-white">)</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">3</span><span class="code-fence-code"><span class="color-violet">Proof</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">4</span><span class="code-fence-code">  <span class="color-emerald">intros</span> <span class="color-red">Contra</span><span class="color-white">. </span><span class="color-aqua">solve_by_inverts</span> <span class="color-gold">2</span><span class="color-white">.  </span><span class="color-violet">Qed</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">5</span><span class="code-fence-code"></span></span>
<span class="code-fence-row"><span class="code-fence-index">6</span><span class="code-fence-code"><span class="color-violet">Example</span> <span class="color-aqua">has_type_not2</span> <span class="color-white">:</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">7</span><span class="code-fence-code">  <span class="color-white">~</span> <span class="color-white">(</span> <span class="color-white">|</span><span class="color-white">-</span> <span class="color-white">&lt;</span><span class="color-white">{</span> <span class="color-violet">if</span> <span class="color-white">false</span> <span class="color-violet">then</span> <span class="color-gold">0</span> <span class="color-violet">else</span> <span class="color-white">true</span><span class="color-white">}</span><span class="color-white">&gt;</span> <span class="color-dark">\</span><span class="color-violet">in</span> <span class="color-red">Nat</span> <span class="color-white">)</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">8</span><span class="code-fence-code"><span class="color-violet">Proof</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">9</span><span class="code-fence-code">  <span class="color-emerald">intros</span> <span class="color-red">Contra</span><span class="color-white">. </span><span class="color-aqua">solve_by_inverts</span> <span class="color-gold">2</span><span class="color-white">.  </span><span class="color-violet">Qed</span><span class="color-white">.</span></span></span>
</code><button onclick="copy_code_to_clipboard(7)" class="copy-fenced-code">Copy</button></pre><p><code class="inline-code-span">if false then 0 else true</code>라는 식의 타입은 정의할 수 없습니다. 틀린 식이거든요. 하지만 Coq은 이 식의 타입을 정의할 수 없다는 건 안 알려주고 이 식이 <code class="inline-code-span">Bool</code>도 아니고 <code class="inline-code-span">Nat</code>도 아니라고만 합니다.</p><p>새로 정의한 <code class="inline-code-span">has_type</code>의 중요한 성질 몇가지를 보겠습니다.</p><pre class="fenced-code-block line-num-width-0"><code><span class="code-fence-row"><span class="code-fence-index">1</span><span class="code-fence-code"><span class="color-violet">Theorem</span> <span class="color-aqua">progress</span> <span class="color-white">:</span> <span class="color-violet">forall</span> <span class="color-red">t</span> <span class="color-red">T</span><span class="color-white">,</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">2</span><span class="code-fence-code">  <span class="color-white">|</span><span class="color-white">-</span> <span class="color-red">t</span> <span class="color-dark">\</span><span class="color-violet">in</span> <span class="color-red">T</span> <span class="color-white">-</span><span class="color-white">&gt;</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">3</span><span class="code-fence-code">  <span class="color-red">value</span> <span class="color-red">t</span> <span class="color-white">\/</span> <span class="color-violet">exists</span> <span class="color-red">t&apos;</span><span class="color-white">,</span> <span class="color-red">t</span> <span class="color-white">-</span><span class="color-white">-</span><span class="color-white">&gt;</span> <span class="color-red">t&apos;</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">4</span><span class="code-fence-code"></span></span>
<span class="code-fence-row"><span class="code-fence-index">5</span><span class="code-fence-code"><span class="color-violet">Theorem</span> <span class="color-aqua">preservation</span> <span class="color-white">:</span> <span class="color-violet">forall</span> <span class="color-red">t</span> <span class="color-red">t&apos;</span> <span class="color-red">T</span><span class="color-white">,</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">6</span><span class="code-fence-code">  <span class="color-white">|</span><span class="color-white">-</span> <span class="color-red">t</span> <span class="color-dark">\</span><span class="color-violet">in</span> <span class="color-red">T</span> <span class="color-white">-</span><span class="color-white">&gt;</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">7</span><span class="code-fence-code">  <span class="color-red">t</span> <span class="color-white">-</span><span class="color-white">-</span><span class="color-white">&gt;</span> <span class="color-red">t&apos;</span> <span class="color-white">-</span><span class="color-white">&gt;</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">8</span><span class="code-fence-code">  <span class="color-white">|</span><span class="color-white">-</span> <span class="color-red">t&apos;</span> <span class="color-dark">\</span><span class="color-violet">in</span> <span class="color-white">T</span><span class="color-white">.</span></span></span>
</code><button onclick="copy_code_to_clipboard(8)" class="copy-fenced-code">Copy</button></pre><p>먼저 <code class="inline-code-span">progress</code>는 타입이 있는 값은 stuck하지 않는다는 성질입니다. tm을 만들면서 <code class="inline-code-span">value</code>가 아니지만 더 이상 step을 못 밟는 경우들을 봤죠? 하지만 <code class="inline-code-span">value</code>가 아니면서 타입이 있는 값은 무조건 step을 밟을 수 있다는게 <code class="inline-code-span">progress</code>가 하는 말입니다.</p><p>그다음은 <code class="inline-code-span">preservation</code>이라는 성질입니다. <code class="inline-code-span">t</code>라는 값이 step을 밟아서 <code class="inline-code-span">t&apos;</code>가 될 경우, <code class="inline-code-span">t</code>와 <code class="inline-code-span">t&apos;</code>의 타입은 같다는 성질입니다.</p><h2 id="type-soundness">Type Soundness</h2><p>방금 정의한 <code class="inline-code-span">progress</code>와 <code class="inline-code-span">preservation</code>을 묶어서 생각하면, 타입이 잘 정해진 값은 step을 아무리 밟아도 stuck하지 않는다는 결론에 도달합니다. 이걸 type soundness라고 합니다.</p><hr/><div class="align-center"><p><a href="index.html">메인으로 돌아가기</a></p></div><div class="align-left"><p>&lt;&lt; <a href="Chap14-6.html">Chapter 14-6. Small-Step Operational Semantics</a></p></div><div class="align-right"><p><a href="Chap15-2.html">Chapter 15-2. Simply Typed Lambda Calculus</a> &gt;&gt;</p></div><script>/*<![CDATA[*/
const fenced_code_block_contents = ["t ::= true\n    | false\n    | if t then t else t\n    | 0\n    | succ t\n    | pred t\n    | iszero t", "Inductive bvalue : tm -> Prop :=\n  | bv_True : bvalue <{ true }>\n  | bv_false : bvalue <{ false }>.\n\nInductive nvalue : tm -> Prop :=\n  | nv_0 : nvalue <{ 0 }>\n  | nv_succ : forall t, nvalue t -> nvalue <{ succ t }>.\n\nDefinition value (t : tm) := bvalue t \\/ nvalue t.", "\n           -------------------------------                   (ST_IfTrue)\n           if true then t1 else t2 --> t1\n\n           -------------------------------                  (ST_IfFalse)\n           if false then t1 else t2 --> t2\n\n                       t1 --> t1'\n    ------------------------------------------------             (ST_If)\n    if t1 then t2 else t3 --> if t1' then t2 else t3\n\n                     t1 --> t1'\n                 --------------------                          (ST_Succ)\n                 succ t1 --> succ t1'\n\n                   ------------                               (ST_Pred0)\n                   pred 0 --> 0\n\n                 numeric value v\n                -------------------                        (ST_PredSucc)\n                pred (succ v) --> v\n\n                      t1 --> t1'\n                 --------------------                          (ST_Pred)\n                 pred t1 --> pred t1'\n\n                  -----------------                         (ST_IsZero0)\n                  iszero 0 --> true\n\n                 numeric value v\n              -------------------------                  (ST_IszeroSucc)\n              iszero (succ v) --> false\n\n                    t1 --> t1'\n               ------------------------                      (ST_Iszero)\n               iszero t1 --> iszero t1'", "Notation step_normal_form := (normal_form step).\n\nDefinition stuck (t : tm) : Prop :=\n  step_normal_form t /\\ ~ value t.", "Inductive ty : Type :=\n  | Bool : ty\n  | Nat : ty.", "\n                  --------------                      (T_True)\n                  ⊢ true ∈ Bool\n\n                 ---------------                      (T_False)\n                 ⊢ false ∈ Bool\n\n        ⊢ t1 ∈ Bool    ⊢ t2 ∈ T    ⊢ t3 ∈ T\n    --------------------------------------------      (T_If)\n           ⊢ if t1 then t2 else t3 ∈ T\n\n                    ---------                         (T_0)\n                    ⊢ 0 ∈ Nat\n\n                   ⊢ t1 ∈ Nat\n                 ---------------                      (T_Succ)\n                 ⊢ succ t1 ∈ Nat\n\n                   ⊢ t1 ∈ Nat\n                 ---------------                      (T_Pred)\n                 ⊢ pred t1 ∈ Nat\n\n                   ⊢ t1 ∈ Nat\n                 ------------------                   (T_Iszero)\n                 ⊢ iszero t1 ∈ Bool", "Reserved Notation \"'|-' t '\\in' T\" (at level 40).\n\nInductive has_type : tm -> ty -> Prop :=\n  | T_True :\n       |- <{ true }> \\in Bool\n  | T_False :\n       |- <{ false }> \\in Bool\n  | T_If : forall t1 t2 t3 T,\n       |- t1 \\in Bool ->\n       |- t2 \\in T ->\n       |- t3 \\in T ->\n       |- <{ if t1 then t2 else t3 }> \\in T\n  | T_0 :\n       |- <{ 0 }> \\in Nat\n  | T_Succ : forall t1,\n       |- t1 \\in Nat ->\n       |- <{ succ t1 }> \\in Nat\n  | T_Pred : forall t1,\n       |- t1 \\in Nat ->\n       |- <{ pred t1 }> \\in Nat\n  | T_Iszero : forall t1,\n       |- t1 \\in Nat ->\n       |- <{ iszero t1 }> \\in Bool\n\nwhere \"'|-' t '\\in' T\" := (has_type t T).\n\nHint Constructors has_type : core.", "Example has_type_not :\n  ~ ( |- <{ if false then 0 else true}> \\in Bool ).\nProof.\n  intros Contra. solve_by_inverts 2.  Qed.\n\nExample has_type_not2 :\n  ~ ( |- <{ if false then 0 else true}> \\in Nat ).\nProof.\n  intros Contra. solve_by_inverts 2.  Qed.", "Theorem progress : forall t T,\n  |- t \\in T ->\n  value t \\/ exists t', t --> t'.\n\nTheorem preservation : forall t t' T,\n  |- t \\in T ->\n  t --> t' ->\n  |- t' \\in T."];

function copy_code_to_clipboard(index) {
    navigator.clipboard.writeText(fenced_code_block_contents[index]);
}/*]]>*/</script>
        <a id="bottom"></a>
    </article>




    <footer class="markdown">
<p><br/></p><p><br/></p><hr/><div class="align-center"><p>2021 ~ 2023 &copy; Baehyunsol</p></div>
    </footer>


    <script src="colors.js"></script>

    
    <script src="nav.js"></script>
    
    
    
    <script src="header.js"></script>
    
<script src="collapsible_tables.js"></script></body>

</html>