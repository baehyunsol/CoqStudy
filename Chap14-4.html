<!DOCTYPE html><html>

<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width"/>
    
    <title>Chap14-4</title>
    
    <link rel="preload" href="https://fonts.googleapis.com/css2?family=Nanum+Gothic+Coding&amp;display=swap" as="style" onload="this.onload=null;this.rel='stylesheet'"/>
    <!--<link href="https://fonts.googleapis.com/css2?family=Nanum+Gothic+Coding&amp;display=swap" rel="stylesheet"/> -->
    
    <link href="page.css" rel="stylesheet"/><link href="markdown.css" rel="stylesheet"/><link href="nav.css" rel="stylesheet"/><link href="header.css" rel="stylesheet"/>
    
</head>

<body>


    <header>
<p><div class="topmenu deactivated"><a href="index.html">Home</a> <a href="index.html#index-by-chapter">단원별 목차</a> <a href="index.html#index-by-keyword">키워드 목차</a> <a href="Appendix.html">부록</a></div><div class="mobileview"><a id="navbutton">&#9776;</a></div></p>
    </header>



    <nav>
<p><a id="settingsopenbutton">&#9728;</a><a href="#top">&#9650;</a><a href="#bottom">&#9660;</a></p><div id="settingsmenubg"><div id="settingsmenu"><table><thead><tr><th colspan="2"><div class="align-right"> <span class="size-giant"><a id="settingsclosebutton">&#10006;</a></span></div></th></tr></thead><tbody><tr><td><div class="align-right">Theme:</div></td><td><div class="align-left"><a id="changethemebutton">Set Light Theme</a></div></td></tr><tr><td><div class="align-right">Horizontal Padding:</div></td><td><div class="align-left"><a id="growhorizontalbutton">Grow</a> <a id="shrinkhorizontalbutton">Shrink</a></div></td></tr><tr><td><div class="align-right">Font Size:</div></td><td><div class="align-left"><a id="growfontbutton">Grow</a> <a id="shrinkfontbutton">Shrink</a></div></td></tr><tr><td><div class="align-right">Settings:</div></td><td><div class="align-left"><a id="savesettingsbutton">Save All</a> <a id="discardsettingsbutton">Discard All</a></div></td></tr></tbody></table></div></div>
    </nav>


    <article class="markdown">
        <a id="top"></a>
<table><thead onclick="collapse_table('0')" id="table-collapse-toggle-0" class="collapsible collapsed"><tr><th>목차</th></tr></thead><tbody id="collapsible-table-0" class="invisible"><tr><td><div class="toc"><ol type="1"><li><a href="#proof-automation">Proof Automation</a><ol type="1"><li><a href="#정의">정의</a></li><li><a href="#자동화">자동화</a></li><li><a href="#loop-invariants">Loop Invariants</a></li></ol></li></ol></div></td></tr></tbody></table><h1 id="proof-automation">Proof Automation</h1><h2 id="정의">정의</h2><p>본격적으로 증명을 자동화하기에 앞서 <code class="inline-code-span">verification_conditions</code>라는 타입을 정의하겠습니다. <code class="inline-code-span">verification_conditions</code>는 precondition과 <code class="inline-code-span">dcom</code> 하나를 받아서 걔네로 만든 hoare triple이 참인지 아닌지를 나타내는 명제를 반환합니다. 정의를 먼저 보고 설명하겠습니다.</p><pre class="fenced-code-block line-num-width-1"><code><span class="code-fence-row"><span class="code-fence-index">1</span><span class="code-fence-code"><span class="color-violet">Fixpoint</span> <span class="color-aqua">verification_conditions</span> <span class="color-white">(</span><span class="color-red">P</span> <span class="color-white">:</span> <span class="color-violet">Assertion</span><span class="color-white">)</span> <span class="color-white">(</span><span class="color-red">d</span> <span class="color-white">:</span> <span class="color-violet">dcom</span><span class="color-white">)</span> <span class="color-white">:</span> <span class="color-white">Prop</span> <span class="color-white">:=</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">2</span><span class="code-fence-code">  <span class="color-violet">match</span> <span class="color-red">d</span> <span class="color-violet">with</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">3</span><span class="code-fence-code">  <span class="color-white">|</span> <span class="color-red">DCSkip</span> <span class="color-red">Q</span> <span class="color-white">=</span><span class="color-white">&gt;</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">4</span><span class="code-fence-code">      <span class="color-white">(</span><span class="color-red">P</span> <span class="color-white">-</span><span class="color-white">&gt;</span><span class="color-white">&gt;</span> <span class="color-red">Q</span><span class="color-white">)</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">5</span><span class="code-fence-code">  <span class="color-white">|</span> <span class="color-red">DCSeq</span> <span class="color-red">d1</span> <span class="color-red">d2</span> <span class="color-white">=</span><span class="color-white">&gt;</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">6</span><span class="code-fence-code">      <span class="color-red">verification_conditions</span> <span class="color-red">P</span> <span class="color-red">d1</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">7</span><span class="code-fence-code">      <span class="color-white">/\</span> <span class="color-red">verification_conditions</span> <span class="color-white">(</span><span class="color-red">post</span> <span class="color-red">d1</span><span class="color-white">)</span> <span class="color-red">d2</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">8</span><span class="code-fence-code">  <span class="color-white">|</span> <span class="color-red">DCAsgn</span> <span class="color-red">X</span> <span class="color-red">a</span> <span class="color-red">Q</span> <span class="color-white">=</span><span class="color-white">&gt;</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">9</span><span class="code-fence-code">      <span class="color-white">(</span><span class="color-red">P</span> <span class="color-white">-</span><span class="color-white">&gt;</span><span class="color-white">&gt;</span> <span class="color-red">Q</span> <span class="color-white">[</span><span class="color-red">X</span> <span class="color-white">|</span><span class="color-white">-</span><span class="color-white">&gt;</span> <span class="color-red">a</span><span class="color-white">]</span><span class="color-white">)</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">10</span><span class="code-fence-code">  <span class="color-white">|</span> <span class="color-red">DCIf</span> <span class="color-red">b</span> <span class="color-red">P1</span> <span class="color-red">d1</span> <span class="color-red">P2</span> <span class="color-red">d2</span> <span class="color-red">Q</span> <span class="color-white">=</span><span class="color-white">&gt;</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">11</span><span class="code-fence-code">      <span class="color-white">(</span><span class="color-white">(</span><span class="color-red">P</span> <span class="color-white">/\</span> <span class="color-red">b</span><span class="color-white">)</span> <span class="color-white">-</span><span class="color-white">&gt;</span><span class="color-white">&gt;</span> <span class="color-red">P1</span><span class="color-white">)</span><span class="color-white">%</span><span class="color-red">assertion</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">12</span><span class="code-fence-code">      <span class="color-white">/\</span> <span class="color-white">(</span><span class="color-white">(</span><span class="color-red">P</span> <span class="color-white">/\</span> <span class="color-white">~</span> <span class="color-red">b</span><span class="color-white">)</span> <span class="color-white">-</span><span class="color-white">&gt;</span><span class="color-white">&gt;</span> <span class="color-red">P2</span><span class="color-white">)</span><span class="color-white">%</span><span class="color-red">assertion</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">13</span><span class="code-fence-code">      <span class="color-white">/\</span> <span class="color-white">(</span><span class="color-red">post</span> <span class="color-red">d1</span> <span class="color-white">-</span><span class="color-white">&gt;</span><span class="color-white">&gt;</span> <span class="color-red">Q</span><span class="color-white">)</span> <span class="color-white">/\</span> <span class="color-white">(</span><span class="color-red">post</span> <span class="color-red">d2</span> <span class="color-white">-</span><span class="color-white">&gt;</span><span class="color-white">&gt;</span> <span class="color-red">Q</span><span class="color-white">)</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">14</span><span class="code-fence-code">      <span class="color-white">/\</span> <span class="color-red">verification_conditions</span> <span class="color-red">P1</span> <span class="color-red">d1</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">15</span><span class="code-fence-code">      <span class="color-white">/\</span> <span class="color-red">verification_conditions</span> <span class="color-red">P2</span> <span class="color-red">d2</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">16</span><span class="code-fence-code">  <span class="color-white">|</span> <span class="color-red">DCWhile</span> <span class="color-red">b</span> <span class="color-red">Pbody</span> <span class="color-red">d</span> <span class="color-red">Ppost</span> <span class="color-white">=</span><span class="color-white">&gt;</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">17</span><span class="code-fence-code">      <span class="color-white">(</span><span class="color-red">P</span> <span class="color-white">-</span><span class="color-white">&gt;</span><span class="color-white">&gt;</span> <span class="color-red">post</span> <span class="color-red">d</span><span class="color-white">)</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">18</span><span class="code-fence-code">      <span class="color-white">/\</span> <span class="color-white">(</span><span class="color-white">(</span><span class="color-red">post</span> <span class="color-red">d</span> <span class="color-white">/\</span> <span class="color-red">b</span><span class="color-white">)</span> <span class="color-white">-</span><span class="color-white">&gt;</span><span class="color-white">&gt;</span> <span class="color-red">Pbody</span><span class="color-white">)</span><span class="color-white">%</span><span class="color-red">assertion</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">19</span><span class="code-fence-code">      <span class="color-white">/\</span> <span class="color-white">(</span><span class="color-white">(</span><span class="color-red">post</span> <span class="color-red">d</span> <span class="color-white">/\</span> <span class="color-white">~</span> <span class="color-red">b</span><span class="color-white">)</span> <span class="color-white">-</span><span class="color-white">&gt;</span><span class="color-white">&gt;</span> <span class="color-red">Ppost</span><span class="color-white">)</span><span class="color-white">%</span><span class="color-red">assertion</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">20</span><span class="code-fence-code">      <span class="color-white">/\</span> <span class="color-red">verification_conditions</span> <span class="color-red">Pbody</span> <span class="color-red">d</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">21</span><span class="code-fence-code">  <span class="color-white">|</span> <span class="color-red">DCPre</span> <span class="color-red">P&apos;</span> <span class="color-red">d</span> <span class="color-white">=</span><span class="color-white">&gt;</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">22</span><span class="code-fence-code">      <span class="color-white">(</span><span class="color-red">P</span> <span class="color-white">-</span><span class="color-white">&gt;</span><span class="color-white">&gt;</span> <span class="color-red">P&apos;</span><span class="color-white">)</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">23</span><span class="code-fence-code">      <span class="color-white">/\</span> <span class="color-red">verification_conditions</span> <span class="color-red">P&apos;</span> <span class="color-red">d</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">24</span><span class="code-fence-code">  <span class="color-white">|</span> <span class="color-red">DCPost</span> <span class="color-red">d</span> <span class="color-red">Q</span> <span class="color-white">=</span><span class="color-white">&gt;</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">25</span><span class="code-fence-code">      <span class="color-red">verification_conditions</span> <span class="color-red">P</span> <span class="color-red">d</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">26</span><span class="code-fence-code">      <span class="color-white">/\</span> <span class="color-white">(</span><span class="color-red">post</span> <span class="color-red">d</span> <span class="color-white">-</span><span class="color-white">&gt;</span><span class="color-white">&gt;</span> <span class="color-red">Q</span><span class="color-white">)</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">27</span><span class="code-fence-code">  <span class="color-violet">end</span><span class="color-white">.</span></span></span>
</code><button onclick="copy_code_to_clipboard(0)" class="copy-fenced-code">Copy</button></pre><ul><li><code class="inline-code-span">DCSkip Q =&gt; (P -&gt;&gt; Q)</code><ul><li><code class="inline-code-span">{P} skip {Q}</code>라는 형태의 hoare triple이 있을 경우, <code class="inline-code-span">skip</code>은 아무것도 하지 않기 때문에 <code class="inline-code-span">P</code>만 가지고 <code class="inline-code-span">Q</code>를 만들어낼 수 있어야 합니다. 그래서 <code class="inline-code-span">P -&gt;&gt; Q</code>를 확인합니다.</li></ul></li><li><code class="inline-code-span">DCSeq d1 d2</code><ul><li><code class="inline-code-span">{P} d1 {post d1} d2</code>의 경우, <code class="inline-code-span">P</code>가 <code class="inline-code-span">d1</code>의 precondition으로 오는게 가능해야 하고, <code class="inline-code-span">d1</code>의 postcondition이 <code class="inline-code-span">d2</code>의 precondition으로 오는 것도 가능해야 합니다. 그걸 확인합니다.</li></ul></li><li>나머지 경우들도 <a href="Chap14-2.html">14-2 단원</a>에서 봤던 정의들을 그대로 표현하고 있습니다.</li></ul><p><code class="inline-code-span">verification_conditions P d</code>가 참이면 <code class="inline-code-span">P</code>와 <code class="inline-code-span">d</code>로 만든 hoare triple도 참일까요? 당연히 참이겠지만, 증명을 하고 넘어가야겠죠? 책에서도 당연히 참이라는 사실만 강조하고 증명은 그닥 중요하게 소개하지 않으니, 그냥 넘어가겠습니다.</p><pre class="fenced-code-block line-num-width-0"><code><span class="code-fence-row"><span class="code-fence-index">1</span><span class="code-fence-code"><span class="color-violet">Theorem</span> <span class="color-aqua">verification_correct</span> <span class="color-white">:</span> <span class="color-violet">forall</span> <span class="color-red">d</span> <span class="color-red">P</span><span class="color-white">,</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">2</span><span class="code-fence-code">  <span class="color-red">verification_conditions</span> <span class="color-red">P</span> <span class="color-red">d</span> <span class="color-white">-</span><span class="color-white">&gt;</span> <span class="color-white">{</span><span class="color-white">{</span><span class="color-red">P</span><span class="color-white">}</span><span class="color-dark">}</span> <span class="color-red">extract</span> <span class="color-red">d</span> <span class="color-white">{</span><span class="color-white">{</span><span class="color-red">post</span> <span class="color-red">d</span><span class="color-white">}</span><span class="color-dark">}</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">3</span><span class="code-fence-code"><span class="color-violet">Proof</span><span class="color-white">.</span> <span class="color-gray">(*</span><span class="color-gray"> 생략 </span><span class="color-gray">*)</span> <span class="color-violet">Qed</span><span class="color-white">.</span></span></span>
</code><button onclick="copy_code_to_clipboard(1)" class="copy-fenced-code">Copy</button></pre><p>이제 거의 다 왔습니다. <code class="inline-code-span">Assertion</code>과 <code class="inline-code-span">dcom</code>을 갖고 hoare triple을 만들었으니 <code class="inline-code-span">decorated</code>를 갖고도 hoare triple을 만들어봅시다.</p><pre class="fenced-code-block line-num-width-1"><code><span class="code-fence-row"><span class="code-fence-index">1</span><span class="code-fence-code"><span class="color-violet">Definition</span> <span class="color-aqua">verification_conditions_dec</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">2</span><span class="code-fence-code">              <span class="color-white">(</span><span class="color-red">dec</span> <span class="color-white">:</span> <span class="color-violet">decorated</span><span class="color-white">)</span> <span class="color-white">:</span> <span class="color-white">Prop</span> <span class="color-white">:=</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">3</span><span class="code-fence-code">  <span class="color-violet">match</span> <span class="color-red">dec</span> <span class="color-violet">with</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">4</span><span class="code-fence-code">  <span class="color-white">|</span> <span class="color-red">Decorated</span> <span class="color-red">P</span> <span class="color-red">d</span> <span class="color-white">=</span><span class="color-white">&gt;</span> <span class="color-red">verification_conditions</span> <span class="color-red">P</span> <span class="color-red">d</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">5</span><span class="code-fence-code">  <span class="color-violet">end</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">6</span><span class="code-fence-code"></span></span>
<span class="code-fence-row"><span class="code-fence-index">7</span><span class="code-fence-code"><span class="color-violet">Corollary</span> <span class="color-aqua">verification_correct_dec</span> <span class="color-white">:</span> <span class="color-violet">forall</span> <span class="color-red">dec</span><span class="color-white">,</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">8</span><span class="code-fence-code">  <span class="color-red">verification_conditions_dec</span> <span class="color-red">dec</span> <span class="color-white">-</span><span class="color-white">&gt;</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">9</span><span class="code-fence-code">  <span class="color-red">outer_triple_valid</span> <span class="color-red">dec</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">10</span><span class="code-fence-code"><span class="color-violet">Proof</span><span class="color-white">.</span> <span class="color-gray">(*</span><span class="color-gray"> 생략 </span><span class="color-gray">*)</span> <span class="color-violet">Qed</span><span class="color-white">.</span></span></span>
</code><button onclick="copy_code_to_clipboard(2)" class="copy-fenced-code">Copy</button></pre><p>좋습니다. 이제 장식된 프로그램을 만들어서 <code class="inline-code-span">verification_correct_dec</code>에 넣어주기만 하면 프로그램의 스펙을 검증할 수 있습니다.</p><h2 id="자동화">자동화</h2><p>귀찮은 정의들은 이미 끝났으니, 자동화는 놀라울 정도로 간단합니다. 아래의 예시를 봅시다.</p><pre class="fenced-code-block line-num-width-1"><code><span class="code-fence-row"><span class="code-fence-index">1</span><span class="code-fence-code"><span class="color-violet">Definition</span> <span class="color-aqua">swap_dec</span> <span class="color-white">(</span><span class="color-red">m</span> <span class="color-red">n</span><span class="color-white">:</span><span class="color-emerald">nat</span><span class="color-white">)</span> <span class="color-white">:</span> <span class="color-violet">decorated</span> <span class="color-white">:=</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">2</span><span class="code-fence-code">  <span class="color-white">&lt;</span><span class="color-white">{</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">3</span><span class="code-fence-code"><span class="color-white">    {{ </span><span class="color-red">X</span><span class="color-white"> = </span><span class="color-red">m</span><span class="color-white"> /\ </span><span class="color-red">Y</span><span class="color-white"> = </span><span class="color-red">n</span><span class="color-white">}</span><span class="color-dark">}</span> <span class="color-white">-</span><span class="color-white">&gt;</span><span class="color-white">&gt;</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">4</span><span class="code-fence-code">         <span class="color-white">{</span><span class="color-white">{ </span><span class="color-white">(</span><span class="color-red">X</span><span class="color-white"> + </span><span class="color-red">Y</span><span class="color-white">)</span><span class="color-white"> - </span><span class="color-white">(</span><span class="color-white">(</span><span class="color-red">X</span><span class="color-white"> + </span><span class="color-red">Y</span><span class="color-white">)</span><span class="color-white"> - </span><span class="color-red">Y</span><span class="color-white">)</span><span class="color-white"> = </span><span class="color-red">n</span><span class="color-white"> /\ </span><span class="color-white">(</span><span class="color-red">X</span><span class="color-white"> + </span><span class="color-red">Y</span><span class="color-white">)</span><span class="color-white"> - </span><span class="color-red">Y</span><span class="color-white"> = </span><span class="color-red">m</span> <span class="color-white">}</span><span class="color-dark">}</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">5</span><span class="code-fence-code">    <span class="color-red">X</span> <span class="color-white">:=</span> <span class="color-red">X</span> <span class="color-white">+</span> <span class="color-red">Y</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">6</span><span class="code-fence-code">         <span class="color-white">{</span><span class="color-white">{ </span><span class="color-red">X</span><span class="color-white"> - </span><span class="color-white">(</span><span class="color-red">X</span><span class="color-white"> - </span><span class="color-red">Y</span><span class="color-white">)</span><span class="color-white"> = </span><span class="color-red">n</span><span class="color-white"> /\ </span><span class="color-red">X</span><span class="color-white"> - </span><span class="color-red">Y</span><span class="color-white"> = </span><span class="color-red">m</span> <span class="color-white">}</span><span class="color-dark">}</span><span class="color-white">;</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">7</span><span class="code-fence-code">    <span class="color-dark">Y</span><span class="color-white"> := X - Y</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">8</span><span class="code-fence-code"><span class="color-white">         {{ X - Y = n /\ Y = m }};</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">9</span><span class="code-fence-code"><span class="color-white">    X := X - Y</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">10</span><span class="code-fence-code"><span class="color-white">    {{ X = n /\ Y = m}}</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">11</span><span class="code-fence-code"><span class="color-white">  }&gt;</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">12</span><span class="code-fence-code"></span></span>
<span class="code-fence-row"><span class="code-fence-index">13</span><span class="code-fence-code"><span class="color-violet">Theorem</span> <span class="color-aqua">swap_correct</span> <span class="color-white">:</span> <span class="color-violet">forall</span> <span class="color-red">m</span> <span class="color-red">n</span><span class="color-white">,</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">14</span><span class="code-fence-code">  <span class="color-red">outer_triple_valid</span> <span class="color-white">(</span><span class="color-red">swap_dec</span> <span class="color-red">m</span> <span class="color-red">n</span><span class="color-white">)</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">15</span><span class="code-fence-code"><span class="color-violet">Proof</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">16</span><span class="code-fence-code">  <span class="color-emerald">intros</span><span class="color-white">;</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">17</span><span class="code-fence-code">  <span class="color-emerald">apply</span> <span class="color-red">verification_correct</span><span class="color-white">;</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">18</span><span class="code-fence-code">  <span class="color-aqua">verify_assn</span><span class="color-white">.</span></span></span>
<span class="code-fence-row"><span class="code-fence-index">19</span><span class="code-fence-code">  <span class="color-violet">Qed</span><span class="color-white">.</span></span></span>
</code><button onclick="copy_code_to_clipboard(3)" class="copy-fenced-code">Copy</button></pre><p>장식된 프로그램을 Coq에게 던져주고 조건들이 유효한지를 물었습니다. 먼저, <code class="inline-code-span">verification_correct</code>를 이용해서 assertion과 명령어 사이의 관계들이 유효한지를 다 검사합니다. 검사하고 남은 찌꺼기들은 <code class="inline-code-span">verify_assn</code> tactic이 전부 처리합니다.</p><h2 id="loop-invariants">Loop Invariants</h2><p>위에서는 장식된 프로그램을 Coq에게 줬죠? 사실 장식이 안 돼있고 가장 첫 precondition과 마지막 postcondition만 있는 순수 hoare triple이어도 중간 단계의 assertion들을 찾는 건 어렵지 않습니다. <a href="Chap14-2.html">14-2 단원</a>에서 봤던 규칙들을 이용해서 기계적으로 찾을 수 있거든요. 기계적으로 찾을 수 없는 게 딱 하나 있습니다. 바로, loop invariant를 찾는 것입니다. 아래의 예시 프로그램을 보면서 설명하겠습니다.</p><pre class="fenced-code-block line-num-width-0"><code><span class="code-fence-row"><span class="code-fence-index">1</span><span class="code-fence-code">{{ X = m /\ Y = n }}</span></span>
<span class="code-fence-row"><span class="code-fence-index">2</span><span class="code-fence-code">  while X &lt;&gt; 0 do</span></span>
<span class="code-fence-row"><span class="code-fence-index">3</span><span class="code-fence-code">    Y := Y - 1;</span></span>
<span class="code-fence-row"><span class="code-fence-index">4</span><span class="code-fence-code">    X := X - 1</span></span>
<span class="code-fence-row"><span class="code-fence-index">5</span><span class="code-fence-code">  end</span></span>
<span class="code-fence-row"><span class="code-fence-index">6</span><span class="code-fence-code">{{ Y = n - m }}</span></span>
</code><button onclick="copy_code_to_clipboard(4)" class="copy-fenced-code">Copy</button></pre><p>저 조건들이 참인 건 사람 눈에는 자명해 보입니다. 어떻게 assertion을 넣어야 Coq이 한번에 증명할 수 있을까요? 손으로 assertion들을 넣어봅시다.</p><pre class="fenced-code-block line-num-width-1"><code><span class="code-fence-row"><span class="code-fence-index">1</span><span class="code-fence-code">{{ X = m /\ Y = n }}  -&gt;&gt;</span></span>
<span class="code-fence-row"><span class="code-fence-index">2</span><span class="code-fence-code">{{ Inv }}</span></span>
<span class="code-fence-row"><span class="code-fence-index">3</span><span class="code-fence-code">  while X &lt;&gt; 0 do</span></span>
<span class="code-fence-row"><span class="code-fence-index">4</span><span class="code-fence-code">          {{ Inv /\ X &lt;&gt; 0 }}  -&gt;&gt;</span></span>
<span class="code-fence-row"><span class="code-fence-index">5</span><span class="code-fence-code">          {{ Inv [X |-&gt; X-1] [Y |-&gt; Y-1] }}</span></span>
<span class="code-fence-row"><span class="code-fence-index">6</span><span class="code-fence-code">    Y := Y - 1;</span></span>
<span class="code-fence-row"><span class="code-fence-index">7</span><span class="code-fence-code">          {{ Inv [X |-&gt; X-1] }}</span></span>
<span class="code-fence-row"><span class="code-fence-index">8</span><span class="code-fence-code">    X := X - 1</span></span>
<span class="code-fence-row"><span class="code-fence-index">9</span><span class="code-fence-code">          {{ Inv }}</span></span>
<span class="code-fence-row"><span class="code-fence-index">10</span><span class="code-fence-code">  end</span></span>
<span class="code-fence-row"><span class="code-fence-index">11</span><span class="code-fence-code">{{ Inv /\ ~(X &lt;&gt; 0) }}  -&gt;&gt;</span></span>
<span class="code-fence-row"><span class="code-fence-index">12</span><span class="code-fence-code">{{ Y = n - m }}</span></span>
</code><button onclick="copy_code_to_clipboard(5)" class="copy-fenced-code">Copy</button></pre><p>대입 전후의 assertion은 기계적인 방법으로 찾을 수 있지만 loop invariant를 찾아내는 간단한 알고리즘은 없습니다. 그래서 일단은 loop invariant를 찾지 못하고 <code class="inline-code-span">Inv</code>라는 이름을 붙여놓았습니다. <code class="inline-code-span">Inv</code>를 찾는 똘똘한 방법이 없을까요? <code class="inline-code-span">Inv</code>가 만족해야하는 조건들을 생각해봅시다.</p><ul><li>먼저, 1번 줄에서 2번 줄로 가는 <code class="inline-code-span">-&gt;&gt;</code>가 유효해야 합니다. <code class="inline-code-span">Inv</code> 조건이 너무 빡빡하면 힘들겠죠.</li><li>또한, 11번 줄에서 12번 줄로 가는 <code class="inline-code-span">-&gt;&gt;</code>도 유효해야 합니다. <code class="inline-code-span">Inv</code> 조건이 너무 약하면 힘들겠죠.</li><li>마지막으로, loop-invariant라는 이름에서 보듯 while문 안에서 <code class="inline-code-span">Inv</code>가 계속 성립을 해야합니다. 즉, 4번 줄에서 5번 줄로 가는 <code class="inline-code-span">-&gt;&gt;</code>가 유효해야 합니다.</li></ul><p>음, 저걸 어떻게 찾을까요... Coq은 고사하고 인간이 찾는 것도 힘들어 보입니다. 사람이 찾는 방법은 2가지입니다.</p><ol type="1"><li>직관을 이용한다.</li><li>될 때까지 해본다.</li></ol><p>보통은 두가지를 섞어서 쓰죠. 가장 간단해보이는 조건 (예: <code class="inline-code-span">Inv</code>가 <code class="inline-code-span">True</code>일까?)에서 시작을 하고, 성공할 때까지 계속 시도해보는 것입니다. 실패할 때마다 거기서 알게된 지식을 다음 시도에 반영하고요. 위의 예시에서도 <code class="inline-code-span">Inv</code>가 <code class="inline-code-span">Y - X = n - m</code>이면 모든 조건을 만족합니다.</p><hr/><div class="align-center"><p><a href="index.html">메인으로 돌아가기</a></p></div><div class="align-left"><p>&lt;&lt; <a href="Chap14-3.html">Chapter 14-3. Decorations</a></p></div><div class="align-right"><p><a href="Chap14-5.html">Chapter 14-5. Hoare Logic as a Logic</a> &gt;&gt;</p></div><script>/*<![CDATA[*/
const fenced_code_block_contents = ["Fixpoint verification_conditions (P : Assertion) (d : dcom) : Prop :=\n  match d with\n  | DCSkip Q =>\n      (P ->> Q)\n  | DCSeq d1 d2 =>\n      verification_conditions P d1\n      /\\ verification_conditions (post d1) d2\n  | DCAsgn X a Q =>\n      (P ->> Q [X |-> a])\n  | DCIf b P1 d1 P2 d2 Q =>\n      ((P /\\ b) ->> P1)%assertion\n      /\\ ((P /\\ ~ b) ->> P2)%assertion\n      /\\ (post d1 ->> Q) /\\ (post d2 ->> Q)\n      /\\ verification_conditions P1 d1\n      /\\ verification_conditions P2 d2\n  | DCWhile b Pbody d Ppost =>\n      (P ->> post d)\n      /\\ ((post d /\\ b) ->> Pbody)%assertion\n      /\\ ((post d /\\ ~ b) ->> Ppost)%assertion\n      /\\ verification_conditions Pbody d\n  | DCPre P' d =>\n      (P ->> P')\n      /\\ verification_conditions P' d\n  | DCPost d Q =>\n      verification_conditions P d\n      /\\ (post d ->> Q)\n  end.", "Theorem verification_correct : forall d P,\n  verification_conditions P d -> {{P}} extract d {{post d}}.\nProof. (* 생략 *) Qed.", "Definition verification_conditions_dec\n              (dec : decorated) : Prop :=\n  match dec with\n  | Decorated P d => verification_conditions P d\n  end.\n\nCorollary verification_correct_dec : forall dec,\n  verification_conditions_dec dec ->\n  outer_triple_valid dec.\nProof. (* 생략 *) Qed.", "Definition swap_dec (m n:nat) : decorated :=\n  <{\n    {{ X = m /\\ Y = n}} ->>\n         {{ (X + Y) - ((X + Y) - Y) = n /\\ (X + Y) - Y = m }}\n    X := X + Y\n         {{ X - (X - Y) = n /\\ X - Y = m }};\n    Y := X - Y\n         {{ X - Y = n /\\ Y = m }};\n    X := X - Y\n    {{ X = n /\\ Y = m}}\n  }>.\n\nTheorem swap_correct : forall m n,\n  outer_triple_valid (swap_dec m n).\nProof.\n  intros;\n  apply verification_correct;\n  verify_assn.\n  Qed.", "{{ X = m /\\ Y = n }}\n  while X <> 0 do\n    Y := Y - 1;\n    X := X - 1\n  end\n{{ Y = n - m }}", "{{ X = m /\\ Y = n }}  ->>\n{{ Inv }}\n  while X <> 0 do\n          {{ Inv /\\ X <> 0 }}  ->>\n          {{ Inv [X |-> X-1] [Y |-> Y-1] }}\n    Y := Y - 1;\n          {{ Inv [X |-> X-1] }}\n    X := X - 1\n          {{ Inv }}\n  end\n{{ Inv /\\ ~(X <> 0) }}  ->>\n{{ Y = n - m }}"];

function copy_code_to_clipboard(index) {
    navigator.clipboard.writeText(fenced_code_block_contents[index]);
}/*]]>*/</script>
        <a id="bottom"></a>
    </article>




    <footer class="markdown">
<p><br/></p><p><br/></p><hr/><div class="align-center"><p>2021 ~ 2023 &copy; Baehyunsol</p></div>
    </footer>


    <script src="colors.js"></script>

    
    <script src="nav.js"></script>
    
    
    
    <script src="header.js"></script>
    
<script src="collapsible_tables.js"></script></body>

</html>